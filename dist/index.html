<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>Telecom B2C ‚Äî Mobile Prototype</title>
    <style>
      :root {
        --bg:#f7f8fb; --ink:#0b1324; --muted:#51607f; --line:#cfd8e3;
        --primary:#401075; --primary-ink:#fff; --chip:#ffffff; --chip-line:#AE96CB;
        --success-bg:#eafff0; --success-line:#9feab9; --success-ink:#1a7f3c;
        --brand-grad: linear-gradient(180deg, #96E9F9 0%, #9FC7FF 35%, #A59CFF 60%, #8D68FF 80%, #5A1BA9 100%);
      }
      html, body { margin:0; height:100%; background:var(--bg); font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
      .app { display:flex; align-items:center; justify-content:center; min-height:100vh; padding:20px; }
      .phone { width:380px; height:820px; border:2px solid #1f2a44; border-radius:28px; background:#fff; overflow:auto; -webkit-overflow-scrolling:touch; position:relative; }
      header { padding:16px 20px 8px; font-weight:600; color:var(--ink); }
      .screen { display:none; height:100%; }
      .screen.active { display:block; }
      .content { padding:0 20px 12px; }
      .muted { color:var(--muted); font-size:12px; }
      .chip { display:inline-block; padding:6px 10px; border:1px solid #401075; background:var(--chip); border-radius:28px; font-size:11px; color:#401075; margin:4px 6px 0 0; }
      .card { border:1px solid var(--line); border-radius:12px; padding:12px; margin:10px 0; box-shadow:2px 2px 14px rgba(11,19,36,.16); }
      .plan { font-weight:600; color:var(--ink); font-size:14px; }
      .price { font-weight:700; color:var(--ink); }
      .feat { color:var(--muted); font-size:12px; }
      .elig { display:inline-block; background:var(--success-bg); color:var(--success-ink); border:1px solid var(--success-line); border-radius:8px; padding:4px 8px; font-size:11px; }
      .cta { display:inline-block; background:#401075; color:#fff; border:1px solid #401075; border-radius:28px; padding:10px 14px; font-weight:500; font-size:14px; cursor:pointer; box-shadow:2px 2px 12px rgba(64,16,117,.45); height:50px; }
      .cta-secondary { display:inline-block; background:#ffffff; color:#401075; border:1px solid #401075; border-radius:28px; padding:10px 14px; font-weight:400; font-size:14px; cursor:pointer; box-shadow:2px 2px 10px rgba(64,16,117,.25); height:50px; }
      .cta-tertiary { display:inline-flex; align-items:center; justify-content:center; text-align:center; background:#ffffff; color:#401075; border:0.25px solid #401075; border-radius:28px; padding:0 14px; font-weight:400; cursor:pointer; height:30px; box-shadow:none; width:auto; }
      /* Ensure tertiary buttons inside AI bottom sheets center their text */
      .drawer .cta-tertiary { justify-content:center; text-align:center; }
      /* Disabled state for primary buttons */
      .cta:disabled,
      .cta[disabled],
      .cta.btn-disabled {
        background:#E1DCE5 !important;
        color:#ACA6B1 !important;
        border-color:#ACA6B1 !important;
        outline:1px solid #ACA6B1 !important;
        box-shadow:none !important;
        cursor:not-allowed !important;
        pointer-events:none !important;
      }
      /* Ensure product card text is black (avoid accidental white) */
      /* .card .plan,
      .card .price,
      .card .feat,
      .card .muted { color:#000000; } */
      /* Force black text for key lines in Review card (price /mo, desc, ETA, people) */
      #screen-review [aria-label="Plan summary"] .muted { color:#000000 !important; }
      .stack { display:flex; gap:10px; flex-wrap:wrap; }
      .sticky { position:sticky; left:0; right:0; bottom:0; padding:12px 16px; border-top:1px solid var(--line); background:rgba(255,255,255,.96); display:flex; gap:10px; }
      input[type="text"], input[type="date"], input[type="time"], select, textarea {
        width:90%; padding:12px 12px; border:1px solid var(--line); border-radius:28px; font-size:14px; box-sizing: border-box; display:block; margin-left:auto; margin-right:auto;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; color: var(--ink);
      }
      .row { display:flex; gap:10px; }
      .row > * { flex:1; }
      .subtle { font-size:11px; color:#6b7b9b; }
      .center { text-align:center; }
      .divider { height:1px; background:var(--line); margin:12px 0; }
      .drawer { position:absolute; left:0; right:0; bottom:0; background:#fff; border-top:2px solid #1f2a44; border-radius:16px 16px 0 0; padding:14px; box-shadow:0 -20px 60px rgba(0,0,0,.25); }
      .overlay { position:absolute; inset:0; background:rgba(11,19,36,.25); }
      .hidden { display:none; }
      .stars { color:#f59e0b; font-size:20px; }
      .toolbar { display:flex; gap:8px; flex-wrap:wrap; }
      .sr-only { position:absolute; left:-9999px; width:1px; height:1px; overflow:hidden; }
      .link { color:var(--primary); font-weight:600; cursor:pointer; }
      /* placeholders match base font */
      input::placeholder, textarea::placeholder {
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        font-size: 12px;
        color: var(--muted);
        opacity: 1;
      }
      /* explicit system-ui placeholder for the welcome textarea */
      #welcomeSearch::placeholder {
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      }
      /* welcome textarea width */
      #welcomeSearch { width:95%; }
      /* welcome */
      .hero { width:104px; height:104px; border-radius:52px; background:#eef2ff; margin:32px auto; display:flex; align-items:center; justify-content:center; }
      .hero-icon { width:56px; height:56px; border-radius:28px; border:6px solid var(--primary); box-sizing:border-box; position:relative; }
      .hero-icon::after, .hero-icon::before { content:""; position:absolute; border:6px solid var(--primary); border-radius:999px; inset:-14px; }
      .hero-icon::before { inset:-28px; opacity:.35; }
      .dots { display:flex; gap:10px; justify-content:center; margin:16px 0 0; }
      .dot { width:8px; height:8px; border-radius:4px; background:#cfe0ff; }
      .dot.active { background:var(--primary); }
      .chip-toggle.selected { background:var(--primary); color:#fff; border-color:#401075; }
      /* helper text over gradient panels */
      /* .welcome-top .muted, .address-top .muted, .reco-top .muted, #screen-processing .address-top .muted { color:#ffffff; } */
      .welcome-top .subhead, .address-top .subhead, .reco-top .subhead, #screen-processing .address-top .subhead { color:#ffffff; }
      .cta-md { padding:8px 12px; font-size:14px; }
      .link-sm { font-size:13px; }
        .cta-lg { padding:14px 16px; font-size:16px; }
        /* Persona selection cards (restored) */
        .persona-card { cursor:pointer; box-sizing:border-box; box-shadow:2px 2px 14px rgba(11,19,36,.16) !important; width:100%; margin:0 auto; }
        .persona-card:hover { background:#F8F2FF !important; }
        .persona-card.selected { border:2px solid #401075 !important; }
        /* Chat layout (restored) */
        .chat-row { display:flex; gap:10px; align-items:flex-start; margin:10px 0; }
        .chat-avatar { flex:0 0 36px; width:36px; height:36px; border-radius:18px; background:#eef2ff; color:#401075; display:flex; align-items:center; justify-content:center; font-weight:800; box-shadow:0 1px 2px rgba(0,0,0,.15); }
        .chat-avatar.agent { background:#e6f0ff; }
        .chat-avatar.user { background:#ffe9f0; color:#9b1c5a; }
        .chat-name { display:none; }
        .chat-bubble { background:#f5f7fb; border:1px solid #e3e7ef; border-radius:16px; padding:12px; color:#0b1324; font-size:14px; line-height:1.4; flex:1; box-shadow:0 6px 16px rgba(11,19,36,.12); }
        /* Selectable chips inside AI sheet */
        .chip.selected { background:#401075; color:#ffffff; border-color:#401075; font-weight:700; }
        .chip.disabled { opacity:.5; pointer-events:none; border-color:var(--line); }
        .toolbar.ai-selectable { gap:4px; }
        .ai-selectable .chip { margin:2px 4px 0 0; }
        .ai-disabled { opacity:.85; }
        .ai-disabled .chip { opacity:.5; pointer-events:none; }
        .ai-disabled button, .ai-disabled input, .ai-disabled select { pointer-events:none; opacity:.6; }
      .chip-toggle { font-size:13px; padding:8px 12px; position:relative; color:#401075; }
      .req { color:#d92c20; margin-left:4px; font-weight:700; }
      /* address screen styles */
      .display-h1 { font-weight:800; font-size:28px; text-align:center; color:var(--ink); margin:14px 16px 8px; }
      .subhead { text-align:center; color:#51607f; font-size:14px; margin:0 24px 18px; }
      .image-hero { height:240px; border-radius:14px; background:linear-gradient(180deg,#cfe8ff 0%, #8cc2ff 100%); margin:12px 20px; box-shadow:0 8px 24px rgba(0,0,0,.08); }
      img.image-hero { display:block; border-radius:14px; margin:12px auto; box-shadow:0 8px 24px rgba(0,0,0,.08); max-width:100%; height:auto; }
      .input-with-icon { position:relative; }
      .input-with-icon .icon-left { position:absolute; left:12px; top:50%; transform:translateY(-50%); font-size:18px; color:#6b7b9b; }
      .input-with-icon input { padding-left:40px; }
      .btn-disabled { background:#7a7a7a !important; border-color:#5f6368 !important; color:#ffffff !important; box-shadow:none !important; opacity:1; pointer-events:none; }
      /* Busy state for secondary buttons that should keep the secondary color */
      /* Busy state for auto-detect button ‚Äî keep same visual style as .cta-secondary */
      .btn-busy-secondary { background:#ffffff !important; border-color:#401075 !important; color:#401075 !important; box-shadow:2px 2px 10px rgba(64,16,117,.25) !important; opacity:1 !important; pointer-events:none; }
      .success { color:#1a7f3c; font-size:13px; }
      .failure { color:#b91c1c; font-size:13px; }
      .address-top { background:url('./assets/GradientBackground.svg') center / cover no-repeat; padding-top:8px; padding-bottom:8px; margin-bottom:24px; }
      .hero-address { width:104px; height:104px; border-radius:52px; background:transparent; margin:16px auto 8px; display:flex; align-items:center; justify-content:center; box-shadow:2px 6px 18px rgba(64,16,117,.35); }
      .hero-address img { width:64px; height:64px; object-fit:contain; }
      /* soft elevation for key hero icons */
      #personalizeIcon, #matchSearchIcon, .reco-hero, #addressIcon, #addressIcon2, #personaHero { box-shadow:2px 6px 18px rgba(64,16,117,.35); border-radius:52px; }
      /* address inputs width */
      #screen-address input[type="text"] { width:90%; }
      /* two-column rows at 38% each */
      #screen-address .address-split > * { flex:0 0 38%; }
      #screen-address .address-split input[type="text"] { width:100%; }
      #screen-address .address-split { gap:10px; align-items:flex-start; justify-content:flex-start; }
      #screen-address .address-split label { white-space:nowrap; }
      /* numbered priority badge for multi-select order */
      .chip-toggle[data-rank]::after {
        content: attr(data-rank);
        position:absolute;
        top:-8px;
        right:-8px;
        width:20px;
        height:20px;
        border-radius:10px;
        background:#AE96CB;
        color:#fff;
        font-weight:700;
        font-size:12px;
        display:flex;
        align-items:center;
        justify-content:center;
        box-shadow:0 1px 2px rgba(0,0,0,.25);
        transform: scale(1);
        transition: transform 120ms ease;
      }
      #screen-welcome { background: #ffffff; }
      .welcome-top { background:url('./assets/GradientBackground.svg') center / cover no-repeat; padding-top:8px; padding-bottom:8px; }
      .section-title { font-weight:500; color:#0b1324; font-size:14px; }
      .section-sub { font-size:12px; color:#51607f; margin:2px 0 8px; }
      #affinityNotes { width:90%; margin:0; }
      /* processing screen */
      #screen-processing { background:url('./assets/GradientBackground.svg') center / cover no-repeat; }
      .ring {
        --p: 0; /* progress 0..100 */
        width:88px; height:88px; border-radius:44px;
        background:
          conic-gradient(var(--primary) calc(var(--p)*1%), #dbe8ff 0);
        display:inline-block; position:relative; margin:4px auto;
      }
      .ring::after {
        content:"";
        position:absolute; inset:8px; background:#ffffff; border-radius:50%;
      }
      .ring-label {
        position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
        font-weight:700; color:var(--primary); font-size:14px;
      }
      .badge {
        display:inline-block; padding:6px 10px; border-radius:10px; border:1px solid; font-size:13px; margin-top:4px;
      }
      .badge.success { background:#eafff0; border-color:#9feab9; color:#1a7f3c; }
      .badge.failure { background:#ffe8ea; border-color:#ffc0c6; color:#b91c1c; }
      /* personalize (step 4) */
      #screen-personalize { background:#ffffff; }
      .option-chip { display:inline-block; padding:8px 12px; border:1px solid var(--chip-line); background:#fff; color:#2b3e66; border-radius:10px; font-weight:600; cursor:pointer; }
      .option-chip.selected { background:#401075; border-color:#401075; color:#ffffff; }
      .range-row { display:flex; align-items:center; gap:10px; }
      .range-row input[type="range"] { flex:1; }
      .range-value { min-width:88px; text-align:right; font-weight:600; color:#0b1324; }
      /* iOS-like slider styling */
      .styled-range {
        -webkit-appearance:none; appearance:none; height:8px; border-radius:999px;
        background:
          linear-gradient(#401075 0 0) 0/ var(--val,0%) 100% no-repeat,
          #e8eff8;
        outline:none;
      }
      .styled-range::-webkit-slider-thumb {
        -webkit-appearance:none; appearance:none;
        width:10px; height:10px; border-radius:50%;
        background:#ffffff; border:3px solid #401075;
        box-shadow:0 1px 2px rgba(0,0,0,.15);
        cursor:pointer;
        margin-top:-1px; /* centers thumb on 8px track */
      }
      .styled-range::-moz-range-thumb {
        width:10px; height:10px; border-radius:50%;
        background:#ffffff; border:3px solid #401075;
        box-shadow:0 1px 2px rgba(0,0,0,.15);
        cursor:pointer;
      }
      .styled-range::-moz-range-track {
        height:8px; border-radius:999px; background:#e8eff8;
      }
      /* linear progress for match screen */
      .progress-row { display:flex; align-items:center; justify-content:space-between; width:90%; margin:6px auto; max-width:520px; }
      .progress { width:90%; height:8px; background:#e6edf7; border-radius:999px; margin:6px auto 0; max-width:520px; }
      .progress-fill { height:8px; background:var(--primary); border-radius:999px; width:0%; transition:width .2s linear; }
      /* match screen */
      #screen-match { background:#ffffff; }
      /* recommended screen */
      .reco-top { background:url('./assets/GradientBackground.svg') center / cover no-repeat; padding-top:8px; padding-bottom:12px; }
      .reco-hero { display:block; margin:12px auto 6px; width:64px; height:64px; }
      .hscroll { display:flex; gap:10px; overflow-x:auto; padding:6px 0 10px; }
      .mini-card { flex:0 0 70%; border:1px solid var(--line); border-radius:12px; padding:12px; background:#fff; box-shadow:2px 2px 14px rgba(11,19,36,.16); }
      .hscroll .card { flex:0 0 80%; }
      .mini-desc { display:block; margin-top:4px; min-height:56px; } /* ~4 lines at ~14px */
      .buy-desc { display:block; margin-top:4px; min-height:70px; } /* ~5 lines at ~14px */
      .chip-white { background:#ffffff; border-color:var(--line); color:#2b3e66; }
      .suggest-two { display:block; min-height:28px; } /* ~2 lines at ~14px */
      /* full plan details */
      .detail-hero { height:140px; border-radius:12px; background:url('./assets/GradientBackground.svg') center / cover no-repeat; margin:12px 0; }
      .pill { display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border:1px solid var(--line); border-radius:999px; font-size:12px; background:#fff; }
      .pill-low { background:#fff7cc; border-color:#facc15; color:#8a6d00; padding:4px 8px; font-size:11px; }
      .pill-med { background:#ffe8d6; border-color:#fb923c; color:#9a3412; padding:4px 8px; font-size:11px; }
      .pill-high { background:#eafff0; border-color:#9feab9; color:#1a7f3c; padding:4px 8px; font-size:11px; }
      /* Risk indicator pills for dashboard personas */
      .risk-high { background:#fde8e8; border-color:#fecaca; color:#b91c1c; }
      .risk-med { background:#fff7ed; border-color:#fed7aa; color:#b45309; }
      .risk-low { background:#ecfdf5; border-color:#a7f3d0; color:#065f46; }
      /* Prevent pills from stretching in flex rows */
      .row > .pill { flex:0 0 auto; }
      /* Small status badges over icons */
      .badge-dot { position:absolute; top:-4px; right:-4px; width:14px; height:14px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:10px; line-height:1; border:2px solid #fff; color:#fff; }
      .badge-green { background:#22c55e; }
      .badge-yellow { background:#facc15; color:#111827; }
      .badge-orange { background:#f97316; }
      .badge-red { background:#dc2626; }
      .grid-two { display:grid; grid-template-columns:1fr 1fr; gap:10px; }
      /* compare table */
      .cmp-table { width:100%; border-collapse:separate; border-spacing:0; }
      .cmp-scroll { overflow-x:auto; }
      .cmp-row { display:grid; grid-template-columns:140px repeat(4,160px); align-items:center; padding:8px 10px; min-width:780px; font-size:14px; }
      .cmp-row + .cmp-row { border-top:1px solid var(--line); }
      .cmp-head { font-weight:700; color:var(--ink); }
      .cmp-feat { display:flex; align-items:center; gap:8px; color:#30456a; font-weight:700; }
      .cmp-val { text-align:center; color:#0b1324; font-weight:600; }
      .cmp-subtle { color:#51607f; font-weight:500; }
      .cmp-yes { color:#1a7f3c; font-weight:700; }
      .cmp-no { color:#c2410c; font-weight:700; }
      /* prevent vertical scroll inside compare drawer */
      .drawer { overflow-y:hidden; }
      /* toggle switch */
      .toggle { position:relative; display:inline-block; width:38px; height:22px; }
      .toggle input { opacity:0; width:0; height:0; }
      .toggle-slider {
        position:absolute; inset:0; cursor:pointer; border-radius:999px;
        background:#e6edf7; border:1px solid var(--line); transition:background .2s, border-color .2s;
      }
      .toggle-slider::before {
        content:""; position:absolute; width:16px; height:16px; left:3px; top:50%;
        transform:translateY(-50%); border-radius:50%; background:#fff; box-shadow:0 1px 2px rgba(0,0,0,.2);
        transition:transform .2s;
      }
      .toggle input:checked + .toggle-slider { background:#2b7fff; border-color:#1e5fd1; }
      .toggle input:checked + .toggle-slider::before { transform:translate(16px,-50%); }
      /* Selected checkbox color */
      input[type="checkbox"] { accent-color:#401075; }
    </style>
  </head>
  <body>
    <div class="app">
      <div class="phone" role="application" aria-label="Telecom B2C mobile prototype">
        <!-- Intro (Pre-Welcome) - restored -->
        <section id="screen-intro" class="screen active" aria-labelledby="intro-title">
          <div class="welcome-top" style="min-height:100vh; display:flex; flex-direction:column; align-items:center; justify-content:center;">
            <img src="./assets/Welcome-icon.svg" alt="Telco icon" style="display:block; width:104px; height:104px; border-radius:52px; box-shadow:2px 6px 18px rgba(64,16,117,.35); margin:16px auto;" />
            <header id="intro-title" class="center" style="font-size:45px; line-height:1.25; padding-top:0; padding-bottom:10px; margin:0; color:#401075;">Welcome to Telco!</header>
            <p class="subhead" style="margin:6px 16px 0; line-height:1.3; font-size:20px; text-align:center; padding-bottom:120px">
              Let‚Äôs personalise your connection in just a few quick steps!
            </p>
            <!-- AI prompt pill -->
            <div role="group" aria-label="Ask AI prompt" style="width:85%; max-width:520px; margin:8px auto 0;">
              <div style="background:#f6f7fa; border:1px solid var(--line); border-radius:999px; padding:10px 14px; display:flex; align-items:center; gap:10px;">
                <img src="./assets/sparkle-icon.svg" alt="" aria-hidden="true" style="width:18px; height:18px;" />
                <input type="text" id="aiPrompt" placeholder="Ask AI anything.." aria-label="Ask AI anything" onclick="openAISheet()" style="flex:1; border:0; outline:none; background:transparent; font-size:14px; color:#6b7280;" />
                <button type="button" aria-label="Send" style="border:0; background:transparent; color:#6b7280; font-size:18px; padding:4px 6px; cursor:pointer;">‚û§</button>
              </div>
            </div>
          </div>
          <div class="sticky" style="align-items:stretch; background:transparent; border-top:0;">
            <div class="center" style="width:100%;">
              <span class="link" role="button" tabindex="0" style="font-size:18px; color:#D2ABFF; font-weight:400;"  onclick="goto('screen-persona')">Get Started!</span>
            </div>
            <div class="center" style="margin-top:4px;">
              <div class="dots" style="margin:4px 0;">
                <span class="dot active" role="button" tabindex="0" aria-label="Find your persona" onclick="goto('screen-persona')" style="cursor:pointer;"></span>
                <span class="dot" role="button" tabindex="0" aria-label="Go to Welcome" onclick="goto('screen-welcome')" style="cursor:pointer;"></span>
              </div>
            </div>
          </div>
        </section>
        <!-- Plan Details - Full (Duplicate) -->
        <section id="screen-plan-full-2" class="screen" aria-labelledby="planfull-title-2">
          <header id="planfull-title-2" style="font-weight:700; padding:12px 20px 8px; color:#401075; display:flex; align-items:center; justify-content:center; position:relative; background:url('./assets/GradientBackground.svg') center / cover no-repeat;">
            <span role="button" tabindex="0" onclick="goto('screen-results-reco-2')" style="position:absolute; left:20px; cursor:pointer;">‚Üê</span>
            <span>View Plan Details</span>
          </header>
          <div class="content" style="padding-top:0;">
            <div class="address-top" style="padding-top:8px; padding-bottom:12px; margin-bottom:12px; margin-left:-20px; margin-right:-20px; padding-left:20px; padding-right:20px;">
              <article class="card" role="article" aria-label="Top pick product (duplicate)" style="background:#fff;">
                <div class="row" style="align-items:center; justify-content:space-between; margin-top:4px;">
                  <div class="plan" style="font-size:18px; color:#401075; font-weight:700;">Fiber Pro Giga Plan</div>
                  <span class="pill pill-high">Highly Recommended</span>
                </div>
                <div class="price" style="font-size:20px; margin:4px 0; color:#000000;">$75.00 <span class="muted" style="color:#000000;">/month</span></div>
                <ul class="feat" style="margin-top:6px; color:#000000; padding-left:18px;">
                  <li>Roaming allowance: Domestic</li>
                  <li>Hotspot: 5 GB</li>
                  <li>Speed: 200‚Äì300 Mbps</li>
                </ul>
                <div class="row" style="align-items:center; gap:8px; margin-top:6px;">
                  <span class="pill" style="background:#ffffff;">Promo: Essential plan</span>
                </div>
                <div class="muted" style="margin-top:6px; color:#000000;">üë• 40 people bought this plan in your area</div>
              </article>
            </div>
            <!-- Why this product for you? -->
            <div class="row" style="align-items:center; justify-content:flex-start; margin-top:12px;">
              <div class="plan">Why this product for you?</div>
            </div>
            <article id="accWhyBody2" class="card" style="margin-top:8px;">
              <div>
                <div class="plan" id="pd2Why1Title">Optimal for Gaming &amp; Streaming</div>
                <ul class="muted" style="margin:6px 0 0 18px; padding:0;">
                  <li><strong>Focus:</strong> Performance and Usage Affinity.</li>
                  <li><strong>Intent:</strong> <span id="pd2Why1Desc" style="font-style:italic;">Based on your stated activities.</span></li>
                </ul>
                <div class="muted" style="margin-top:6px;">Pro‚ÄëSpeed for Streaming ‚Äî Perfect bandwidth for 4K video &amp; lag‚Äëfree gaming.</div>
              </div>
              <div class="divider" style="margin:10px 0;"></div>
              <div>
                <div class="plan" id="pd2Why2Title">Covers All Your Devices</div>
                <ul class="muted" style="margin:6px 0 0 18px; padding:0;">
                  <li><strong>Focus:</strong> Product Preference and Scale.</li>
                  <li><strong>Intent:</strong> <span id="pd2Why2Desc" style="font-style:italic;">For your family of 4.</span></li>
                </ul>
                <div class="muted" style="margin-top:6px;">Covers Your Whole Household ‚Äî Validated for simultaneous use by 4+ devices/users.</div>
              </div>
              <div class="divider" style="margin:10px 0;"></div>
              <div>
                <div class="plan" id="pd2Why3Title">Best Speed in Your Area</div>
                <ul class="muted" style="margin:6px 0 0 18px; padding:0;">
                  <li><strong>Focus:</strong> Feasibility and Coverage.</li>
                  <li><strong>Intent:</strong> <span id="pd2Why3Desc" style="font-style:italic;">Based on feasibility check</span></li>
                </ul>
                <div class="muted" style="margin-top:6px;">Best Speed at Your Address ‚Äî Guaranteed 500 Mbps based on feasibility check.</div>
              </div>
            </article>

            <!-- What it includes -->
            <div class="row" style="align-items:center; justify-content:flex-start; margin-top:12px;">
              <div class="plan">What it includes</div>
            </div>
            <article id="accIncBody2" class="card" style="margin-top:8px;">
              <div class="row" style="margin-top:0;">
                <div class="muted" style="flex:1;">Download Speed</div>
                <div class="plan" id="pd2IncDown" style="font-size:13px;">500 Mbps</div>
              </div>
              <div class="row" style="margin-top:4px;">
                <div class="muted" style="flex:1;">Upload Speed</div>
                <div class="plan" id="pd2IncUp" style="font-size:13px;">50 Mbps</div>
              </div>
              <div class="row" style="margin-top:4px;">
                <div class="muted" style="flex:1;">Data Allowance</div>
                <div class="plan" id="pd2Allowance" style="color:#1a7f3c; font-size:13px;">Unlimited</div>
              </div>
              <div class="row" style="margin-top:4px;">
                <div class="muted" style="flex:1;">Contract Length</div>
                <div class="plan" id="pd2Contract" style="font-size:13px;">24 months</div>
              </div>
              <div class="row" style="margin-top:4px;">
                <div class="muted" style="flex:1;">Equipment</div>
                <div class="plan" id="pd2Equipment" style="color:#1a7f3c; font-size:13px;">Free Wi‚ÄëFi 6 Router</div>
              </div>
            </article>

            <!-- Pricing Breakdown -->
            <div class="row" style="align-items:center; justify-content:flex-start; margin-top:12px;">
              <div class="plan">Pricing Breakdown</div>
            </div>
            <article id="accPriceBody2" class="card" style="margin-top:6px;">
              <div class="row" style="margin-top:0;">
                <div class="muted" style="flex:1;">Monthly Plan Rate</div>
                <div class="plan" id="pd2PriceRate">$0.00 per line</div>
              </div>
              <div class="row" style="margin-top:6px;">
                <div class="muted" style="flex:1;">Regulatory &amp; Admin Fees</div>
                <div class="muted" id="pd2RegFee">$5.99 per line</div>
              </div>
              <div class="row" style="margin-top:6px;">
                <div class="muted" style="flex:1;">Estimated Taxes</div>
                <div class="muted" id="pd2Tax">~ 6% of base rate</div>
              </div>
              <div class="divider" style="margin:8px 0;"></div>
              <div class="row" style="margin-top:0;">
                <div class="muted" style="flex:1;">Total Estimated Monthly Bill</div>
                <div class="plan" id="pd2Total">$0.00</div>
              </div>
              <div class="divider" style="margin:8px 0;"></div>
              <div class="row" style="margin-top:0;">
                <div class="muted" style="flex:1;">One‚ÄëTime Activation Fee</div>
                <div class="muted" id="pd2ActFee">$35.00 per line</div>
              </div>
              <div class="row" style="margin-top:6px;">
                <div class="muted" style="flex:1;">Installation Fee</div>
                <div class="muted" id="pd2Install">Setup is free</div>
              </div>
            </article>
          </div>
          <div class="sticky" style="flex-direction:column; gap:8px; align-items:stretch;">
            <button class="cta" style="flex:0 0 auto" onclick="goto('screen-review-2')">Activate this plan</button>
            <div class="center"><span class="link link-sm" role="button" tabindex="0" onclick="goto('screen-results-reco-2')">View Other Plans</span></div>
          </div>
        </section>
        <!-- Review Your Plan (Duplicate) -->
        <section id="screen-review-2" class="screen" aria-labelledby="review-title-2">
          <header id="review-title-2" style="font-weight:700; padding:12px 20px 8px; color:#401075; display:flex; align-items:center; justify-content:center; position:relative; background:url('./assets/GradientBackground.svg') center / cover no-repeat;">
            <span role="button" tabindex="0" onclick="goto('screen-results-reco-2')" style="position:absolute; left:20px; cursor:pointer;">‚Üê</span>
            <span>Review Your Plan</span>
          </header>
          <div class="content" style="padding-top:0;">
            <div class="address-top" style="padding-top:8px; padding-bottom:12px; margin-bottom:12px; margin-left:-20px; margin-right:-20px; padding-left:20px; padding-right:20px;">
              <article class="card" role="article" aria-label="Top pick product (duplicate)" style="background:#fff;">
                <div class="row" style="align-items:center; justify-content:space-between; margin-top:4px;">
                  <div class="plan" style="font-size:18px; color:#401075; font-weight:700;">Fiber Pro Giga Plan</div>
                  <span class="pill pill-high">Highly Recommended</span>
                </div>
                <div class="price" style="font-size:20px; margin:4px 0; color:#000000;">$75.00 <span class="muted" style="color:#000000;">/month</span></div>
                <ul class="feat" style="margin-top:6px; color:#000000; padding-left:18px;">
                  <li>Roaming allowance: Domestic</li>
                  <li>Hotspot: 5 GB</li>
                  <li>Speed: 200‚Äì300 Mbps</li>
                </ul>
                <div class="row" style="align-items:center; gap:8px; margin-top:6px;">
                  <span class="pill" style="background:#ffffff;">Promo: Essential plan</span>
                </div>
                <div class="muted" style="margin-top:6px; color:#000000;">üë• 40 people bought this plan in your area</div>
              </article>
            </div>
            <div class="plan" style="margin:8px 0 6px; font-size:16px;">Plan Details</div>
            <article class="card" style="margin-top:6px;">
              <div class="row" style="margin-top:0; align-items:center;">
                <div style="flex:0 0 20px; text-align:center;">üîÑ</div>
                <div class="muted" style="flex:1;">Download/Upload Speed</div>
                <div class="plan" style="font-size:13px; flex:0 0 auto; text-align:right; white-space:nowrap;">‚Äî</div>
              </div>
              <div class="row" style="margin-top:6px; align-items:center;">
                <div style="flex:0 0 20px; text-align:center;">‚ôæÔ∏è</div>
                <div class="muted" style="flex:1;">Data Cap</div>
                <div class="plan" style="font-size:13px; flex:0 0 auto; text-align:right; white-space:nowrap;">Unlimited</div>
              </div>
              <div class="row" style="margin-top:6px; align-items:center;">
                <div style="flex:0 0 20px; text-align:center;">üì°</div>
                <div class="muted" style="flex:1;">Included Hardware</div>
                <div class="plan" style="font-size:13px; color:#1a7f3c; flex:0 0 auto; text-align:right; white-space:nowrap;">Free Wi‚ÄëFi 6 Router</div>
              </div>
            </article>
            <div class="plan" style="margin:14px 0 6px; font-size:16px;">Customize Your Plan</div>
            <article class="card" style="margin-top:6px;">
              <div class="row" style="align-items:center;">
                <div style="flex:0 0 20px; text-align:center;">üõ°Ô∏è</div>
                <div style="flex:1;">
                  <div class="plan" style="font-size:14px;">Enhanced Security</div>
                  <div class="muted">+ $5.00 / mo</div>
                </div>
                <input id="rv2AddSec" type="checkbox" onchange="computeReviewTotals2()" style="width:18px; height:18px;" />
              </div>
              <div class="divider" style="margin:8px 0;"></div>
              <div class="row" style="align-items:center;">
                <div style="flex:0 0 20px; text-align:center;">üåê</div>
                <div style="flex:1;">
                  <div class="plan" style="font-size:14px;">Static IP Address</div>
                  <div class="muted">+ $10.00 / mo</div>
                </div>
                <input id="rv2AddIp" type="checkbox" onchange="computeReviewTotals2()" style="width:18px; height:18px;" />
              </div>
            </article>
            <div class="plan" style="margin:14px 0 6px; font-size:16px;">Pricing Details</div>
            <article class="card" style="margin-top:6px;">
              <div class="row" style="margin-top:0;">
                <div class="muted" style="flex:1;">Base Plan</div>
                <div class="plan" id="rv2Base">$0.00</div>
              </div>
              <div class="row" style="margin-top:6px;">
                <div class="muted" style="flex:1;">Enhanced Security</div>
                <div class="muted" id="rv2Sec">$0.00</div>
              </div>
              <div class="row" style="margin-top:6px;">
                <div class="muted" style="flex:1;">Installation Fee</div>
                <div class="muted" id="rv2Inst">$50.00</div>
              </div>
              <div class="divider" style="margin:8px 0;"></div>
              <div class="row" style="margin-top:0;">
                <div class="plan" style="flex:1;">Total Monthly</div>
                <div class="plan" id="rv2Monthly">$0.00</div>
              </div>
              <div class="row" style="margin-top:6px;">
                <div class="plan" style="flex:1;">Total Due Today</div>
                <div class="plan" id="rv2DueToday">$50.00</div>
              </div>
            </article>
          </div>
          <div class="sticky" style="flex-direction:column; gap:8px; align-items:stretch;">
            <button class="cta" style="flex:0 0 auto" onclick="openCheckout()">Confirm &amp; Proceed to Payment</button>
          </div>
        </section>
        <!-- Welcome (First Step - Duplicate for Persona flow) -->
        <section id="screen-welcome-2" class="screen" aria-labelledby="welcome2-title">
          <div class="welcome-top" style="position:relative;">
            <div class="dots" aria-hidden="true"><span class="dot"></span><span class="dot active"></span><span class="dot"></span></div>
            <div class="hero" aria-hidden="true">
              <img src="./assets/search-perfect-plan.svg" alt="Welcome icon" style="display:block; width:104px; height:104px; border-radius:52px; box-shadow:2px 6px 18px rgba(64,16,117,.35);" />
            </div>
            <header id="welcome2-title" class="center" style="font-size:30px; line-height:1.25; padding-top:0; padding-bottom:2px; margin:0; color:#401075;">Let's find your perfect plan!</header>
            <p class="muted center" style="margin:4px 20px 24px; line-height:1.4; font-size:18px; color:#ffffff;">
              We analysed your priorities so we can recommend the ideal plan for you
            </p>
          </div>
          <div class="content" style="padding-top:24px;">
            <!-- Section 1: Top Priority Need -->
            <div>
              <div class="section-title">Your Top Priority <span class="req" aria-hidden="true">*</span></div>
              <div class="section-sub">Priority based on your persona in the order of importance</div>
              <div class="toolbar" id="priorityGroup2" role="group" aria-label="Top priority need">
                <span class="chip chip-toggle" onclick="selectTopPriority(this,'Speed')">Speed</span>
                <span class="chip chip-toggle" onclick="selectTopPriority(this,'Roaming')">Roaming</span>
                <span class="chip chip-toggle" onclick="selectTopPriority(this,'Budget')">Budget</span>
                <span class="chip chip-toggle" onclick="selectTopPriority(this,'Flexibility')">Flexibility</span>
                <span class="chip chip-toggle" onclick="selectTopPriority(this,'Coverage')">Coverage</span>
                <span class="chip chip-toggle" onclick="selectTopPriority(this,'Data allowance')">Data allowance</span>
                <span class="chip chip-toggle" onclick="selectTopPriority(this,'Reliability')">Reliability</span>
                <span class="chip chip-toggle" onclick="selectTopPriority(this,'Device Benefits')">Device Benefits</span>
              </div>
              <div class="divider"></div>
            </div>
            <!-- Section 2: Suggested plan type -->
            <div style="margin-top:18px;">
              <div class="section-title">Your Suggested plan type <span class="req" aria-hidden="true">*</span></div>
              <div class="section-sub">Type of plan suitable for your persona</div>
              <div class="toolbar" id="preferenceGroup2" role="radiogroup" aria-label="Product preference">
                <span class="chip chip-toggle" onclick="selectProductPref(this,'Prepaid')">Prepaid</span>
                <span class="chip chip-toggle" onclick="selectProductPref(this,'Postpaid')">Postpaid</span>
                <span class="chip chip-toggle" onclick="selectProductPref(this,'Fixed Wireless')">Fixed Wireless</span>
              </div>
              <div class="divider"></div>
            </div>
            <!-- Section 3: Recommended add-ons -->
            <div style="margin-top:18px;">
              <div class="section-title">Recommended add‚Äëons <span class="req" aria-hidden="true">*</span></div>
              <div id="addonsContainer2" style="display:flex; flex-direction:column; gap:8px; margin-top:6px;"></div>
              <div class="divider"></div>
              <div class="muted" style="margin-top:6px;">Edit preferences based on your needs</div>
            </div>
          </div>
          <div class="sticky" style="flex-direction:column; gap:8px; align-items:stretch;">
            <button id="welcomeCta2" class="cta cta-lg btn-disabled" style="flex:0 0 auto" onclick="welcomeFindPlansDup()">Find plans near me</button>
            <button class="cta-secondary" style="width:100%;" onclick="goto('screen-persona')">Back</button>
          </div>
        </section>
        <!-- Persona (between Intro and Welcome) - restored -->
        <section id="screen-persona" class="screen" aria-labelledby="persona-title">
          <div class="welcome-top" style="position:relative;">
            <div class="dots" aria-hidden="true">
              <span class="dot active"></span>
              <span class="dot"></span>
              <span class="dot"></span>
            </div>
            <div class="hero" aria-hidden="true" style="margin:16px auto 10px;">
              <img id="personaHero" src="./assets/persona-hero.svg" alt="Persona hero" style="display:block; width:100%; margin-top max-width:520px; height:auto;" />
            </div>
            <header id="persona-title" class="center" style="font-size:32px; color:#401075; font-weight:600; line-height:1.25; padding:0; margin:20px 0 6px; color:#401075;">Find your persona!</header>
            <p class="muted center" style="margin:4px 20px 14px; line-height:1.4; font-size:20px; color:#ffffff !important;">
              Pick one and we‚Äôll pre-fill the best plan options for your needs
            </p>
          </div>
          <div class="content" style="padding-top:12px;">
            <div style="width:95%; max-width:560px; margin:0 auto; display:flex; flex-direction:column; gap:18px;">
              <!-- Example cards -->
              <article class="card persona-card" role="button" tabindex="0" onclick="selectPersona(this,'Everyday Connect')" style="background:#ffffff; border-color:var(--line); box-shadow:none; display:flex; align-items:center; gap:25px;">
                <div style="width:120px; height:120px; border-radius:12px; background:#e9ecf4; flex:0 0 auto; display:flex; align-items:center; justify-content:center; overflow:hidden;">
                  <img src="./assets/everyday-user.svg" alt="Everyday user" style="width:100%; height:100%; object-fit:contain; padding:10px;" />
                </div>
                <div style="display:flex; flex-direction:column;">
                  <div class="plan" style="color:#401075; font-weight:700; font-size:18px; margin-bottom:3px;">Everyday Connect</div>
                  <div style="color:#5A1BA9; font-size:14px; margin:4px 0 6px; font-weight:500; font-style:oblique;"> "I‚Äôm someone who just needs simple, reliable everyday use" </div>
                </div>
              </article>
              <article class="card persona-card" role="button" tabindex="0" onclick="selectPersona(this,'Work & Travel')" style="background:#ffffff; border-color:var(--line); box-shadow:none; display:flex; align-items:center; gap:25px;">
                <div style="width:120px; height:120px; border-radius:12px; background:#e9ecf4; flex:0 0 auto; display:flex; align-items:center; justify-content:center; overflow:hidden;">
                  <img src="./assets/work-travel.svg" alt="Work and travel" style="width:100%; height:100%; object-fit:contain; padding:10px;" />
                </div>
                <div style="display:flex; flex-direction:column;">
                  <div class="plan" style="color:#401075; font-weight:700; font-size:18px; margin-bottom:3px;">Work & Travel</div>
                  <div style="color:#5A1BA9; font-size:14px; margin:4px 0 6px; font-weight:500; font-style:oblique;"> "I‚Äôm someone who works on the go and travels often" </div>
                </div>
              </article>
              <!-- Card 3 -->
              <article class="card persona-card" role="button" tabindex="0" onclick="selectPersona(this,'Family Group')" style="background:#ffffff; border-color:var(--line); box-shadow:none; display:flex; align-items:center; gap:25px;">
                <div style="width:120px; height:120px; border-radius:12px; background:#e9ecf4; flex:0 0 auto; display:flex; align-items:center; justify-content:center; overflow:hidden;">
                  <img src="./assets/family-user.svg" alt="Family group" style="width:100%; height:100%; object-fit:contain; padding:10px;" />
                </div>
                <div style="display:flex; flex-direction:column;">
                  <div class="plan" style="color:#401075; font-weight:700; font-size:18px; margin-bottom:3px;">Family Group</div>
                  <div style="color:#5A1BA9; font-size:14px; margin:4px 0 6px; font-weight:500; font-style:oblique;"> "I‚Äôm managing plans for my family or multiple connections" </div>
                </div>
              </article>
              <!-- Card 4 -->
              <article class="card persona-card" role="button" tabindex="0" onclick="selectPersona(this,'Power Streamer')" style="background:#ffffff; border-color:var(--line); box-shadow:none; display:flex; align-items:center; gap:25px;">
                <div style="width:120px; height:120px; border-radius:12px; background:#e9ecf4; flex:0 0 auto; display:flex; align-items:center; justify-content:center; overflow:hidden;">
                  <img src="./assets/game-power-user.svg" alt="Gamer or power user" style="width:100%; height:100%; object-fit:contain; padding:10px;" />
                </div>
                <div style="display:flex; flex-direction:column;">
                  <div class="plan" style="color:#401075; font-weight:700; font-size:18px; margin-bottom:3px;">Power Streamer</div>
                  <div style="color:#5A1BA9; font-size:14px; margin:4px 0 6px; font-weight:500; font-style:oblique;"> "I‚Äôm someone who games, streams, or uses a lot of data" </div>
                </div>
              </article>
              <!-- Card 5 -->
              <article class="card persona-card" role="button" tabindex="0" onclick="selectPersona(this,'Entertainment Lover')" style="background:#ffffff; border-color:var(--line); box-shadow:none; display:flex; align-items:center; gap:25px;">
                <div style="width:120px; height:120px; border-radius:12px; background:#e9ecf4; flex:0 0 auto; display:flex; align-items:center; justify-content:center; overflow:hidden;">
                  <img src="./assets/entertainment-user.svg" alt="Entertainment lover" style="width:100%; height:100%; object-fit:contain; padding:10px;" />
                </div>
                <div style="display:flex; flex-direction:column;">
                  <div class="plan" style="color:#401075; font-weight:700; font-size:18px; margin-bottom:3px;">Entertainment Lover</div>
                  <div style="color:#5A1BA9; font-size:14px; margin:4px 0 6px; font-weight:500; font-style:oblique;"> "I‚Äôm someone who streams movies, shows, and sports all the time" </div>
                </div>
              </article>
              <!-- Card 6 -->
              <article class="card persona-card" role="button" tabindex="0" onclick="selectPersona(this,'Budget Maximiser')" style="background:#ffffff; border-color:var(--line); box-shadow:none; display:flex; align-items:center; gap:25px;">
                <div style="width:120px; height:120px; border-radius:12px; background:#e9ecf4; flex:0 0 auto; display:flex; align-items:center; justify-content:center; overflow:hidden;">
                  <img src="./assets/budget-maximiser.svg" alt="Budget maximiser" style="width:100%; height:100%; object-fit:contain; padding:10px;" />
                </div>
                <div style="display:flex; flex-direction:column;">
                  <div class="plan" style="color:#401075; font-weight:700; font-size:18px; margin-bottom:3px;">Budget Maximiser</div>
                  <div style="color:#5A1BA9; font-size:14px; margin:4px 0 6px; font-weight:500; font-style:oblique;"> "I want the best value at the lowest cost" </div>
                </div>
              </article>
              <article class="card persona-card" role="button" tabindex="0" onclick="selectPersona(this,'Let me Explore!'); openAISheet2(); return false;" style="background:#ffffff; border-color:var(--line); box-shadow:none; display:flex; align-items:center; justify-content:center; gap:25px;">
                <div style="display:flex; flex-direction:column; align-items:center; text-align:center; width:100%;">
                  <div class="plan" style="color:#401075; font-weight:700; font-size:18px; margin-bottom:3px;">Let me Explore!</div>
                  <div style="color:#5A1BA9; font-size:14px; margin:4px 0 6px; font-weight:500; font-style:oblique;"> "I‚Äôm different ‚Äî help me identify my ideal persona" </div>
                </div>
              </article>
            </div>
          </div>
          <div class="sticky" style="flex-direction:column; gap:8px; align-items:stretch;">
            <button id="personaContinueBtn" class="cta cta-lg btn-disabled" style="flex:0 0 auto" onclick="goto('screen-welcome-2')">Continue</button>
            <div class="center"><span class="link link-sm" role="button" tabindex="0" onclick="goto('screen-welcome-2')">Skip for now</span></div>
          </div>
        </section>
        <!-- Welcome (First Step) -->
        <section id="screen-welcome" class="screen" aria-labelledby="welcome-title">
          <div class="welcome-top">
            <div class="dots" aria-hidden="true"><span class="dot active"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span></div>
            <div class="hero" aria-hidden="true">
              <img id="welcomeIcon" src="./assets/Welcome-icon.svg" alt="Welcome icon" style="display:block; width:104px; height:104px; border-radius:52px; box-shadow:2px 6px 18px rgba(64,16,117,.35);" />
            </div>
            <header id="welcome-title" class="center" style="font-size:30px; line-height:1.25; padding-top:0; padding-bottom:2px; margin:0; color:#401075;">Let's find your<br/>perfect plan!</header>
            <p class="muted center" style="margin:4px 20px 24px; line-height:1.4; font-size:18px; color:#ffffff;">
              Help us understand your priorities so we can recommend the ideal plan
            </p>
          </div>
          <div class="content" style="padding-top:36px;">
            <!-- Section 1: Top Priority Need -->
            <div>
              <div class="section-title">Your Top Priority Need<span class="req" aria-hidden="true">*</span></div>
              <div class="section-sub">Tell us your primary need in the order of importance</div>
              <div class="toolbar" id="priorityGroup1" role="group" aria-label="Top priority need">
                <span class="chip chip-toggle" onclick="selectTopPriority(this,'Faster Speed')">Faster Speed</span>
                <span class="chip chip-toggle" onclick="selectTopPriority(this,'Better Coverage')">Better Coverage</span>
                <span class="chip chip-toggle" onclick="selectTopPriority(this,'More Data')">More Data</span>
                <span class="chip chip-toggle" onclick="selectTopPriority(this,'Lower Price')">Lower Price</span>
              </div>
              <div class="divider"></div>
            </div>
            <!-- (moved Abandoned Cart section to Explore Offers) -->

            <!-- Section 2: Product Preference -->
            <div style="margin-top:18px;">
              <div class="section-title">Your Product Preference<span class="req" aria-hidden="true">*</span></div>
              <div class="section-sub">Which type of plan are you considering?</div>
              <div class="toolbar" id="preferenceGroup" role="radiogroup" aria-label="Product preference">
                <span class="chip chip-toggle" onclick="selectProductPref(this,'Family Plan')">Family Plan</span>
                <span class="chip chip-toggle" onclick="selectProductPref(this,'Home Bundles')">Home Bundles</span>
                <span class="chip chip-toggle" onclick="selectProductPref(this,'International Use')">International Use</span>
                <span class="chip chip-toggle" onclick="selectProductPref(this,'Solo Plan')">Solo Plan</span>
              </div>
              <div class="divider"></div>
            </div>

            <!-- Section 3: Product Affinity -->
            <div style="margin-top:18px;">
              <div class="section-title">Your Product Affinity</div>
              <label for="affinityNotes" class="section-sub" style="display:block;">Tell us a bit about your current situation:</label>
              <textarea id="affinityNotes" rows="3" placeholder="e.g., 'I stream a lot of 4K video,' 'My current provider is too slow,' 'I'm switching from [Competitor X]"></textarea>
            </div>
          </div>
          <div class="sticky" style="flex-direction:column; gap:8px; align-items:stretch;">
            <button id="welcomeCta" class="cta cta-lg btn-disabled" style="flex:0 0 auto" onclick="welcomeFindPlans()">Find my perfect plan</button>
            <div class="center">
              <span class="link link-sm" role="button" tabindex="0" onclick="goto('screen-lock')">Go to Dashboard</span>
            </div>
          </div>
          <!-- Footer removed from welcome screen -->
        </section>
              <!-- Review Your Plan -->
        <section id="screen-review" class="screen" aria-labelledby="review-title">
          <header id="review-title" style="font-weight:700; padding:12px 20px 8px; color:#401075; display:flex; align-items:center; justify-content:center; position:relative; background:url('./assets/GradientBackground.svg') center / cover no-repeat;">
            <span role="button" tabindex="0" onclick="historyBackReview()" style="position:absolute; left:20px; cursor:pointer;">‚Üê</span>
            <span id="reviewTitleText">Review Your Plan</span>
          </header>
          <div class="content" style="padding-top:0;">
            <div class="address-top" style="padding-top:8px; padding-bottom:12px; margin-bottom:12px; margin-left:-20px; margin-right:-20px; padding-left:20px; padding-right:20px;">
              <article class="card" role="article" aria-label="Plan summary" style="background:#fff;">
                <div class="row" style="align-items:center; justify-content:flex-start; margin-top:4px;">
                  <div class="plan" id="rvName" style="font-size:18px; color:#401075; white-space:nowrap;">Plan Name</div>
                </div>
                <div class="row" style="align-items:center; justify-content:space-between; margin-top:4px;">
                  <div class="price" id="rvPrice" style="font-size:18px;">$0.00<span class="muted">/mo</span></div>
                  <span id="rvRecoPill" class="pill pill-high" aria-live="polite">Highly Recommended</span>
                </div>
                <div class="muted" id="rvDesc" style="margin-top:6px;">‚Äî</div>
                <div id="rvEta" class="muted" style="margin-top:4px;">Activation ETA: ‚Äî</div>
                <div class="muted" style="margin-top:4px;">üë• 40 people in your area bought this product in past 6 months</div>
                <span class="pill" style="margin-top:8px; width:max-content;">üîí Price Lock</span>
              </article>
            </div>
            <!-- Plan Details -->
            <div class="plan" style="margin:8px 0 6px; font-size:16px;">Plan Details</div>
            <article class="card" style="margin-top:6px;">
              <div class="row" style="margin-top:0; align-items:center;">
                <div style="flex:0 0 20px; text-align:center;">üîÑ</div>
                <div class="muted" style="flex:1;">Download/Upload Speed</div>
                <div class="plan" id="rvIncDownUp" style="font-size:13px; flex:0 0 auto; text-align:right; white-space:nowrap;">‚Äî</div>
              </div>
              <div class="row" style="margin-top:6px; align-items:center;">
                <div style="flex:0 0 20px; text-align:center;">‚ôæÔ∏è</div>
                <div class="muted" style="flex:1;">Data Cap</div>
                <div class="plan" id="rvAllowance" style="font-size:13px; flex:0 0 auto; text-align:right; white-space:nowrap;">Unlimited</div>
              </div>
              <div class="row" style="margin-top:6px; align-items:center;">
                <div style="flex:0 0 20px; text-align:center;">üì°</div>
                <div class="muted" style="flex:1;">Included Hardware</div>
                <div class="plan" id="rvEquipment" style="font-size:13px; color:#1a7f3c; flex:0 0 auto; text-align:right; white-space:nowrap;">Free Wi‚ÄëFi 6 Router</div>
              </div>
            </article>
            <!-- Customize -->
            <div class="plan" style="margin:14px 0 6px; font-size:16px;">Customize Your Plan</div>
            <article class="card" style="margin-top:6px;">
              <div class="row" style="align-items:center;">
                <div style="flex:0 0 20px; text-align:center;">üõ°Ô∏è</div>
                <div style="flex:1;">
                  <div class="plan" style="font-size:14px;">Enhanced Security</div>
                  <div class="muted">+ $5.00 / mo</div>
                </div>
                <input id="rvAddSec" type="checkbox" checked onchange="computeReviewTotals()" style="width:18px; height:18px;" />
              </div>
              <div class="divider" style="margin:8px 0;"></div>
              <div class="row" style="align-items:center;">
                <div style="flex:0 0 20px; text-align:center;">üåê</div>
                <div style="flex:1;">
                  <div class="plan" style="font-size:14px;">Static IP Address</div>
                  <div class="muted">+ $10.00 / mo</div>
                </div>
                <input id="rvAddIp" type="checkbox" onchange="computeReviewTotals()" style="width:18px; height:18px;" />
              </div>
            </article>
            <!-- Pricing Details -->
            <div class="plan" style="margin:14px 0 6px; font-size:16px;">Pricing Details</div>
            <article class="card" style="margin-top:6px;">
              <div class="row" style="margin-top:0;">
                <div class="muted" style="flex:1;">Base Plan</div>
                <div class="plan" id="rvBase">$0.00</div>
              </div>
              <div class="row" style="margin-top:6px;">
                <div class="muted" style="flex:1;">Enhanced Security</div>
                <div class="muted" id="rvSec">$0.00</div>
              </div>
              <div class="row" style="margin-top:6px;">
                <div class="muted" style="flex:1;">Installation Fee</div>
                <div class="muted" id="rvInst">$50.00</div>
              </div>
              <div class="divider" style="margin:8px 0;"></div>
              <div class="row" style="margin-top:0;">
                <div class="plan" style="flex:1;">Total Monthly</div>
                <div class="plan" id="rvMonthly">$0.00</div>
              </div>
              <div class="row" style="margin-top:6px;">
                <div class="plan" style="flex:1;">Total Due Today</div>
                <div class="plan" id="rvDueToday">$50.00</div>
              </div>
            </article>
          </div>
          <div class="sticky" style="flex-direction:column; gap:8px; align-items:stretch;">
            <button id="reviewConfirmBtn" class="cta" style="flex:0 0 auto" onclick="openCheckout()">Confirm &amp; Proceed to Payment</button>
          </div>
        </section>
        <!-- Checkout / Payment -->
        <section id="screen-checkout" class="screen" aria-labelledby="checkout-title">
          <header id="checkout-title" style="font-weight:700; padding:12px 20px 8px; color:#401075; display:flex; align-items:center; justify-content:center; position:relative; background:url('./assets/GradientBackground.svg') center / cover no-repeat;">
            <span role="button" tabindex="0" onclick="goto('screen-review')" style="position:absolute; left:20px; cursor:pointer;">‚Üê</span>
            <span>Checkout</span>
          </header>
          <div class="content" style="padding-top:0;">
            <div class="address-top" style="padding-top:8px; padding-bottom:12px; margin-bottom:12px; margin-left:-20px; margin-right:-20px; padding-left:20px; padding-right:20px;">
              <div class="plan" style="margin:8px 0 6px; font-size:16px;">Order Summary</div>
              <article class="card" style="background:#fff;">
                <div class="row" style="align-items:center;">
                  <div class="muted" id="coPlanName" style="flex:1;">Plan</div>
                  <div class="plan" id="coPlanPrice">$0.00<span class="muted">/mo</span></div>
                </div>
                <div class="row" style="align-items:center; margin-top:10px;">
                  <div class="muted" style="flex:1;">One‚Äëtime Installation Fee</div>
                  <div class="plan" id="coInstall">$0.00</div>
                </div>
                <div class="row" style="align-items:center; margin-top:10px;">
                  <div class="muted" style="flex:1;">Taxes &amp; Surcharges</div>
                  <div class="plan" id="coTaxes">$0.00</div>
                </div>
                <div class="divider" style="margin:10px 0;"></div>
                <div class="row" style="align-items:center;">
                  <div class="plan" style="flex:1;">Total Due Today</div>
                  <div class="plan" id="coDueToday">$0.00</div>
                </div>
              </article>
            </div>
            <div class="plan" style="margin:14px 0 6px; font-size:16px;">Payment Method</div>
            <div class="row" role="tablist" aria-label="Payment method" style="gap:10px;">
              <button id="tabCard" class="cta-secondary" role="tab" aria-selected="true" style="flex:1; font-weight:700;">Credit/Debit Card</button>
              <button id="tabPayPal" class="cta-secondary" role="tab" aria-selected="false" style="flex:1; opacity:.6; pointer-events:none;">PayPal</button>
            </div>
            <article class="card" style="margin-top:10px;">
              <label class="subtle" for="coCardNum" style="display:block;">Card Number</label>
              <input id="coCardNum" type="text" inputmode="numeric" placeholder="0000 0000 0000 0000" />
              <div class="row" style="margin-top:8px;">
                <div>
                  <label class="subtle" for="coExp">Expiry Date</label>
                  <input id="coExp" type="text" placeholder="MM/YY" />
                </div>
                <div>
                  <label class="subtle" for="coCvc">CVC</label>
                  <input id="coCvc" type="text" placeholder="123" />
                </div>
              </div>
              <div style="margin-top:8px;">
                <label class="subtle" for="coName" style="display:block;">Name on Card</label>
                <input id="coName" type="text" placeholder="John Doe" />
              </div>
              <div style="margin-top:8px;">
                <label style="display:flex; align-items:center; gap:8px;">
                  <input id="coSave" type="checkbox" /> <span class="muted">Save card for future payments</span>
                </label>
              </div>
              <div class="card" style="background:#eaf1ff; border-color:#cfe0ff; margin-top:10px;">
                <span class="muted" style="font-weight:600;">Secure SSL Encryption</span>
              </div>
              <div style="margin-top:10px;">
                <label style="display:flex; align-items:center; gap:8px;">
                  <input id="coAgree" type="checkbox" /> <span class="muted">I agree to the <span class="link">Terms &amp; Conditions</span> and <span class="link">Privacy Policy</span>.</span>
                </label>
              </div>
            </article>
          </div>
          <div class="sticky" style="flex-direction:column; gap:8px; align-items:stretch;">
            <button id="coPayBtn" class="cta" style="flex:0 0 auto" onclick="openSuccess()">Pay &amp; Activate Plan</button>
          </div>
        </section>
        <!-- Checkout / Payment (Upgrade) -->
        <section id="screen-checkout-upgrade" class="screen" aria-labelledby="checkout-title-upgrade">
          <header id="checkout-title-upgrade" style="font-weight:700; padding:12px 20px 8px; color:#401075; display:flex; align-items:center; justify-content:center; position:relative; background:url('./assets/GradientBackground.svg') center / cover no-repeat;">
            <span role="button" tabindex="0" onclick="goto('screen-review')" style="position:absolute; left:20px; cursor:pointer;">‚Üê</span>
            <span>Checkout Upgrade Plan</span>
          </header>
          <div class="content" style="padding-top:0;">
            <div class="address-top" style="padding-top:8px; padding-bottom:12px; margin-bottom:12px; margin-left:-20px; margin-right:-20px; padding-left:20px; padding-right:20px;">
              <div class="plan" style="margin:8px 0 6px; font-size:16px;">Order Summary</div>
              <article class="card" style="background:#fff;">
                <div class="row" style="align-items:center;">
                  <div class="muted" id="coPlanNameUp" style="flex:1;">Plan</div>
                  <div class="plan" id="coPlanPriceUp">$0.00<span class="muted">/mo</span></div>
                </div>
                <div class="row" style="align-items:center; margin-top:10px;">
                  <div class="muted" style="flex:1;">One‚Äëtime Installation Fee</div>
                  <div class="plan" id="coInstallUp">$0.00</div>
                </div>
                <div class="row" style="align-items:center; margin-top:10px;">
                  <div class="muted" style="flex:1;">Taxes &amp; Surcharges</div>
                  <div class="plan" id="coTaxesUp">$0.00</div>
                </div>
                <div class="divider" style="margin:10px 0;"></div>
                <div class="row" style="align-items:center;">
                  <div class="plan" style="flex:1;">Total Due Today</div>
                  <div class="plan" id="coDueTodayUp">$0.00</div>
                </div>
              </article>
            </div>
            <div class="plan" style="margin:14px 0 6px; font-size:16px;">Payment Method</div>
            <div class="row" role="tablist" aria-label="Payment method" style="gap:10px;">
              <button class="cta-secondary" role="tab" aria-selected="true" style="flex:1; font-weight:700;">Credit/Debit Card</button>
              <button class="cta-secondary" role="tab" aria-selected="false" style="flex:1; opacity:.6; pointer-events:none;">PayPal</button>
            </div>
            <article class="card" style="margin-top:10px;">
              <label class="subtle" style="display:block;">Card Number</label>
              <input type="text" inputmode="numeric" placeholder="0000 0000 0000 0000" />
              <div class="row" style="margin-top:8px;">
                <div>
                  <label class="subtle" style="display:block;">Expiry Date</label>
                  <input type="text" placeholder="MM/YY" />
                </div>
                <div>
                  <label class="subtle" style="display:block;">CVC</label>
                  <input type="text" placeholder="123" />
                </div>
              </div>
              <div style="margin-top:8px;">
                <label class="subtle" style="display:block;">Name on Card</label>
                <input type="text" placeholder="John Doe" />
              </div>
            </article>
          </div>
          <div class="sticky" style="flex-direction:column; gap:8px; align-items:stretch;">
            <button id="coPayBtnUp" class="cta" style="flex:0 0 auto" onclick="openSuccess()">Pay &amp; Upgrade Plan</button>
          </div>
        </section>
        <!-- Success / You're All Set -->
        <section id="screen-success" class="screen" aria-labelledby="success-title">
          <div class="address-top" style="padding-top:10px; padding-bottom:8px; min-height:34vh; display:flex; flex-direction:column; align-items:center; justify-content:center;">
            <img src="./assets/sucess-icon.svg" alt="Success" style="width:104px; height:104px; margin:12px auto 30px; display:block; box-shadow:2px 6px 18px rgba(64,16,117,.35); border-radius:52px;" />
            <h1 id="success-title" class="display-h1" style="font-size:30px; color:#401075; font-weight:800; line-height:1.25; margin:0; padding-bottom:2px; text-align:center;">You're All Set!</h1>
            <p class="subhead" id="success-sub" style="margin:6px 16px 10px; line-height:1.4; font-size:18px; text-align:center;">Your is active! <br/> Welcome aboard</p>
          </div>
          <div class="content" style="padding-top:8px;">
            <div class="plan" style="margin:8px 0 6px; font-size:16px;">Plan Details</div>
            <article class="card" style="margin-top:6px;">
              <div class="row" style="margin-top:0;">
                <div class="muted" style="flex:1;">Plan:</div>
                <div class="plan" id="suPlan">‚Äî</div>
              </div>
              <div class="row" style="margin-top:6px;">
                <div class="muted" style="flex:1;">Speed:</div>
                <div class="plan" id="suSpeed">‚Äî</div>
              </div>
              <div class="row" style="margin-top:6px;">
                <div class="muted" style="flex:1;">Activation Date:</div>
                <div class="plan" id="suActivation">‚Äî</div>
              </div>
              <div class="row" style="margin-top:6px;">
                <div class="muted" style="flex:1;">First Bill Date:</div>
                <div class="plan" id="suFirstBill">‚Äî</div>
              </div>
            </article>
            <div class="plan" style="margin:14px 0 6px; font-size:16px;">Feedback</div>
            <article class="card" style="margin-top:6px; padding:12px;">
              <div class="plan" style="font-size:16px; text-align:center; margin:0 0 6px;">How was your activation experience?</div>
              <div id="suStars" class="center" role="group" aria-label="Rate your activation experience"
                   style="font-size:22px; letter-spacing:4px; color:#f59e0b; margin:2px 0 8px;">
                <span class="star" role="button" tabindex="0" aria-label="1 star"
                      style="cursor:pointer; padding:0 4px;"
                      onclick="setStarRating(1)"
                      onkeydown="if(event.key==='Enter'||event.key===' '){setStarRating(1);event.preventDefault();}">‚òÜ</span>
                <span class="star" role="button" tabindex="0" aria-label="2 stars"
                      style="cursor:pointer; padding:0 4px;"
                      onclick="setStarRating(2)"
                      onkeydown="if(event.key==='Enter'||event.key===' '){setStarRating(2);event.preventDefault();}">‚òÜ</span>
                <span class="star" role="button" tabindex="0" aria-label="3 stars"
                      style="cursor:pointer; padding:0 4px;"
                      onclick="setStarRating(3)"
                      onkeydown="if(event.key==='Enter'||event.key===' '){setStarRating(3);event.preventDefault();}">‚òÜ</span>
                <span class="star" role="button" tabindex="0" aria-label="4 stars"
                      style="cursor:pointer; padding:0 4px;"
                      onclick="setStarRating(4)"
                      onkeydown="if(event.key==='Enter'||event.key===' '){setStarRating(4);event.preventDefault();}">‚òÜ</span>
                <span class="star" role="button" tabindex="0" aria-label="5 stars"
                      style="cursor:pointer; padding:0 4px;"
                      onclick="setStarRating(5)"
                      onkeydown="if(event.key==='Enter'||event.key===' '){setStarRating(5);event.preventDefault();}">‚òÜ</span>
              </div>
              <textarea rows="4" placeholder="Tell us more (optional)‚Ä¶" style="width:100%; margin-top:6px;"></textarea>
            </article>
          </div>
          <div class="sticky" style="flex-direction:column; gap:8px; align-items:stretch;">
            <button class="cta" style="flex:0 0 auto" onclick="goto('screen-intro')">Submit Feedback</button>
            <div class="center"><span class="link link-sm" role="button" tabindex="0" onclick="goto('screen-lock')">Go to Dashboard</span></div>
          </div>
        </section>
        <!-- Success / Upgrade Outcome -->
        <section id="screen-success-upgrade" class="screen" aria-labelledby="success-title-up">
          <div class="address-top" style="padding-top:10px; padding-bottom:8px; min-height:34vh; display:flex; flex-direction:column; align-items:center; justify-content:center;">
            <img src="./assets/sucess-icon.svg" alt="Success" style="width:104px; height:104px; margin:12px auto 30px; display:block; box-shadow:2px 6px 18px rgba(64,16,117,.35); border-radius:52px;" />
            <h1 id="success-title-up" class="display-h1" style="font-size:30px; color:#401075; font-weight:800; line-height:1.25; margin:0; padding-bottom:2px; text-align:center;">Congratulations!</h1>
            <p class="subhead" id="success-sub-up" style="margin:6px 16px 10px; line-height:1.4; font-size:18px; text-align:center;">We've processed your upgrade request. You'll see the change reflected on your next bill</p>
          </div>
          <div class="content" style="padding-top:8px;">
            <div class="plan" style="margin:8px 0 6px; font-size:16px;">Plan Details</div>
            <article class="card" style="margin-top:6px;">
              <div class="row" style="margin-top:0;">
                <div class="muted" style="flex:1;">Previous Plan</div>
                <div class="plan" id="suUpPrev">‚Äî</div>
              </div>
              <div class="row" style="margin-top:6px;">
                <div class="muted" style="flex:1;">New Plan</div>
                <div class="plan" id="suUpNew">‚Äî</div>
              </div>
              <div class="row" style="margin-top:6px;">
                <div class="muted" style="flex:1;">Effective Date</div>
                <div class="plan" id="suUpEffective">‚Äî</div>
              </div>
            </article>
            <div class="plan" style="margin:14px 0 6px; font-size:16px;">Feedback</div>
            <article class="card" style="margin-top:6px; padding:12px;">
              <div class="plan" style="font-size:16px; text-align:center; margin:0 0 6px;">Was this recommendation helpful?</div>
              <div id="suUpStars" class="center" role="group" aria-label="Rate recommendation" style="font-size:22px; letter-spacing:4px; color:#f59e0b; margin:2px 0 6px;">
                <span class="star" role="button" tabindex="0" aria-label="1 star" style="cursor:pointer; padding:0 4px;"
                      onclick="setStarRatingUp(1)" onkeydown="if(event.key==='Enter'||event.key===' '){setStarRatingUp(1);event.preventDefault();}">‚òÜ</span>
                <span class="star" role="button" tabindex="0" aria-label="2 stars" style="cursor:pointer; padding:0 4px;"
                      onclick="setStarRatingUp(2)" onkeydown="if(event.key==='Enter'||event.key===' '){setStarRatingUp(2);event.preventDefault();}">‚òÜ</span>
                <span class="star" role="button" tabindex="0" aria-label="3 stars" style="cursor:pointer; padding:0 4px;"
                      onclick="setStarRatingUp(3)" onkeydown="if(event.key==='Enter'||event.key===' '){setStarRatingUp(3);event.preventDefault();}">‚òÜ</span>
                <span class="star" role="button" tabindex="0" aria-label="4 stars" style="cursor:pointer; padding:0 4px;"
                      onclick="setStarRatingUp(4)" onkeydown="if(event.key==='Enter'||event.key===' '){setStarRatingUp(4);event.preventDefault();}">‚òÜ</span>
                <span class="star" role="button" tabindex="0" aria-label="5 stars" style="cursor:pointer; padding:0 4px;"
                      onclick="setStarRatingUp(5)" onkeydown="if(event.key==='Enter'||event.key===' '){setStarRatingUp(5);event.preventDefault();}">‚òÜ</span>
              </div>
              <div class="divider" style="margin:6px 0;"></div>
              <div class="plan" style="font-size:14px; margin:4px 0 4px;">Tell us more (optional)</div>
              <div class="toolbar" id="upFeedbackChips" style="gap:8px; flex-wrap:wrap;">
                <span class="chip chip-toggle" onclick="toggleUpFeedbackChip(this)">Easy to understand</span>
                <span class="chip chip-toggle" onclick="toggleUpFeedbackChip(this)">Good Value</span>
                <span class="chip chip-toggle" onclick="toggleUpFeedbackChip(this)">Perfect Fit</span>
                <span class="chip chip-toggle" onclick="toggleUpFeedbackChip(this)">Not Relevant</span>
                <span class="chip chip-toggle" onclick="toggleUpFeedbackChip(this)">Too Expensive</span>
                <span class="chip chip-toggle" onclick="toggleUpFeedbackChip(this)">Confusing</span>
              </div>
            </article>
          </div>
          <div class="sticky" style="flex-direction:column; gap:8px; align-items:stretch;">
            <button class="cta" style="flex:0 0 auto" onclick="goto('screen-lock')">Submit Feedback &amp; Go to Dashboard</button>
            <div class="center"><span class="link link-sm" role="button" tabindex="0" onclick="goto('screen-lock')">Need Help? Contact Support</span></div>
          </div>
        </section>

        <!-- Address (Duplicate for Persona flow) -->
        <section id="screen-address-2" class="screen" aria-labelledby="address-title2">
          <div class="address-top">
            <div class="dots" aria-hidden="true"><span class="dot"></span><span class="dot"></span><span class="dot active"></span></div>
            <div class="hero-address" aria-hidden="true" style="width:104px; height:104px; border-radius:52px; box-shadow:0px 0px 0px rgba(64,16,117,.35); margin:50px auto 8px; display:flex; align-items:center; justify-content:center;">
              <img id="addressIcon2" src="./assets/address-icon.svg" alt="Address verification icon" style="width:104px; height:104px; border-radius:52px; margin-top:160px; margin-bottom:80px; "  />
            </div>
            <h1 id="address-title2" class="display-h1" style="font-size:30px; font-weight:600; line-height:1.25; margin:0; padding-bottom:2px; margin-top:100px; margin-bottom:30px; color:#401075;">Let's check<br/>what's available for you!</h1>
            <p class="subhead" style="margin:4px 20px 24px; line-height:1.4; font-size:18px; margin-bottom:30px;">A fast location check to confirm coverage strength and plan eligibility</p>
          </div>
          <div class="content" style="padding-top:0;">
            <div>
              <label class="section-title" for="door2" style="display:block; margin-top:8px;">Postal Code / Address<span class="req" aria-hidden="true">*</span></label>
              <input id="door2" type="text" required aria-required="true" placeholder="Enter postal code / address" oninput="onAddressInputChange()" onkeydown="onEnterVerify(event)" style="width:100%; margin-left:auto; margin-right:auto; margin-top:10px;" />
              <div style="margin-top:10px;">
                <button id="useLocationBtn2" class="cta-secondary" style="width:100%;" onclick="useCurrentAddress()">Auto-detect location</button>
              </div>
              <div class="center muted" style="margin-top:15px; margin-bottom:20px; font-size:12px;">
                We only use location to show eligible plans
              </div>
              <!-- Inline feasibility check -->
              <div id="addrFilledDivider2" class="divider hidden" style="margin-top:0; margin-bottom:12px;"></div>
              <div id="addrCheckArea2" class="hidden" style="margin:6px 0 12px;">
                <div class="progress" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-label="Checking for availability">
                  <div id="addrProgressFill2" class="progress-fill" style="width:0%; background:#401075;"></div>
                </div>
                <div id="addrProgressText2" class="subtle center" style="margin-top:6px;">Checking for availability‚Ä¶ <span id="addrCountdown2">1</span>s</div>
                <div id="addrSuccess2" class="badge success hidden" role="status" aria-live="polite" style="margin-top:8px; width:92%; text-align:center;">
                  Great news! Service is available at your address.
                </div>
              </div>
            </div>
          </div>
          <div class="sticky" style="flex-direction:column; gap:8px; align-items:stretch;">
            <button id="showPlansBtn2" class="cta cta-lg btn-disabled" style="flex:0 0 auto" onclick="processEligibility()">Show available plans</button>
            <div class="center">
              <button class="cta-secondary" style="width:100%;" onclick="goto('screen-welcome-2')">Back</button>
            </div>
          </div>
        </section>

        <!-- Special Offer - Detail -->
        <section id="screen-offer-special" class="screen" aria-labelledby="offer-title">
          <header id="offer-title" style="font-weight:700; padding:12px 20px 8px; color:#401075; display:flex; align-items:center; justify-content:center; position:relative; background:url('./assets/GradientBackground.svg') center / cover no-repeat;">
            <span role="button" tabindex="0" onclick="goto('screen-dashboard')" style="position:absolute; left:20px; cursor:pointer;">‚Üê</span>
            <span>Explore Offers</span>
          </header>
          <div class="content">
            <div class="address-top" style="background:url('./assets/GradientBackground.svg') center / cover no-repeat; margin-left:-20px; margin-right:-20px; padding:8px 20px 12px;">
            <header class="center" style="font-size:24px; line-height:1.25; padding-top:0; padding-bottom:2px; margin:0; color:#401075;">Limited Time Retention Offer for you!</header>
            <article class="card" style="background:#fee2e2; border:1px solid #fca5a5;">
              <div class="row" style="align-items:center; justify-content:space-between; padding-right:10px;">
                <div class="plan" style="font-size:14px; color:#b91c1c; display:flex; align-items:center; gap:8px;">
                  <span style="font-size:16px;">‚è±Ô∏è</span>
                  <span>Offer expires in</span>
                </div>
                <span class="plan" style="background:#ef4444; color:#fff; padding:4px 8px; border-radius:8px; font-size:13px; flex:0 0 auto;">2:15:49</span>
              </div>
            </article>

            <article class="card" role="article" aria-label="Offer summary" style="background:#fff;">
              <div class="row" style="align-items:center; justify-content:space-between; margin-top:6px;">
                <div class="plan" style="font-size:16px; white-space:nowrap;">Upgrade to Unlimited 5G+</div>
              </div>
              <div class="row" style="align-items:center; justify-content:space-between; margin-top:4px;">
                <div class="price" style="font-size:20px;">$65<span class="muted">/mo</span></div>
                <span class="pill pill-high">SAVE $10/mo</span>
              </div>
              <div class="muted" style="margin-top:6px;">Get our best plan ever, just for you.</div>
              <ul class="muted" style="margin:6px 0 0 18px; padding:0;">
                <li><strong>Ultra‚ÄëFast 5G+</strong> ‚Äî Unthrottled Speed</li>
                <li><strong>50 GB Hotspot</strong> ‚Äî +20 GB from current</li>
              </ul>
              <button class="cta" style="width:100%; margin-top:10px;" onclick="viewPlan('Upgrade to Unlimited 5G+', null, null, '$65.00', 'Unlimited', '', '', '', '', '', 'Ultra‚ÄëFast 5G+ ‚Äî Unthrottled Speed. 50 GB Hotspot ‚Äî +20 GB from current', 0, 'High Recommendation', 'pill pill-high'); openReviewUpgrade();">Upgrade Now</button>
              <div class="row" style="margin-top:8px;">
                <button class="cta-secondary" style="flex:1">Chat with us</button>
                <button class="cta-secondary" style="flex:1" onclick="viewPlan('Upgrade to Unlimited 5G+', null, null, '$65.00', 'Unlimited', '', '', '', '', '', 'Ultra‚ÄëFast 5G+ ‚Äî Unthrottled Speed. 50 GB Hotspot ‚Äî +20 GB from current', 0, 'High Recommendation', 'pill pill-high', 'screen-plan-offer');">View Plan Details</button>
              </div>
              <div class="divider" style="margin:10px 0;"></div>
              <div class="row" style="align-items:center; gap:10px; cursor:pointer;" onclick="toggleOfferWhy()">
                <span id="offerWhyArrow" class="muted" style="flex:0 0 auto;">‚ñ∏</span>
                <div class="plan" style="font-size:14px; flex:0 0 auto;">Why you‚Äôre seeing this offer</div>
              </div>
              <div id="offerWhyBody" class="hidden">
                <ul class="muted" style="margin:6px 0 0 18px; padding:0;">
                  <li>The system detected that the user's data consumption has recently increased significantly.</li>
                  <li>The offer (Upgrade to Unlimited 5G+) directly solves this problem by providing "Ultra‚ÄëFast 5G+ Unthrottled Speed" and "+20 GB Hotspot".</li>
                  <li>The system recognizes the user is nearing the end of their contract term, putting them in a high‚Äërisk category for churn (switching providers).</li>
                  <li>The offer is positioned as a "LIMITED TIME RETENTION INCENTIVE" and is presented alongside a timer ("Offer expires in 2h 15m").</li>
                </ul>
              </div>
            </article>
            </div>

            <!-- Standalone 'Why you're seeing this offer' and action card were removed (rolled into the product card) -->

            <article class="card">
              <div class="row" style="align-items:center; justify-content:space-between;">
                <div>
                  <div class="plan" style="font-size:14px; margin:0;">Not the right fit?</div>
                  <div class="muted">Explore other options available to you.</div>
                </div>
                <button class="cta-tertiary" style="flex:0 0 auto; white-space:nowrap; height:30px;" onclick="openModifyPlan()">Modify Plan</button>
              </div>
            </article>

            <div class="divider" style="margin:12px 0;"></div>
            <div class="plan" style="margin:12px 0 2px; font-size:16px;">Customers like you also Chose</div>
            <div class="muted" style="margin:0 0 6px;">Showing 4 recommendations in the order of Best Match</div>
            <div class="hscroll" style="gap:10px;">
              <!-- Card 1: Related security add-on -->
              <article class="mini-card" style="min-width:260px;">
                <div class="plan" style="color:#032D60; font-size:16px;">Related security add‚Äëon</div>
                <div class="row" style="align-items:center; gap:8px; margin-top:4px;">
                  <div class="price" style="font-size:16px;">$5<span class="muted">/mo add‚Äëon</span></div>
                  <span class="pill pill-high">High Recommendation</span>
                </div>
                <div class="muted" style="margin-top:6px;">Advanced threat protection and safe browsing for all devices.</div>
                <div class="muted" style="margin-top:6px;"><strong>Focus:</strong> Related security add‚Äëon.</div>
                <div class="divider" style="margin:8px 0;"></div>
                <div class="muted" style="margin-top:6px;">üë• 900+ Customers added this bundle for complete peace of mind.</div>
                <button class="cta-secondary" style="width:100%; margin-top:28px;" onclick="viewPlan('Related security add-on', null, null, '$5.00', '', '', '', '', '', '', 'Advanced threat protection and safe browsing for all devices.', 0, 'High Recommendation', 'pill pill-high'); openReviewUpgrade();">Upgrade Now</button>
                <div class="muted" style="margin-top:6px;"><span class="link" role="button" tabindex="0" onclick="viewPlan('Related security add-on', null, null, '$5.00', '', '', '', '', '', '', 'Advanced threat protection and safe browsing for all devices.', 0, 'High Recommendation', 'pill pill-high', 'screen-plan-offer');">View Plan Details</span></div>
              </article>
              <!-- Card 2: Family Unlimited -->
              <article class="mini-card" style="min-width:260px;">
                <div class="plan" style="color:#032D60; font-size:16px;">Family Unlimited</div>
                <div class="row" style="align-items:center; gap:8px; margin-top:4px;">
                  <div class="price" style="font-size:16px;">$45<span class="muted">/line</span></div>
                  <span class="pill pill-med">Medium Recommendation</span>
                </div>
                <div class="muted" style="margin-top:6px;">Unlimited talk, text, and data on 2+ lines.</div>
                <div class="muted" style="margin-top:6px;"><strong>Focus:</strong> Plan is scaled to multiple lines.</div>
                <div class="divider" style="margin:8px 0;"></div>
                <div class="muted" style="margin-top:6px;">üë• 1,500+ Customers in your segment chose this plan for its great multi‚Äëline value.</div>
                <button class="cta-secondary" style="width:100%; margin-top:42px;" onclick="viewPlan('Family Unlimited', null, null, '$45.00', '', '', '', '', '', '', 'Unlimited talk, text, and data on 2+ lines.', 0, 'Medium Recommendation', 'pill pill-med'); openReviewUpgrade();">Upgrade Now</button>
                <div class="muted" style="margin-top:6px;"><span class="link" role="button" tabindex="0" onclick="viewPlan('Family Unlimited', null, null, '$45.00', '', '', '', '', '', '', 'Unlimited talk, text, and data on 2+ lines.', 0, 'Medium Recommendation', 'pill pill-med', 'screen-plan-offer');">View Plan Details</span></div>
              </article>
              <!-- Card 3: Premium Speed Tier -->
              <article class="mini-card" style="min-width:260px;">
                <div class="plan" style="color:#032D60; font-size:16px;">Premium Speed Tier</div>
                <div class="row" style="align-items:center; gap:8px; margin-top:4px;">
                  <div class="price" style="font-size:16px;">$85<span class="muted">/mo</span></div>
                  <span class="pill pill-med">Medium Recommendation</span>
                </div>
                <div class="muted" style="margin-top:6px;">Priority data access and higher speeds (e.g., 1000 Mbps).</div>
                <div class="muted" style="margin-top:6px;"><strong>Focus:</strong> The performance upgrade option.</div>
                <div class="divider" style="margin:8px 0;"></div>
                <div class="muted" style="margin-top:6px;">üë• 2,100+ Customers upgraded to this tier within the first 6 months.</div>
                 <button class="cta-secondary" style="width:100%; margin-top:28px;" onclick="viewPlan('Premium Speed Tier', null, null, '$85.00', '', '', '', '', '', '', 'Priority data access and higher speeds (e.g., 1000 Mbps).', 0, 'Medium Recommendation', 'pill pill-med'); openReviewUpgrade();">Upgrade Now</button>
                <div class="muted" style="margin-top:6px;"><span class="link" role="button" tabindex="0" onclick="viewPlan('Premium Speed Tier', null, null, '$85.00', '', '', '', '', '', '', 'Priority data access and higher speeds (e.g., 1000 Mbps).', 0, 'Medium Recommendation', 'pill pill-med', 'screen-plan-offer');">View Plan Details</span></div>
              </article>
              <!-- Card 4: Data Saver 15GB -->
              <article class="mini-card" style="min-width:260px;">
                <div class="plan" style="color:#032D60; font-size:16px;">Data Saver 15GB</div>
                <div class="row" style="align-items:center; gap:8px; margin-top:4px;">
                  <div class="price" style="font-size:16px;">$30<span class="muted">/mo</span></div>
                  <span class="pill pill-low">Low Recommendation</span>
                </div>
                <div class="muted" style="margin-top:6px;">15 GB of high‚Äëspeed data, then basic speed.</div>
                <div class="muted" style="margin-top:6px;"><strong>Focus:</strong> The lower‚Äëcost alternative.</div>
                <div class="divider" style="margin:8px 0;"></div>
                <div class="muted" style="margin-top:6px;">üë• 800+ Customers chose this when their usage patterns shifted to be mostly on Wi‚ÄëFi.</div>
                <button class="cta-secondary" style="width:100%; margin-top:42px;" onclick="viewPlan('Data Saver 15GB', null, null, '$30.00', '', '', '', '', '', '', '15 GB of high‚Äëspeed data, then basic speed.', 0, 'Low Recommendation', 'pill pill-low'); openReviewUpgrade();">Upgrade Now</button>
                <div class="muted" style="margin-top:6px;"><span class="link" role="button" tabindex="0" onclick="viewPlan('Data Saver 15GB', null, null, '$30.00', '', '', '', '', '', '', '15 GB of high‚Äëspeed data, then basic speed.', 0, 'Low Recommendation', 'pill pill-low', 'screen-plan-offer');">View Plan Details</span></div>
              </article>
            </div>
            <div class="divider" style="margin:12px 0;"></div>
            <div class="plan" style="margin:12px 0 2px; font-size:16px;">Products Based on Your Abandoned Cart</div>
            <div class="muted" style="margin:0 0 8px;">2 Products in your cart worth buying right away!</div>
            <div class="hscroll" style="gap:10px;">
              <article class="mini-card" style="min-width:260px;">
                <div class="plan" style="color:#401075; font-size:16px;">Fiber Pro Giga Plan</div>
                <div class="row" style="align-items:center; justify-content:space-between; margin-top:6px;">
                  <div class="price" style="font-size:16px;">$75.00<span class="muted">/mo</span></div>
                  <span class="pill pill-high">Still Available!</span>
                </div>
                <div class="muted" style="margin-top:8px;">FREE Activation Fee Waived</div>
                <div class="row" style="margin-top:10px;">
                  <button class="cta-secondary" style="width:100%;">Resume Checkout</button>
                </div>
              </article>
              <article class="mini-card" style="min-width:260px;">
                <div class="plan" style="color:#032D60; font-size:16px;">Samsung Galaxy S24</div>
                <div class="row" style="align-items:center; justify-content:space-between; margin-top:6px;">
                  <div class="price" style="font-size:16px;">$35<span class="muted">/mo</span> <span class="muted">on Installment</span></div>
                  <span class="pill pill-high">Still Available!</span>
                </div>
                <div class="muted" style="margin-top:8px;">FREE Case &amp; Screen Protector Added</div>
                <div class="row" style="margin-top:10px;">
                  <button class="cta-secondary" style="width:100%;">Resume Checkout</button>
                </div>
              </article>
            </div>
          </div>
        </section>

        <!-- Customer Dashboard -->
        <section id="screen-dashboard" class="screen" aria-labelledby="dash-title">
          <header id="dash-title" style="font-weight:700; padding:14px 20px 10px; color:#401075; display:flex; align-items:center; justify-content:center; position:relative; background:url('./assets/GradientBackground.svg') center / cover no-repeat;">
            <!-- Left menu icon -->
            <div aria-label="Menu" role="button" tabindex="0" style="position:absolute; left:20px; font-size:20px;">‚ò∞</div>
            <!-- Centered greeting -->
            <div style="text-align:center;">
              <div class="plan" style="font-size:24px; margin:0;">Hello Jane!</div>
            </div>
            <!-- Right user avatar -->
            <div aria-label="Profile" role="img" style="position:absolute; right:20px; width:32px; height:32px; border-radius:50%; background:#e6eaf0; display:flex; align-items:center; justify-content:center; font-size:16px;">üë§</div>
          </header>
          <div class="content">
            <div class="address-top" style="background:url('./assets/GradientBackground.svg') center / cover no-repeat; margin-left:-20px; margin-right:-20px; padding:8px 20px 12px;">
              <!-- removed persona pills -->
            </div>
            <div class="plan" style="margin:16px 0 10px; font-size:16px;">Alerts</div>
            <!-- Overdue banner -->
            <article class="card" style="background:#ffffff; border:1px solid var(--line); margin-bottom:10px;">
              <div class="row" style="align-items:flex-start; display:grid; grid-template-columns:22px 1fr auto; column-gap:10px;">
                <div style="width:22px; height:22px; display:flex; align-items:center; justify-content:center; font-size:18px;">‚ö†Ô∏è</div>
                <div class="plan" style="font-size:16px; margin:0; grid-column:2;">Action Required: Your Bill is Overdue</div>
                <button class="cta-tertiary" style="flex:0 0 auto; white-space:nowrap; grid-column:3; grid-row:1;">Pay Now</button>
              </div>
              <div class="muted" style="margin-top:10px;">To avoid service interruption, please pay your outstanding balance.</div>
            </article>

            <!-- Offers expiring banner -->
            <article class="card" style="background:#ffffff; border:1px solid var(--line); margin-bottom:20px;">
              <div class="row" style="align-items:center; display:grid; grid-template-columns:22px 1fr auto; column-gap:10px;">
                <div style="width:22px; height:22px; display:flex; align-items:center; justify-content:center; font-size:16px;">‚è∞</div>
                <div class="plan" style="font-size:16px; margin:0; grid-column:2;">Personalized Offers: Expires in 2 hours</div>
                <button class="cta-tertiary" style="flex:0 0 auto; white-space:nowrap; grid-column:3; grid-row:1;" onclick="goto('screen-offer-special')">Explore Offer</button>
              </div>
              <div class="muted" style="margin-top:8px;">Don‚Äôt miss out ‚Äî this limited-time offer is about to expire.</div>
            </article>

            <!-- Usage -->
            <div class="plan" style="margin:24px 0 0; font-size:16px;">Current Cycle Usage (Monthly)</div>
            <div class="muted" style="margin:2px 0 6px;">Resets in 12 days <span class="link link-sm" role="button" tabindex="0">‚Ä¢ View Detailed Usage Patterns</span></div>
            <article class="card">
              <div style="margin-bottom:20px;">
                <div class="row" style="justify-content:space-between; margin-bottom:4px;">
                  <div class="plan" style="font-size:14px;">Data</div>
                  <div class="muted" style="text-align:right;">15/20 GB</div>
                </div>
                <div class="progress" style="width:100%;"><div class="progress-fill" style="width:75%;"></div></div>
              </div>
              <div style="margin:20px 0;">
                <div class="row" style="justify-content:space-between; margin-bottom:4px;">
                  <div class="plan" style="font-size:14px;">Voice</div>
                  <div class="muted" style="text-align:right;">350/500 min</div>
                </div>
                <div class="progress" style="width:100%;"><div class="progress-fill" style="width:70%; background:#401075;"></div></div>
              </div>
              <div style="margin-top:20px;">
                <div class="row" style="justify-content:space-between; margin-bottom:4px;">
                  <div class="plan" style="font-size:14px;">SMS</div>
                  <div class="muted" style="text-align:right;">800/1000</div>
                </div>
                <div class="progress" style="width:100%;"><div class="progress-fill" style="width:80%; background:#401075;"></div></div>
              </div>
            </article>

            <div class="plan" style="margin:24px 0 8px; font-size:16px;">Account Overview</div>

            <!-- List tiles -->
            <article class="card" id="myBillCard">
              <!-- Closed accordion header -->
              <div role="button" tabindex="0" aria-expanded="false" class="row" onclick="toggleMyBill()" style="align-items:center; justify-content:flex-start; gap:10px; width:100%; position:relative;">
                <div style="display:flex; align-items:flex-start; gap:10px;">
                  <div style="position:relative; width:22px; height:22px; display:flex; align-items:center; justify-content:center;">
                    <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="#9aa3af" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false">
                      <path d="M20 21V6.8A3.8 3.8 0 0 0 16.2 3H7.8A3.8 3.8 0 0 0 4 6.8V21l2-1.3 2 1.3 2-1.3 2 1.3 2-1.3 2 1.3 2-1.3Z"></path>
                      <path d="M9 7h6"></path>
                      <path d="M7.5 10.5h9"></path>
                      <path d="M7.5 14h9"></path>
                      <path d="M9 17h6"></path>
                    </svg>
                    <span class="badge-dot badge-yellow"></span>
                  </div>
                  <div>
                    <div class="row" style="align-items:center; gap:6px;">
                      <div class="plan" style="font-size:16px; color:#032D60;">My Bill</div>
                    </div>
                    <div class="muted" style="white-space:nowrap;">Current Balance: $75.50</div>
                  </div>
                </div>
                <div id="myBillArrow" class="muted" style="position:absolute; right:10px; top:50%; transform:translateY(-50%); font-size:16px;">‚ñ∏</div>
              </div>
              <!-- Open accordion body -->
              <div id="myBillBody" class="hidden">
                <div class="divider" style="margin:10px 0; width:100%;"></div>
                <div class="row" style="align-items:flex-start; justify-content:space-between;">
                  <div>
                    <div class="plan" style="font-size:13px; font-weight:500; white-space:nowrap;">Current Balance: $75.50</div>
                    <div class="muted" style="font-size:12px;">(Due: December 15, 2025)</div>
                  </div>
                  <button class="cta-tertiary" style="white-space:nowrap; flex:0 0 auto; width:auto; min-width:0;">Pay Now</button>
                </div>
                <div class="divider" style="margin:10px 0;"></div>
                <div class="plan" style="font-size:13px; font-weight:500; margin-bottom:6px;">Current Statement Summary:</div>
                <ul class="muted" style="margin:0 0 8px 0; padding:0; list-style:disc inside;">
                  <li style="display:flex; justify-content:space-between; gap:12px;"><span>Plan Charges:</span><span>$69.00</span></li>
                  <li style="display:flex; justify-content:space-between; gap:12px;"><span>Usage Overages:</span><span>$2.00</span></li>
                  <li style="display:flex; justify-content:space-between; gap:12px;"><span>Taxes &amp; Fees:</span><span>$4.50</span></li>
                  <li style="display:flex; justify-content:space-between; gap:12px;"><strong>Total:</strong><strong>$75.50</strong></li>
                </ul>
                <div class="divider" style="margin:10px 0;"></div>
                <div><span class="link" role="button" tabindex="0" style="font-size:13px;">View Full PDF Statement</span></div>
              </div>
            </article>
            <!-- Account Health accordion -->
            <article class="card" id="accHealthCard">
              <div role="button" tabindex="0" aria-expanded="false" class="row" onclick="toggleDash('acc')" style="align-items:center; justify-content:flex-start; gap:10px; width:100%; position:relative;">
                <div style="position:relative; flex:0 0 22px; width:22px; height:22px; display:flex; align-items:center; justify-content:center;">
                  <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="#9aa3af" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false">
                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"></path>
                    <path d="M9 12h6"></path>
                    <path d="M12 9v6"></path>
                  </svg>
                  <span class="badge-dot badge-green"></span>
                </div>
                <div style="flex:1;">
                  <div class="row" style="align-items:center; gap:6px;">
                    <div class="plan" style="font-size:16px; color:#032D60;">Account Health</div>
                  </div>
                  <div class="muted">Status: Good (85/100)</div>
                </div>
                <div id="accArrow" class="muted" style="margin-left:auto; font-size:16px; position:absolute; right:10px; top:50%; transform:translateY(-50%);">‚ñ∏</div>
              </div>
              <div id="accBody" class="hidden">
                <div class="divider" style="margin:10px 0; width:100%;"></div>
                <div class="row" style="align-items:center; gap:8px;">
                  <div class="plan" style="font-size:14px; font-weight:700;">Account Health Score: 85/100</div>
                  <span class="pill pill-high">Good</span>
                </div>
                <div class="muted" style="margin-top:6px;">Your account is in excellent standing. You are eligible for the best offers and device financing.</div>
                <div class="divider" style="margin:10px 0;"></div>
                <div class="plan" style="font-size:14px; font-weight:500;">Breakdown Factors</div>
                <ul class="muted" style="margin:6px 0 8px 18px; padding:0;">
                  <li>Payment History: Excellent (100% On‚Äëtime payments)</li>
                  <li>Contract Status: Mid‚ÄëContract (12 months remaining)</li>
                  <li>Credit Utilization: Low (No overdue balances)</li>
                  <li>Service Reliability: Excellent (0 service interruptions in the last 6 months)</li>
                </ul>
                <div class="divider" style="margin:10px 0;"></div>
                <div class="plan" style="font-size:14px; font-weight:500;">Recommendations</div>
                <div class="muted" style="margin:4px 0 8px;">Tip: Set up AutoPay to protect your score and avoid late fees.</div>
                <div class="divider" style="margin:10px 0;"></div>
                <div><span class="link" role="button" tabindex="0" style="font-size:13px;">View Health Details</span></div>
              </div>
            </article>
            <!-- Open Issues accordion -->
            <article class="card" id="openIssuesCard">
              <div role="button" tabindex="0" aria-expanded="false" class="row" onclick="toggleDash('issues')" style="align-items:center; justify-content:flex-start; gap:10px; width:100%; position:relative;">
                <div style="position:relative; flex:0 0 22px; width:22px; height:22px; display:flex; align-items:center; justify-content:center;">
                  <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="#9aa3af" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="7" x2="12" y2="13"></line>
                    <circle cx="12" cy="17" r="1.5"></circle>
                  </svg>
                  <span class="badge-dot badge-orange"></span>
                </div>
                <div style="flex:1;">
                  <div class="row" style="align-items:center; gap:6px;">
                    <div class="plan" style="font-size:16px; color:#032D60;">Open Issues</div>
                  </div>
                  <div class="muted">1 Unresolved: Slow Data Speeds</div>
                </div>
                <div id="issuesArrow" class="muted" style="margin-left:auto; font-size:16px; position:absolute; right:10px; top:50%; transform:translateY(-50%);">‚ñ∏</div>
              </div>
              <div id="issuesBody" class="hidden">
                <div class="divider" style="margin:10px 0; width:100%;"></div>
                <div class="row" style="align-items:center; justify-content:space-between; gap:8px; margin-top:4px;">
                  <span class="plan" style="font-size:13px;">‚Ä¢ Issue: Slow Data Speed.</span>
                  <span class="pill pill-high">In Progress</span>
                </div>
                <div class="muted" style="margin:2px 0 6px;">
                  <span class="link" role="button" tabindex="0">‚Ä¢ Case #T‚Äë12345</span>
                </div>
                <div class="muted" style="margin-top:6px;">Last Update: Technician dispatched to local tower (Estimated resolution: Today, 5:00 PM)</div>
                <div class="divider" style="margin:10px 0;"></div>
                <div class="plan" style="font-size:14px; font-weight:500;">Troubleshooting &amp; Support</div>
                <div class="muted" style="margin:8px 0;">
                  <strong>Action for User:</strong> Before the technician arrives, try restarting your modem/router to see if the issue is resolved.
                </div>
                <div class="muted" style="margin-bottom:8px;">
                  <strong>Communication Log:</strong> Log of all interactions (initial report, automated checks, agent chats).
                </div>
                <div class="row" style="gap:10px; margin-bottom:6px;">
                  <button class="cta-secondary">Chat with an Agent</button>
                  <button class="cta-secondary">Report an issue</button>
                </div>
                <div class="divider" style="margin:10px 0;"></div>
                <div><span class="link" role="button" tabindex="0" style="font-size:13px;">View All Issues</span></div>
              </div>
            </article>
            <!-- Personalized Offers accordion -->
            <article class="card" id="offersCard">
              <div role="button" tabindex="0" aria-expanded="true" class="row" onclick="toggleDash('offers')" style="align-items:center; justify-content:flex-start; gap:10px; width:100%; position:relative;">
                <div style="position:relative; flex:0 0 22px; width:22px; height:22px; display:flex; align-items:center; justify-content:center;">
                  <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="#9aa3af" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false">
                    <path d="M7.5 3l11-1-.5 11L10 21 3 14l4.5-11z"></path>
                    <circle cx="16.5" cy="6" r="1.5"></circle>
                    <circle cx="9.5" cy="13" r="1.5"></circle>
                    <path d="M14 8l-5 5"></path>
                  </svg>
                  <span class="badge-dot badge-red"></span>
                </div>
                <div style="flex:1;">
                  <div class="row" style="align-items:center; gap:6px;">
                    <div class="plan" style="font-size:16px; color:#032D60;">Personalized Offers</div>
                  </div>
                  <div class="muted">You have a new offer waiting!</div>
                </div>
                <div id="offersArrow" class="muted" style="margin-left:auto; font-size:16px; position:absolute; right:10px; top:50%; transform:translateY(-50%);">‚ñæ</div>
              </div>
              <div id="offersBody">
                <div class="divider" style="margin:10px 0; width:100%;"></div>
                <!-- Highlighted Offer -->
                <article class="card" role="region" aria-label="Top personalized offer" style="background:#ffffff center / cover no-repeat; border-color:#c9defc;">
                  <div class="row" style="align-items:center; justify-content:space-between;">
                    <div class="plan" style="font-size:16px; color:#032D60;">Upgrade to Unlimited Data</div>
                    <span class="pill pill-high">Highly Recommended</span>
                  </div>
                  <div class="muted" style="margin-top:6px;">
                    Unlock 5G speeds and truly unlimited data for just $10 more per month.
                  </div>
                  <div class="row" style="margin-top:10px;">
                    <button class="cta" onclick="goto('screen-offer-special')">Explore this Offer</button>
                  </div>
                </article>
                <div class="divider" style="margin:12px 0;"></div>
                <!-- Other Offers -->
                <div class="plan" style="font-size:14px; font-weight:500;">Other Offers</div>
                <div style="margin-top:8px; display:grid; gap:6px;">
                  <article class="card" style="margin:0;">
                    <div class="plan" style="font-size:11px; color:#6b7280; text-transform:uppercase; letter-spacing:.3px; margin-bottom:2px;">Plan Upgrade</div>
                    <div class="plan" style="font-size:14px;">Trade‚Äëin &amp; Upgrade Discount</div>
                    <div class="muted" style="margin-top:4px;">Get $200 off the new [Device Name] when you switch to our Premium plan.</div>
                    <div class="row" style="margin-top:8px;">
                      <button class="cta-secondary" onclick="goto('screen-offer-special')">Explore this Offer</button>
                    </div>
                  </article>
                  <article class="card" style="margin:0;">
                    <div class="plan" style="font-size:11px; color:#6b7280; text-transform:uppercase; letter-spacing:.3px; margin-bottom:2px;">Add‚Äëon/Bundle</div>
                    <div class="plan" style="font-size:14px;">Secure Family Bundle</div>
                    <div class="muted" style="margin-top:4px;">Add device protection and parental controls for 2 lines for 20% off.</div>
                    <div class="row" style="margin-top:8px;">
                      <button class="cta-secondary" onclick="goto('screen-offer-special')">Explore this Offer</button>
                    </div>
                  </article>
                  <article class="card" style="margin:0;">
                    <div class="plan" style="font-size:11px; color:#6b7280; text-transform:uppercase; letter-spacing:.3px; margin-bottom:2px;">Retention/Loyalty</div>
                    <div class="plan" style="font-size:14px;">Free HBO Max Subscription</div>
                    <div class="muted" style="margin-top:4px;">As a thank you for your loyalty, enjoy 6 months of streaming on us.</div>
                    <div class="row" style="margin-top:8px;">
                      <button class="cta-secondary" onclick="goto('screen-offer-special')">Explore this Offer</button>
                    </div>
                  </article>
                </div>
                <div class="divider" style="margin:12px 0;"></div>
                <div><span class="link" role="button" tabindex="0" style="font-size:13px;">See All Available Offers</span></div>
              </div>
            </article>
          </div>
          <div class="sticky" style="background:#fff; border-top:1px solid var(--line); padding:12px 20px;">
            <div class="row" style="justify-content:center; width:100%; gap:36px;">
              <div role="button" tabindex="0" onclick="goto('screen-dashboard')" style="display:flex; flex-direction:column; align-items:center; gap:6px;">
                <div style="width:18px; height:18px;">
                  <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="#2b7fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false">
                    <rect x="3" y="3" width="9" height="13" rx="2"></rect>
                    <rect x="14" y="3" width="7" height="7" rx="2"></rect>
                    <rect x="14" y="12" width="7" height="9" rx="2"></rect>
                    <rect x="3" y="18" width="9" height="3" rx="2"></rect>
                  </svg>
                </div>
                <div class="plan" style="font-size:12px; color:#2b7fff;">Dashboard</div>
              </div>
              <div role="button" tabindex="0" style="display:flex; flex-direction:column; align-items:center; gap:6px;">
                <div style="width:18px; height:18px;">
                  <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="#9aa3af" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false">
                    <path d="M20 21V6.8A3.8 3.8 0 0 0 16.2 3H7.8A3.8 3.8 0 0 0 4 6.8V21l2-1.3 2 1.3 2-1.3 2 1.3 2-1.3 2 1.3 2-1.3Z"></path>
                    <path d="M9 7h6"></path>
                    <path d="M7.5 10.5h9"></path>
                    <path d="M7.5 14h9"></path>
                    <path d="M9 17h6"></path>
                  </svg>
                </div>
                <div class="muted" style="font-size:12px;">Bills</div>
              </div>
              <div role="button" tabindex="0" style="display:flex; flex-direction:column; align-items:center; gap:6px;">
                <div style="width:18px; height:18px;">
                  <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="#9aa3af" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false">
                    <path d="M3 4h3l2 7h11.5a1 1 0 0 0 .96-.71l1.4-4.29A1 1 0 0 0 21 5h-5"></path>
                    <path d="M9 11l-1.5-5"></path>
                    <circle cx="10" cy="19" r="2"></circle>
                    <circle cx="18" cy="19" r="2"></circle>
                    <path d="M8 19h8"></path>
                  </svg>
                </div>
                <div class="muted" style="font-size:12px;">Shop</div>
              </div>
              <div role="button" tabindex="0" style="display:flex; flex-direction:column; align-items:center; gap:6px;">
                <div style="width:18px; height:18px;">
                  <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="#9aa3af" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false">
                    <path d="M4 12a8 8 0 0 1 16 0"></path>
                    <rect x="3" y="12" width="4" height="7" rx="2"></rect>
                    <rect x="17" y="12" width="4" height="7" rx="2"></rect>
                    <circle cx="12" cy="20" r="2"></circle>
                    <path d="M12 18v2"></path>
                  </svg>
                </div>
                <div class="muted" style="font-size:12px;">Support</div>
              </div>
            </div>
          </div>
        </section>

        <!-- Plan Details - Full -->
        <section id="screen-plan-full" class="screen" aria-labelledby="planfull-title">
          <header id="planfull-title" style="font-weight:700; padding:12px 20px 8px; color:#401075; display:flex; align-items:center; justify-content:center; position:relative; background:url('./assets/GradientBackground.svg') center / cover no-repeat;">
            <span role="button" tabindex="0" onclick="goto('screen-results-reco')" style="position:absolute; left:20px; cursor:pointer;">‚Üê</span>
            <span>View Plan Details</span>
          </header>
          <div class="content" style="padding-top:0;">
            <div class="address-top" style="padding-top:8px; padding-bottom:12px; margin-bottom:12px; margin-left:-20px; margin-right:-20px; padding-left:20px; padding-right:20px;">
              <article class="card" role="article" aria-label="Plan summary" style="background:#fff;">
                <div class="row" style="align-items:center; justify-content:space-between; margin-top:4px;">
                  <div class="plan" id="pdName" style="font-size:18px;">Plan Name</div>
                  <span id="pdRecoPill" class="pill pill-high" aria-live="polite">Highly Recommended</span>
                </div>
                <div class="price" id="pdPrice" style="font-size:18px; margin-top:4px;">$59.99<span class="muted">/mo</span></div>
                <div class="muted" id="pdDesc" style="margin-top:6px;">500 Mbps download ‚Ä¢ 50 Mbps upload</div>
                <div id="pdEta" class="muted" style="margin-top:4px;">Activation ETA: 2 days</div>
                <div class="divider" style="margin:8px 0;"></div>
                <div class="muted" style="margin-top:4px;">üë• 40 people in your area bought this product in past 6 months</div>
                <span class="pill" style="margin-top:8px; width:max-content;">üîí Price Lock</span>
              </article>
            </div>

            <!-- Why this product for you? (accordion, closed by default) -->
            <!-- Why this product for you? header outside the card -->
            <div class="row" style="align-items:center; justify-content:flex-start; margin-top:12px;">
              <div class="plan">Why this product for you?</div>
            </div>
            <article id="accWhyBody" class="card" style="margin-top:8px;">
              <!-- Item 1 -->
              <div>
                <div class="plan" id="pdWhy1Title">Optimal for Gaming &amp; Streaming</div>
                <ul class="muted" style="margin:6px 0 0 18px; padding:0;">
                  <li><strong>Focus:</strong> Performance and Usage Affinity.</li>
                  <li><strong>Intent:</strong> <span id="pdWhy1Desc" style="font-style:italic;">Based on your stated activities.</span></li>
                </ul>
                <div class="muted" style="margin-top:6px;">Pro‚ÄëSpeed for Streaming ‚Äî Perfect bandwidth for 4K video &amp; lag‚Äëfree gaming.</div>
              </div>
              <div class="divider" style="margin:10px 0;"></div>
              <!-- Item 2 -->
              <div>
                <div class="plan" id="pdWhy2Title">Covers All Your Devices</div>
                <ul class="muted" style="margin:6px 0 0 18px; padding:0;">
                  <li><strong>Focus:</strong> Product Preference and Scale.</li>
                  <li><strong>Intent:</strong> <span id="pdWhy2Desc" style="font-style:italic;">For your family of 4.</span></li>
                </ul>
                <div class="muted" style="margin-top:6px;">Covers Your Whole Household ‚Äî Validated for simultaneous use by 4+ devices/users.</div>
              </div>
              <div class="divider" style="margin:10px 0;"></div>
              <!-- Item 3 -->
              <div>
                <div class="plan" id="pdWhy3Title">Best Speed in Your Area</div>
                <ul class="muted" style="margin:6px 0 0 18px; padding:0;">
                  <li><strong>Focus:</strong> Feasibility and Coverage.</li>
                  <li><strong>Intent:</strong> <span id="pdWhy3Desc" style="font-style:italic;">Based on feasibility check</span></li>
                </ul>
                <div class="muted" style="margin-top:6px;">Best Speed at Your Address ‚Äî Guaranteed 500 Mbps based on feasibility check.</div>
              </div>
            </article>
            </article>

            <!-- What it includes (accordion, closed by default) -->
            <!-- What it includes header outside the card -->
            <div class="row" style="align-items:center; justify-content:flex-start; margin-top:12px;">
              <div class="plan">What it includes</div>
            </div>
            <article id="accIncBody" class="card" style="margin-top:8px;">
                <div class="row" style="margin-top:0;">
                <div class="muted" style="flex:1;">Download Speed</div>
                <div class="plan" id="pdIncDown" style="font-size:13px;">500 Mbps</div>
              </div>
              <div class="row" style="margin-top:4px;">
                <div class="muted" style="flex:1;">Upload Speed</div>
                <div class="plan" id="pdIncUp" style="font-size:13px;">50 Mbps</div>
              </div>
              <div class="row" style="margin-top:4px;">
                <div class="muted" style="flex:1;">Data Allowance</div>
                <div class="plan" id="pdAllowance" style="color:#1a7f3c; font-size:13px;">Unlimited</div>
              </div>
              <div class="row" style="margin-top:4px;">
                <div class="muted" style="flex:1;">Contract Length</div>
                <div class="plan" id="pdContract" style="font-size:13px;">24 months</div>
              </div>
              <div class="row" style="margin-top:4px;">
                <div class="muted" style="flex:1;">Equipment</div>
                <div class="plan" id="pdEquipment" style="color:#1a7f3c; font-size:13px;">Free Wi‚ÄëFi 6 Router</div>
              </div>
            </article>
            </article>

            <!-- Pricing Breakdown (accordion, closed by default) -->
            <!-- Pricing Breakdown header outside the card -->
            <div class="row" style="align-items:center; justify-content:flex-start; margin-top:12px;">
              <div class="plan">Pricing Breakdown</div>
            </div>
            <article id="accPriceBody" class="card" style="margin-top:6px;">
              <div class="row" style="margin-top:0;">
                <div class="muted" style="flex:1;">Monthly Plan Rate</div>
                <div class="plan" id="pdPriceRate">$0.00 per line</div>
              </div>
              <div class="row" style="margin-top:6px;">
                <div class="muted" style="flex:1;">Regulatory &amp; Admin Fees</div>
                <div class="muted" id="pdRegFee">$5.99 per line</div>
              </div>
              <div class="row" style="margin-top:6px;">
                <div class="muted" style="flex:1;">Estimated Taxes</div>
                <div class="muted" id="pdTax">~ 6% of base rate</div>
              </div>
              <div class="divider" style="margin:8px 0;"></div>
              <div class="row" style="margin-top:0;">
                <div class="muted" style="flex:1;">Total Estimated Monthly Bill</div>
                <div class="plan" id="pdTotal">$0.00</div>
              </div>
              <div class="divider" style="margin:8px 0;"></div>
              <div class="row" style="margin-top:0;">
                <div class="muted" style="flex:1;">One‚ÄëTime Activation Fee</div>
                <div class="muted" id="pdActFee">$35.00 per line</div>
              </div>
              <div class="row" style="margin-top:6px;">
                <div class="muted" style="flex:1;">Installation Fee</div>
                <div class="muted" id="pdInstall">Setup is free</div>
              </div>
            </article>
          </div>
          <div class="sticky" style="flex-direction:column; gap:8px; align-items:stretch;">
            <button class="cta" style="flex:0 0 auto" onclick="openReview('screen-plan-full')">Activate this plan</button>
            <div class="center"><span class="link link-sm" role="button" tabindex="0" onclick="goto('screen-results-reco')">View Other Plans</span></div>
          </div>
        </section>
        <!-- Plan Details - Offer (Explore Offers flow) -->
        <section id="screen-plan-offer" class="screen" aria-labelledby="planoffer-title">
          <header id="planoffer-title" style="font-weight:700; padding:12px 20px 8px; color:#401075; display:flex; align-items:center; justify-content:center; position:relative; background:url('./assets/GradientBackground.svg') center / cover no-repeat;">
            <span role="button" tabindex="0" onclick="goto('screen-offer-special')" style="position:absolute; left:20px; cursor:pointer;">‚Üê</span>
            <span>View Plan Details</span>
          </header>
          <div class="content" style="padding-top:0;">
            <div class="address-top" style="padding-top:8px; padding-bottom:12px; margin-bottom:12px; margin-left:-20px; margin-right:-20px; padding-left:20px; padding-right:20px;">
              <article class="card" role="article" aria-label="Plan summary (offer)" style="background:#fff;">
                <div class="row" style="align-items:center; justify-content:space-between; margin-top:4px;">
                  <div class="plan" id="pdOName" style="font-size:18px;">Plan Name</div>
                  <span id="pdORecoPill" class="pill pill-high" aria-live="polite">Highly Recommended</span>
                </div>
                <div class="price" id="pdOPrice" style="font-size:18px; margin-top:4px;">$0.00<span class="muted">/mo</span></div>
                <div class="muted" id="pdODesc" style="margin-top:6px;">‚Äî</div>
                <div id="pdOEta" class="muted" style="margin-top:4px;">Activation ETA: ‚Äî</div>
                <div class="divider" style="margin:8px 0;"></div>
                <div class="muted" style="margin-top:4px;">üë• 40 people in your area bought this product in past 6 months</div>
                <span class="pill" style="margin-top:8px; width:max-content;">üîí Price Lock</span>
              </article>
            </div>
            <div class="row" style="align-items:center; justify-content:flex-start; margin-top:12px;">
              <div class="plan">Why this product for you?</div>
            </div>
            <article id="accWhyBodyO" class="card" style="margin-top:8px;">
              <div>
                <div class="plan" id="pdOWhy1Title">Optimal for Gaming &amp; Streaming</div>
                <ul class="muted" style="margin:6px 0 0 18px; padding:0;">
                  <li><strong>Focus:</strong> Performance and Usage Affinity.</li>
                  <li><strong>Intent:</strong> <span id="pdOWhy1Desc" style="font-style:italic;">Based on your stated activities.</span></li>
                </ul>
                <div class="muted" style="margin-top:6px;">Pro‚ÄëSpeed for Streaming ‚Äî Perfect bandwidth for 4K video &amp; lag‚Äëfree gaming.</div>
              </div>
              <div class="divider" style="margin:10px 0;"></div>
              <div>
                <div class="plan" id="pdOWhy2Title">Covers All Your Devices</div>
                <ul class="muted" style="margin:6px 0 0 18px; padding:0;">
                  <li><strong>Focus:</strong> Product Preference and Scale.</li>
                  <li><strong>Intent:</strong> <span id="pdOWhy2Desc" style="font-style:italic;">For your family of 4.</span></li>
                </ul>
                <div class="muted" style="margin-top:6px;">Covers Your Whole Household ‚Äî Validated for simultaneous use by 4+ devices/users.</div>
              </div>
              <div class="divider" style="margin:10px 0;"></div>
              <div>
                <div class="plan" id="pdOWhy3Title">Best Speed in Your Area</div>
                <ul class="muted" style="margin:6px 0 0 18px; padding:0;">
                  <li><strong>Focus:</strong> Feasibility and Coverage.</li>
                  <li><strong>Intent:</strong> <span id="pdOWhy3Desc" style="font-style:italic;">Based on feasibility check</span></li>
                </ul>
                <div class="muted" style="margin-top:6px;">Best Speed at Your Address ‚Äî Guaranteed 500 Mbps based on feasibility check.</div>
              </div>
            </article>
            <div class="row" style="align-items:center; justify-content:flex-start; margin-top:12px;">
              <div class="plan">What it includes</div>
            </div>
            <article id="accIncBodyO" class="card" style="margin-top:8px;">
              <div class="row" style="margin-top:0;">
                <div class="muted" style="flex:1;">Download Speed</div>
                <div class="plan" id="pdOIncDown" style="font-size:13px;">‚Äî</div>
              </div>
              <div class="row" style="margin-top:4px;">
                <div class="muted" style="flex:1;">Upload Speed</div>
                <div class="plan" id="pdOIncUp" style="font-size:13px;">‚Äî</div>
              </div>
              <div class="row" style="margin-top:4px;">
                <div class="muted" style="flex:1;">Data Allowance</div>
                <div class="plan" id="pdOAllowance" style="color:#1a7f3c; font-size:13px;">Unlimited</div>
              </div>
              <div class="row" style="margin-top:4px;">
                <div class="muted" style="flex:1;">Contract Length</div>
                <div class="plan" id="pdOContract" style="font-size:13px;">24 months</div>
              </div>
              <div class="row" style="margin-top:4px;">
                <div class="muted" style="flex:1;">Equipment</div>
                <div class="plan" id="pdOEquipment" style="color:#1a7f3c; font-size:13px;">Free Wi‚ÄëFi 6 Router</div>
              </div>
            </article>
            <div class="row" style="align-items:center; justify-content:flex-start; margin-top:12px;">
              <div class="plan">Pricing Breakdown</div>
            </div>
            <article id="accPriceBodyO" class="card" style="margin-top:6px;">
              <div class="row" style="margin-top:0;">
                <div class="muted" style="flex:1;">Monthly Plan Rate</div>
                <div class="plan" id="pdOPriceRate">$0.00 per line</div>
              </div>
              <div class="row" style="margin-top:6px;">
                <div class="muted" style="flex:1;">Regulatory &amp; Admin Fees</div>
                <div class="muted" id="pdORegFee">$5.99 per line</div>
              </div>
              <div class="row" style="margin-top:6px;">
                <div class="muted" style="flex:1;">Estimated Taxes</div>
                <div class="muted" id="pdOTax">~ 6% of base rate</div>
              </div>
              <div class="divider" style="margin:8px 0;"></div>
              <div class="row" style="margin-top:0;">
                <div class="muted" style="flex:1;">Total Estimated Monthly Bill</div>
                <div class="plan" id="pdOTotal">$0.00</div>
              </div>
              <div class="divider" style="margin:8px 0;"></div>
              <div class="row" style="margin-top:0;">
                <div class="muted" style="flex:1;">One‚ÄëTime Activation Fee</div>
                <div class="muted" id="pdOActFee">$35.00 per line</div>
              </div>
              <div class="row" style="margin-top:6px;">
                <div class="muted" style="flex:1;">Installation Fee</div>
                <div class="muted" id="pdOInstall">Setup is free</div>
              </div>
            </article>
          </div>
          <div class="sticky" style="flex-direction:column; gap:8px; align-items:stretch;">
            <button class="cta" style="flex:0 0 auto" onclick="openReviewUpgrade()">Upgrade Now</button>
            <div class="center"><span class="link link-sm" role="button" tabindex="0" onclick="goto('screen-offer-special')">Back to Offers</span></div>
          </div>
        </section>
        <!-- Modify Plan (Offer flow) -->
        <section id="screen-modify" class="screen" aria-labelledby="modify-title">
          <div class="address-top" style="position:relative; padding-top:70px;">
            <span role="button" tabindex="0" onclick="goto('screen-offer-special')" style="position:absolute; left:20px; top:8px; cursor:pointer;">‚Üê</span>
            <h1 id="modify-title" class="display-h1" style="font-size:24px; font-weight:800; line-height:1.25; margin:0; padding-bottom:2px; text-align:center; color:#401075;">Let's modify your plan!</h1>
            <p class="subhead" style="margin:6px 16px 42px; line-height:1.4; font-size:18px; text-align:center; color:#ffffff;">
              Easily customize your current plan, add boosters, or explore new plan tiers. Your estimated cost impact is updated in real-time
            </p>
            <article class="card" style="margin:6px auto 28px; background:#fff; width:80%;">
              <div class="plan" style="font-size:16px;">Change Data Limit</div>
              <div class="row" style="align-items:baseline; justify-content:flex-start; margin-top:6px;">
                <div class="plan" id="modGbVal" style="font-size:28px; white-space:nowrap;">20 <span class="muted" style="font-size:14px;">GB</span></div>
              </div>
              <div style="position:relative; margin-top:8px;">
                <input id="modGbSlider" class="styled-range" type="range" min="5" max="100" value="20" oninput="onModifySlider(this.value)" style="width:100%;" >
                <span class="muted" id="modRecPlan" style="position:absolute; right:0; top:-16px;">Recommended Plan</span>
                <span class="muted" id="modMaxLabel" style="position:absolute; right:0; bottom:-16px;">100 GB</span>
              </div>
              <div class="row" style="justify-content:flex-start;">
                <div class="muted">5 GB</div>
              </div>
              <div style="background:linear-gradient(180deg,#eaf3ff 0%, #dbeaff 100%); border:1px solid #dbeafe; padding:10px; border-radius:12px; margin-top:12px;">
                <div class="muted">‚ÑπÔ∏è Your estimated monthly cost will adjust based on the data limit you select.</div>
              </div>
            </article>
          </div>
          <div class="content" style="padding-top:8px;">
            <div class="plan" style="font-size:16px;">Add Boosters</div>
            <div class="muted" style="margin-top:4px;">One‚Äëtime additions to your plan. Expires at the end of your billing cycle.</div>
            <article class="card" style="margin-top:8px;">
              <div class="row" style="align-items:center; justify-content:space-between; margin-top:12px;">
                <div>
                  <div class="plan" style="font-size:14px;">Extra Data</div>
                  <div class="muted">+5 GB</div>
                </div>
                <button id="btnBoostData" class="cta-secondary" style="flex:0 0 auto; white-space:nowrap; width:120px;" onclick="toggleBooster('data')">Add +$10</button>
              </div>
              <div class="row" style="align-items:center; justify-content:space-between; margin-top:12px;">
                <div>
                  <div class="plan" style="font-size:14px;">Int'l Calls</div>
                  <div class="muted">100 Mins</div>
                </div>
                <button id="btnBoostIntl" class="cta-secondary" style="flex:0 0 auto; white-space:nowrap; width:120px;" onclick="toggleBooster('intl')">Add +$05</button>
              </div>
            </article>
            <div class="divider" style="margin-top:12px;"></div>
            <div style="margin-top:12px;">
              <div class="plan" style="font-size:16px;">Explore Other Plans</div>
              <!-- Card: Fiber 500 -->
              <article class="card" style="margin-top:8px;">
                <div class="row" style="align-items:center; justify-content:space-between;">
                  <div class="plan" style="color:#032D60; font-size:16px;">Fiber 500</div>
                  <span class="pill pill-med">Medium Recommended</span>
                </div>
                <div class="price" style="font-size:22px; margin:4px 0;">$55 <span class="muted">/mo</span></div>
                <div class="feat">500 Mbps ‚Ä¢ Unlimited ‚Ä¢ ETA: 2 days</div>
                <div class="row" style="margin-top:6px;">
                  <span class="link link-sm" role="button" tabindex="0" style="margin-left:auto; position:relative; right:-12px;" onclick="viewPlan('Fiber 500', 500, 50, '$55.00', 'Unlimited', 'Free Wi‚ÄëFi 6 Router', 'Optimal for Gaming & Streaming', 'Based on your stated activities', 'Best Speed in Your Area', 'Based on feasibility check', '500 Mbps ‚Ä¢ Unlimited ‚Ä¢ ETA: 2 days', 2, null, null, 'screen-plan-offer')">‚Ä¢ View Details</span>
                </div>
              </article>
              <!-- Card: Fiber 300 -->
              <article class="card">
                <div class="row" style="align-items:center; justify-content:space-between;">
                  <div class="plan" style="color:#032D60; font-size:16px;">Fiber 300</div>
                  <span class="pill pill-med">Medium Recommended</span>
                </div>
                <div class="price" style="font-size:22px; margin:4px 0;">$40 <span class="muted">/mo</span></div>
                <div class="feat">300 Mbps ‚Ä¢ Unlimited ‚Ä¢ ETA: 3 days</div>
                <div class="row" style="margin-top:6px;">
                  <span class="link link-sm" role="button" tabindex="0" style="margin-left:auto; position:relative; right:-12px;" onclick="viewPlan('Fiber 300', 300, 30, '$40.00', 'Unlimited', 'Wi‚ÄëFi 6 Router', 'Great for Everyday Use', 'Streaming, browsing, and video calls', 'Budget Friendly', 'Best price/performance', '300 Mbps ‚Ä¢ Unlimited ‚Ä¢ ETA: 3 days', 3, null, null, 'screen-plan-offer')">‚Ä¢ View Details</span>
                </div>
              </article>
              <!-- Card: Basic 100 -->
              <article class="card">
                <div class="row" style="align-items:center; justify-content:space-between;">
                  <div class="plan" style="color:#032D60; font-size:16px;">Basic 100</div>
                  <span class="pill pill-low">Low Recommended</span>
                </div>
                <div class="price" style="font-size:22px; margin:4px 0;">$29 <span class="muted">/mo</span></div>
                <div class="feat">100 Mbps ‚Ä¢ Unlimited ‚Ä¢ ETA: 3‚Äì5 days</div>
                <div class="row" style="margin-top:6px;">
                  <span class="link link-sm" role="button" tabindex="0" style="margin-left:auto; position:relative; right:-12px;" onclick="viewPlan('Basic 100', 100, 10, '$29.00', 'Unlimited', 'Standard Wi‚ÄëFi Router', 'Reliable Essentials', 'Email, browsing, light streaming', 'Entry Plan', 'Good for 1‚Äì2 users', '100 Mbps ‚Ä¢ Unlimited ‚Ä¢ ETA: 3‚Äì5 days', 4, null, null, 'screen-plan-offer')">‚Ä¢ View Details</span>
                </div>
              </article>
            </div>
          </div>
          <div class="sticky" style="align-items:stretch; gap:8px; flex-direction:column;">
            <div class="row" style="align-items:baseline; padding:10px 0;">
              <div class="plan" style="font-size:14px; font-weight:700; white-space:nowrap;">Estimated Cost Impact</div>
              <div id="modEst" class="plan" style="color:#16a34a; font-size:18px; margin-left:auto; text-align:right;">+$0.00<span class="muted">/mo</span></div>
            </div>
            <button class="cta" onclick="confirmModify()">Confirm Changes</button>
          </div>
        </section>
        <!-- Results - Recommended (Sixth Screen) -->
        <section id="screen-results-reco" class="screen" aria-labelledby="reco-title">
          <div class="reco-top" style="position:relative;">
            <span role="button" tabindex="0" onclick="goto('screen-address')" style="position:absolute; left:20px; top:8px; cursor:pointer;">‚Üê</span>
            <img id="topPickIcon" class="reco-hero" src="./assets/Toppick-icon.svg" alt="Top pick icon" style="margin-top:80px; height:104px; width:104px;"/>
            <header id="reco-title" class="center" style="font-size:30px; line-height:1.25; padding-top:0; padding-bottom:2px; margin:0; margin-top:50px; margin-bottom:20px; color:#401075;">Our top pick for you!</header>
            <p id="recoHelp" class="center" style="margin:4px 20px 8px; line-height:1.4; font-size:18px; color:#ffffff;">Highest-ranked plan based on your budget, usage, and verified location</p>
            <div class="content" style="padding-top:8px;">
              <!-- Product Card -->
              <article class="card" role="article" aria-label="Top pick product" style="background:#fff;">
              <div class="row" style="align-items:center; justify-content:space-between;">
                <div class="plan" style="font-size:18px; color:#401075; font-weight:700;">Fiber Pro Giga Plan</div>
                <span class="pill pill-high">Highly Recommended</span>
              </div>
              <div class="price" style="font-size:20px; margin:4px 0; color:#000000;">$75.00 <span class="muted" style="color:#000000;">/month</span></div>
                <div class="feat" style="margin-top:6px; color:#000000;">
                  Up to 940 Mbps download/upload speed.<br/>
                  Includes free modem and unlimited data.
                </div>
                <div style="margin-top:8px;"><span class="pill" style="background:#ffffff;">Activation ETA: 2 Days</span></div>
                <div class="muted" style="margin-top:6px; color:#000000;">üë• 40 people bought this plan in your area</div>
                <button class="cta" style="width:100%; margin-top:10px;" onclick="viewPlan('Fiber Pro Giga Plan', 940, 940, '$75.00', 'Unlimited', 'Free Wi‚ÄëFi & Router', 'Optimal for Gaming & Streaming', 'Based on your stated activities', 'Covers All Your Devices', 'For your family of 4', 'Up to 940 Mbps download/upload speed. Includes free modem and unlimited data.', 2); openReview('screen-results-reco')">Activate Plan</button>
                <div class="row" style="margin-top:8px;">
                <button class="cta-secondary" style="flex:1" onclick="openCompare()">Compare plans</button>
                  <button class="cta-secondary" style="flex:1 " onclick="viewPlan('Fiber Pro Giga Plan', 940, 940, '$75.00', 'Unlimited', 'Free Wi‚ÄëFi & Router', 'Optimal for Gaming & Streaming', 'Based on your stated activities', 'Covers All Your Devices', 'For your family of 4', 'Up to 940 Mbps download/upload speed. Includes free modem and unlimited data.', 2)">View Details</button>
                </div>
                <div class="divider"></div>
                <!-- Why chosen accordion (inside product card) -->
                <div id="recoWhyHeader" style="display:flex; align-items:center; gap:8px; font-weight:600; font-size:13px; color:var(--ink); cursor:pointer;" onclick="toggleWhyReco()">
                  <span id="recoWhyArrow" class="muted" style="color:#9aa0a6;">‚ñ∏</span>
                  <span>How we chose these plans</span>
                </div>
                <div id="recoWhyBody" class="hidden" style="margin-top:6px;">
                  <ul class="muted" style="padding-left:18px; margin:4px 0 0; color:#9aa0a6;">
                    <li>We analyzed your verified service address (<span id="whyZip">YOUR ZIP</span>) to filter for plans with guaranteed availability in your building.</li>
                    <li>This plan was scored highest because it perfectly aligns with your stated preference for <span id="whyTop">your top priority</span> and <span id="whyPref">your product preferences</span>.</li>
                    <li>Based on your indicated usage this plan offers the required speed and Unlimited Data to ensure you don't experience throttling.</li>
                  </ul>
                </div>
              </article>
            </div>
          </div>
          <!-- Rest of details on white -->
          <div class="content" style="padding-top:8px;">
            <div class="plan" style="margin:8px 0 2px; font-size:16px;">Other Recommended Options</div>
            <div class="muted" style="margin:0 0 6px;">Showing three other plans for your location and interest</div>
            <!-- Three vertical recommendation cards -->
            <article class="card">
              <div class="row" style="align-items:center; justify-content:space-between;">
                <div class="plan" style="color:#401075; font-size:16px;">Fiber 500</div>
                <span class="pill pill-med">Medium Recommended</span>
              </div>
              <div class="price" style="font-size:22px; margin:4px 0;">$55 <span class="muted">/mo</span></div>
              <div class="feat">500 Mbps ‚Ä¢ Unlimited ‚Ä¢ ETA: 2 days</div>
              <div class="row" style="margin-top:8px;">
                <button class="cta-secondary" style="flex:1" onclick="openCompare()">Compare Plans</button>
                <button class="cta" style="flex:1" onclick="viewPlan('Fiber 500', 500, 50, '$55.00', 'Unlimited', 'Free Wi‚ÄëFi 6 Router', 'Optimal for Gaming & Streaming', 'Based on your stated activities', 'Best Speed in Your Area', 'Based on feasibility check', '500 Mbps ‚Ä¢ Unlimited ‚Ä¢ ETA: 2 days', 2); openReview('screen-results-reco')">Select Plan</button>
              </div>
              <div class="row" style="margin-top:6px;">
                <span class="link link-sm" role="button" tabindex="0" style="margin-left:auto; position:relative; right:-12px;" onclick="viewPlan('Fiber 500', 500, 50, '$55.00', 'Unlimited', 'Free Wi‚ÄëFi 6 Router', 'Optimal for Gaming & Streaming', 'Based on your stated activities', 'Best Speed in Your Area', 'Based on feasibility check', '500 Mbps ‚Ä¢ Unlimited ‚Ä¢ ETA: 2 days', 2)">‚Ä¢ View Details</span>
              </div>
            </article>
            <article class="card">
              <div class="row" style="align-items:center; justify-content:space-between;">
                <div class="plan" style="color:#401075; font-size:16px;">Fiber 300</div>
                <span class="pill pill-med">Medium Recommended</span>
              </div>
              <div class="price" style="font-size:22px; margin:4px 0;">$40 <span class="muted">/mo</span></div>
              <div class="feat">300 Mbps ‚Ä¢ Unlimited ‚Ä¢ ETA: 3 days</div>
              <div class="row" style="margin-top:8px;">
                <button class="cta-secondary" style="flex:1" onclick="openCompare()">Compare Plans</button>
                <button class="cta" style="flex:1" onclick="viewPlan('Fiber 300', 300, 30, '$40.00', 'Unlimited', 'Wi‚ÄëFi 6 Router', 'Great for Everyday Use', 'Streaming, browsing, and video calls', 'Budget Friendly', 'Best price/performance', '300 Mbps ‚Ä¢ Unlimited ‚Ä¢ ETA: 3 days', 3); openReview('screen-results-reco')">Select Plan</button>
              </div>
              <div class="row" style="margin-top:6px;">
                <span class="link link-sm" role="button" tabindex="0" style="margin-left:auto; position:relative; right:-12px;" onclick="viewPlan('Fiber 300', 300, 30, '$40.00', 'Unlimited', 'Wi‚ÄëFi 6 Router', 'Great for Everyday Use', 'Streaming, browsing, and video calls', 'Budget Friendly', 'Best price/performance', '300 Mbps ‚Ä¢ Unlimited ‚Ä¢ ETA: 3 days', 3)">‚Ä¢ View Details</span>
              </div>
            </article>
            <article class="card">
              <div class="row" style="align-items:center; justify-content:space-between;">
                <div class="plan" style="color:#401075; font-size:16px;">Basic 100</div>
                <span class="pill pill-low">Low Recommended</span>
              </div>
              <div class="price" style="font-size:22px; margin:4px 0;">$29 <span class="muted">/mo</span></div>
              <div class="feat">100 Mbps ‚Ä¢ Unlimited ‚Ä¢ ETA: 3‚Äì5 days</div>
              <div class="row" style="margin-top:8px;">
                <button class="cta-secondary" style="flex:1" onclick="openCompare()">Compare Plans</button>
                <button class="cta" style="flex:1" onclick="viewPlan('Basic 100', 100, 10, '$29.00', 'Unlimited', 'Standard Wi‚ÄëFi Router', 'Reliable Essentials', 'Email, browsing, light streaming', 'Entry Plan', 'Good for 1‚Äì2 users', '100 Mbps ‚Ä¢ Unlimited ‚Ä¢ ETA: 3‚Äì5 days', 4); openReview('screen-results-reco')">Select Plan</button>
              </div>
              <div class="row" style="margin-top:6px;">
                <span class="link link-sm" role="button" tabindex="0" style="margin-left:auto; position:relative; right:-12px;" onclick="viewPlan('Basic 100', 100, 10, '$29.00', 'Unlimited', 'Standard Wi‚ÄëFi Router', 'Reliable Essentials', 'Email, browsing, light streaming', 'Entry Plan', 'Good for 1‚Äì2 users', '100 Mbps ‚Ä¢ Unlimited ‚Ä¢ ETA: 3‚Äì5 days', 4)">‚Ä¢ View Details</span>
              </div>
            </article>
            <div class="divider"></div>
            <!-- Popular moved below recommendations -->
            <div class="row" style="align-items:center; justify-content:space-between; margin:6px 0 2px;">
              <div class="plan" style="font-size:16px;">Popular Services in your Area</div>
            </div>
            <div class="muted" style="margin:0 0 6px;">See what your neighbors are choosing</div>
            <div class="hscroll" aria-label="Popular items">
              <div class="mini-card">
                <div class="plan">üë• Community Favorite</div>
                <div class="muted suggest-two" style="margin-top:4px;"><strong>Suggested Service:</strong> The Neighborhood Standard</div>
                <div class="muted mini-desc">95% of neighbors choose this speed tier. See why this plan is the most reliable in your ZIP.</div>
                <button class="cta-secondary" style="margin-top:8px; width:100%;">Explore Neighbors' Plans</button>
              </div>
              <div class="mini-card">
                <div class="plan">üè† Top‚ÄëRated Bundle</div>
                <div class="muted suggest-two" style="margin-top:4px;"><strong>Suggested Service:</strong> Local Synergy Pack</div>
                <div class="muted mini-desc">Add Mobile & Save. Get 2 lines free when you bundle internet and mobile service.</div>
                <button class="cta-secondary" style="margin-top:8px; width:100%;">Build Your Bundle</button>
              </div>
              <div class="mini-card">
                <div class="plan">üèÜ Reliability Champion</div>
                <div class="muted suggest-two" style="margin-top:4px;"><strong>Suggested Service:</strong> Uptime Guarantee Plan</div>
                <div class="muted mini-desc">Local Favorite for Uptime. Chosen by customers who demand the highest reliability. Check out our 99.9% uptime guarantee here.</div>
                <button class="cta-secondary" style="margin-top:8px; width:100%;">View Reliability Report</button>
              </div>
              <div class="mini-card">
                <div class="plan">‚è≥ Limited‚ÄëTime Deal</div>
                <div class="muted suggest-two" style="margin-top:4px;"><strong>Suggested Service:</strong> ZIP Code Saver Plan</div>
                <div class="muted mini-desc">Neighborhood Exclusive Offer! Get your first 3 months at 50% off. Offer expires soon‚Äîavailable only for ZIP: <span id="popularZip">YOUR ZIP</span>.</div>
                <button class="cta-secondary" style="margin-top:8px; width:100%;">Unlock Discount</button>
              </div>
            </div>
            <div class="divider"></div>
            <!-- People with similar interests -->
            <div class="plan" style="font-size:16px;">People with Your Interest also bought</div>
            <div class="muted" style="margin:0 0 6px;">Additional add‚Äëons and products tailored to your interests</div>
            <div class="hscroll" aria-label="People also bought">
              <article class="card">
                <div class="plan" style="color:#032D60; font-size:16px;">Upgrade Your Wi‚ÄëFi</div>
                <div class="muted suggest-two" style="margin-top:4px;"><strong>Suggested Service:</strong> Total Coverage Mesh System</div>
                <div style="margin:6px 0;"><span class="chip chip-white">Faster Speed / High Streaming Affinity</span></div>
                <div class="muted buy-desc">For high-demand users. People who chose Faster Speed or mentioned Streaming often purchase our Wi‚ÄëFi mesh system for guaranteed whole-home coverage and eliminating dead zones.</div>
                <button class="cta-secondary" style="width:100%; margin-top:8px;">Explore Wi‚ÄëFi Solutions</button>
              </article>
              <article class="card">
                <div class="plan" style="color:#032D60; font-size:16px;">Device Insurance</div>
                <div class="muted suggest-two" style="margin-top:4px;"><strong>Suggested Service:</strong> Family Protect 360</div>
                <div style="margin:6px 0;"><span class="chip chip-white">Family Plan / Need for Reliability</span></div>
                <div class="muted buy-desc">Peace of mind for your whole family. Customers selecting a Family Plan often add our comprehensive device protection plan to cover all connected devices.</div>
                <button class="cta-secondary" style="width:100%; margin-top:8px;">Add Device Protection</button>
              </article>
              <article class="card">
                <div class="plan" style="color:#032D60; font-size:16px;">Smart Home Bundle</div>
                <div class="muted suggest-two" style="margin-top:4px;"><strong>Suggested Service:</strong> Guardian Smart Starter Kit</div>
                <div style="margin:6px 0;"><span class="chip chip-white">Home Bundles Preference</span></div>
                <div class="muted buy-desc">Home Bundles often add a starter smart home security package (e.g., smart lock + doorbell camera) for a single bill.</div>
                <button class="cta-secondary" style="width:100%; margin-top:8px;">See Smart Home Deals</button>
              </article>
            </div>
          </div>
          <!-- Explore Other Plans section removed from 'Our top pick for you!' screen -->
          <div class="sticky" style="justify-content:center;">
            <button class="cta-secondary" style="flex:1;">Browse all active plans</button>
          </div>
        </section>
        <!-- Results - Recommended (Duplicate) -->
        <section id="screen-results-reco-2" class="screen" aria-labelledby="reco-title-2">
          <div class="reco-top" style="position:relative;">
            <span role="button" tabindex="0" onclick="goto('screen-address-2')" style="position:absolute; left:20px; top:8px; cursor:pointer;">‚Üê</span>
            <img id="topPickIcon2" class="reco-hero" src="./assets/Toppick-icon.svg" alt="Top pick icon" style="width:104px; height:104px; margin-top:80px" />
            <header id="reco-title-2" class="center" style="font-size:30px; line-height:1.25; padding-top:0; padding-bottom:2px; margin:0; color:#401075;">Our top pick for you!</header>
            <p id="reco2Help" class="center" style="margin:4px 20px 8px; line-height:1.4; font-size:18px; color:#ffffff;">Matched to your needs</p>
            <div class="content" style="padding-top:8px;">
              <article class="card" role="article" aria-label="Top pick product" style="background:#fff;">
                <div class="row" style="align-items:center; justify-content:space-between;">
                  <div class="plan" style="font-size:18px; color:#401075; font-weight:700;">Fiber Pro Giga Plan</div>
                  <span class="pill pill-high">Highly Recommended</span>
                </div>
                <div class="price" style="font-size:20px; margin:4px 0; color:#000000;">$75.00 <span class="muted" style="color:#000000;">/month</span></div>
                <ul id="reco2Features" class="feat" style="margin-top:6px; color:#000000; padding-left:18px;">
                  <!-- Populated dynamically -->
                </ul>
                <div id="reco2Badges" class="row" style="align-items:center; gap:8px; margin-top:6px;">
                  <span id="reco2Promo" class="pill" style="background:#ffffff;">Promo</span>
                </div>
                <div class="muted" style="margin-top:6px; color:#000000;">üë• 40 people bought this plan in your area</div>
                <button class="cta" style="width:100%; margin-top:10px;" onclick="goto('screen-review-2')">Activate Plan</button>
                <div class="row" style="margin-top:8px;">
                  <button class="cta-secondary" style="flex:1" onclick="openCompare()">Compare plans</button>
                  <button class="cta-secondary" style="flex:1" onclick="goto('screen-plan-full-2')">View Details</button>
                </div>
                <div class="divider"></div>
                <div id="recoWhy2" style="margin-top:6px;">
                  <div style="display:flex; align-items:center; gap:8px; font-weight:600; font-size:13px; color:var(--ink);">Why we recommend</div>
                  <ul id="recoWhyList2" class="muted" style="padding-left:18px; margin:4px 0 0; color:#9aa0a6;"></ul>
                </div>
              </article>
            </div>
          </div>
          <div class="content" style="padding-top:8px;">
            <div class="plan" style="margin:8px 0 2px; font-size:16px;">Other Recommended Options</div>
            <div class="muted" style="margin:0 0 6px;">Showing three other plans for your location and interest</div>
            <article class="card">
              <div class="row" style="align-items:center; justify-content:space-between;">
                <div class="plan" style="color:#401075; font-size:16px;">Fiber 500</div>
                <span class="pill pill-med">Medium Recommended</span>
              </div>
              <div class="price" style="font-size:22px; margin:4px 0;">$55 <span class="muted">/mo</span></div>
              <div class="feat">500 Mbps ‚Ä¢ Unlimited ‚Ä¢ ETA: 2 days</div>
              <div class="row" style="margin-top:8px;">
                <button class="cta-secondary" style="flex:1" onclick="openCompare()">Compare Plans</button>
                <button class="cta" style="flex:1" onclick="openReview('screen-results-reco-2')">Select Plan</button>
              </div>
              <div class="row" style="margin-top:6px;">
                <span class="link link-sm" role="button" tabindex="0" style="margin-left:auto; position:relative; right:-12px;">‚Ä¢ View Details</span>
              </div>
            </article>
            <article class="card">
              <div class="row" style="align-items:center; justify-content:space-between;">
                <div class="plan" style="color:#401075; font-size:16px;">Fiber 300</div>
                <span class="pill pill-med">Medium Recommended</span>
              </div>
              <div class="price" style="font-size:22px; margin:4px 0;">$40 <span class="muted">/mo</span></div>
              <div class="feat">300 Mbps ‚Ä¢ Unlimited ‚Ä¢ ETA: 3 days</div>
              <div class="row" style="margin-top:8px;">
                <button class="cta-secondary" style="flex:1" onclick="openCompare()">Compare Plans</button>
                <button class="cta" style="flex:1" onclick="openReview('screen-results-reco-2')">Select Plan</button>
              </div>
              <div class="row" style="margin-top:6px;">
                <span class="link link-sm" role="button" tabindex="0" style="margin-left:auto; position:relative; right:-12px;">‚Ä¢ View Details</span>
              </div>
            </article>
            <article class="card">
              <div class="row" style="align-items:center; justify-content:space-between;">
                <div class="plan" style="color:#401075; font-size:16px;">Basic 100</div>
                <span class="pill pill-low">Low Recommended</span>
              </div>
              <div class="price" style="font-size:22px; margin:4px 0;">$29 <span class="muted">/mo</span></div>
              <div class="feat">100 Mbps ‚Ä¢ Unlimited ‚Ä¢ ETA: 3‚Äì5 days</div>
              <div class="row" style="margin-top:8px;">
                <button class="cta-secondary" style="flex:1" onclick="openCompare()">Compare Plans</button>
                <button class="cta" style="flex:1" onclick="openReview('screen-results-reco-2')">Select Plan</button>
              </div>
              <div class="row" style="margin-top:6px;">
                <span class="link link-sm" role="button" tabindex="0" style="margin-left:auto; position:relative; right:-12px;">‚Ä¢ View Details</span>
              </div>
            </article>
            <div class="divider"></div>
            <!-- Popular moved below recommendations -->
            <div class="row" style="align-items:center; justify-content:space-between; margin:6px 0 2px;">
              <div class="plan" style="font-size:16px;">Popular Services in your Area</div>
            </div>
            <div class="muted" style="margin:0 0 6px;">See what your neighbors are choosing</div>
            <div class="hscroll" aria-label="Popular items">
              <div class="mini-card">
                <div class="plan">üë• Community Favorite</div>
                <div class="muted suggest-two" style="margin-top:4px;"><strong>Suggested Service:</strong> The Neighborhood Standard</div>
                <div class="muted mini-desc">95% of neighbors choose this speed tier. See why this plan is the most reliable in your ZIP.</div>
                <button class="cta-secondary" style="margin-top:8px; width:100%;">Explore Neighbors' Plans</button>
              </div>
              <div class="mini-card">
                <div class="plan">üè† Top‚ÄëRated Bundle</div>
                <div class="muted suggest-two" style="margin-top:4px;"><strong>Suggested Service:</strong> Local Synergy Pack</div>
                <div class="muted mini-desc">Add Mobile & Save. Get 2 lines free when you bundle internet and mobile service.</div>
                <button class="cta-secondary" style="margin-top:8px; width:100%;">Build Your Bundle</button>
              </div>
              <div class="mini-card">
                <div class="plan">üèÜ Reliability Champion</div>
                <div class="muted suggest-two" style="margin-top:4px;"><strong>Suggested Service:</strong> Uptime Guarantee Plan</div>
                <div class="muted mini-desc">Local Favorite for Uptime. Chosen by customers who demand the highest reliability. Check out our 99.9% uptime guarantee here.</div>
                <button class="cta-secondary" style="margin-top:8px; width:100%;">View Reliability Report</button>
              </div>
              <div class="mini-card">
                <div class="plan">‚è≥ Limited‚ÄëTime Deal</div>
                <div class="muted suggest-two" style="margin-top:4px;"><strong>Suggested Service:</strong> ZIP Code Saver Plan</div>
                <div class="muted mini-desc">Neighborhood Exclusive Offer! Get your first 3 months at 50% off. Offer expires soon‚Äîavailable only for ZIP: <span id="popularZip2">YOUR ZIP</span>.</div>
                <button class="cta-secondary" style="margin-top:8px; width:100%;">Unlock Discount</button>
              </div>
            </div>
            <div class="divider"></div>
            <!-- People with similar interests -->
            <div class="plan" style="font-size:16px;">People with Your Interest also bought</div>
            <div class="muted" style="margin:0 0 6px;">Additional add‚Äëons and products tailored to your interests</div>
            <div class="hscroll" aria-label="People also bought">
              <article class="card">
                <div class="plan" style="color:#032D60; font-size:16px;">Upgrade Your Wi‚ÄëFi</div>
                <div class="muted suggest-two" style="margin-top:4px;"><strong>Suggested Service:</strong> Total Coverage Mesh System</div>
                <div style="margin:6px 0;"><span class="chip chip-white">Faster Speed / High Streaming Affinity</span></div>
                <div class="muted buy-desc">For high-demand users. People who chose Faster Speed or mentioned Streaming often purchase our Wi‚ÄëFi mesh system for guaranteed whole-home coverage and eliminating dead zones.</div>
                <button class="cta-secondary" style="width:100%; margin-top:8px;">Explore Wi‚ÄëFi Solutions</button>
              </article>
              <article class="card">
                <div class="plan" style="color:#032D60; font-size:16px;">Device Insurance</div>
                <div class="muted suggest-two" style="margin-top:4px;"><strong>Suggested Service:</strong> Family Protect 360</div>
                <div style="margin:6px 0;"><span class="chip chip-white">Family Plan / Need for Reliability</span></div>
                <div class="muted buy-desc">Peace of mind for your whole family. Customers selecting a Family Plan often add our comprehensive device protection plan to cover all connected devices.</div>
                <button class="cta-secondary" style="width:100%; margin-top:8px;">Add Device Protection</button>
              </article>
              <article class="card">
                <div class="plan" style="color:#032D60; font-size:16px;">Smart Home Bundle</div>
                <div class="muted suggest-two" style="margin-top:4px;"><strong>Suggested Service:</strong> Guardian Smart Starter Kit</div>
                <div style="margin:6px 0;"><span class="chip chip-white">Home Bundles Preference</span></div>
                <div class="muted buy-desc">Home Bundles often add a starter smart home security package (e.g., smart lock + doorbell camera) for a single bill.</div>
                <button class="cta-secondary" style="width:100%; margin-top:8px;">See Smart Home Deals</button>
              </article>
            </div>
          </div>
          <div class="sticky" style="justify-content:center;">
            <button class="cta-secondary" style="flex:1;" onclick="goto('screen-modify')">Modify Plan</button>
          </div>
        </section>

        <!-- Personalize (Step 4) -->
        <section id="screen-personalize" class="screen" aria-labelledby="personalize-title">
          <div class="address-top">
            <div class="dots" aria-hidden="true"><span class="dot"></span><span class="dot"></span><span class="dot active"></span><span class="dot"></span></div>
            <!-- Personalize icon from assets (cache-busted) -->
            <img id="personalizeIcon" src="./assets/your-icon.svg" alt="Personalize icon" style="display:block; margin:12px auto 6px; width:104px; height:104px; margin-top:80px;" />
            <h1 id="personalize-title" class="display-h1" style="font-size:30px;color:#401075; font-weight:600; line-height:1.25; margin:0; margin-top:50px; margin-bottom:20px; padding-bottom:2px;">Let's personalise </br> your plan!</h1>
            <p class="subhead" style="margin:4px 20px 8px; line-height:1.4; font-size:18px;">Answer few questions to get more <br/> tailored recommendations</p>
          </div>
          <div class="content" style="padding-top:8px;">
            <!-- Budget options -->
            <div style="margin-bottom:16px;">
              <div class="section-title">What's your typical monthly budget for a service plan?</div>
              <div class="toolbar" id="qBudgetGroup" role="radiogroup" aria-label="Budget">
                <span class="chip chip-toggle" onclick="selectBudget(this,'$50')">$50</span>
                <span class="chip chip-toggle" onclick="selectBudget(this,'$100')">$100</span>
                <span class="chip chip-toggle" onclick="selectBudget(this,'$120')">$120</span>
                <span class="chip chip-toggle" onclick="selectBudget(this,'$150')">$150</span>
              </div>
            </div>
            <div class="divider"></div>
            <!-- Data usage chips (4 steps) -->
            <div style="margin-bottom:16px;">
              <div class="section-title">What is your primary need for data each month?</div>
              <div class="subtle" style="margin-top:4px;">Light: Mostly Wi‚ÄëFi ‚Ä¢ Moderate: Daily social/media music ‚Ä¢ Heavy: HD streaming/hotspot/gaming ‚Ä¢ Unlimited: Don‚Äôt want limits</div>
              <div class="toolbar" id="qDataGroup" role="radiogroup" aria-label="Monthly data need" style="margin-top:10px;">
                <span class="chip chip-toggle" onclick="selectDataNeed(this,'Light Use')">Light Use</span>
                <span class="chip chip-toggle" onclick="selectDataNeed(this,'Moderate Use')">Moderate Use</span>
                <span class="chip chip-toggle" onclick="selectDataNeed(this,'Heavy Use')">Heavy Use</span>
                <span class="chip chip-toggle" onclick="selectDataNeed(this,'Unlimited')">Unlimited</span>
              </div>
            </div>
            <div class="divider"></div>
            <!-- Streaming frequency chips -->
            <div style="margin-bottom:16px;">
              <div class="section-title">How often do you stream HD video or game on your mobile data?</div>
              <div class="subtle" style="margin-top:4px;">
                Occasionally: A few times a month ‚Ä¢ Often: Daily while commuting/traveling
              </div>
              <div class="toolbar" id="qStreamGroup" role="radiogroup" aria-label="Streaming frequency" style="margin-top:10px;">
                <span class="chip chip-toggle" onclick="selectStream(this,'Never / Rarely')">Never / Rarely</span>
                <span class="chip chip-toggle" onclick="selectStream(this,'Occasionally')">Occasionally</span>
                <span class="chip chip-toggle" onclick="selectStream(this,'Often')">Often</span>
                <span class="chip chip-toggle" onclick="selectStream(this,'It‚Äôs Essential')">It‚Äôs Essential</span>
              </div>
            </div>
            <div class="divider"></div>
            <!-- Lines chips -->
            <div style="margin-bottom:16px;">
              <div class="section-title">How many lines/users do you need on your plan?</div>
              <div class="toolbar" id="qLinesGroup" role="radiogroup" aria-label="Lines/users">
                <span class="chip chip-toggle" onclick="selectLinesChip(this,'Just for me (1)')">Just for me (1)</span>
                <span class="chip chip-toggle" onclick="selectLinesChip(this,'For my partner and me (2)')">For my partner and me (2)</span>
                <span class="chip chip-toggle" onclick="selectLinesChip(this,'Small Family (3‚Äì4)')">Small Family (3‚Äì4)</span>
                <span class="chip chip-toggle" onclick="selectLinesChip(this,'Large Family (5+)')">Large Family (5+)</span>
              </div>
            </div>
            <div class="divider"></div>
            <!-- International radio -->
            <div style="margin-bottom:24px;">
              <div class="section-title">Do you frequently travel internationally or call/text abroad?</div>
              <div class="toolbar" id="qIntlGroup" role="radiogroup" aria-label="International usage">
                <span class="chip chip-toggle" onclick="selectIntl(this,true)">Yes</span>
                <span class="chip chip-toggle" onclick="selectIntl(this,false)">No</span>
              </div>
            </div>
          </div>
          <div class="sticky" style="flex-direction:column; gap:8px; align-items:stretch;">
            <button id="personalizeCta" class="cta cta-lg btn-disabled" style="flex:0 0 auto" onclick="goto('screen-match')">Find matching plans</button>
            <button class="cta-secondary" style="width:100%;" onclick="goto('screen-processing')">Back</button>
            <div class="center"><span class="link link-sm" role="button" tabindex="0" onclick="goto('screen-match')">Skip for now</span></div>
          </div>
        </section>
        <!-- Match (Step 5) -->
        <section id="screen-match" class="screen" aria-labelledby="match-title">
          <div class="welcome-top" style="min-height:50vh; padding-bottom:8px; display:flex; flex-direction:column; align-items:center; justify-content:center;">
            <div class="dots" aria-hidden="true" style="margin-top:8px;"><span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot active"></span></div>
            <!-- search icon on top -->
            <img id="matchSearchIcon" src="./assets/search-icon.svg" alt="Search" style="display:block; margin:12px auto 16px; margin-top:80px; width:104px; height:104px;" />
            <header id="match-title" class="center" style="font-size:30px; color:#401075; font-weight:600; line-height:1.25; padding-top:0; padding-bottom:2px; margin:0;">Finding your perfect plan!</header>
            <p class="muted center" style="margin:4px 20px 8px; color:#ffffff; line-height:1.4; font-size:18px; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;">
              We're matching the best internet plans to your address and preferences.
            </p>
            <div class="divider" style="margin-top:20px; color:#ffffff;"></div>
            <p class="muted center" style="margin:4px 20px 8px; color:#ffffff; line-height:1.4; font-size:18px; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;">
              We Cross‚ÄëChecked Your Search History ‚Äî We noticed you explored these features while looking for a plan.
            </p>
            <div class="toolbar" style="justify-content:center; gap:8px; flex-wrap:wrap; margin:0 20px;">
              <span class="chip chip-white">Searched: ‚ÄúGigabit Speed‚Äù</span>
              <span class="chip chip-white">Searched: ‚ÄúUnlimited Data‚Äù</span>
              <span class="chip chip-white">Price Filter: &lt; $80</span>
              <span class="chip chip-white">Compared: [Competitor Plan Name]</span>
            </div>
          </div>
          <div class="content center" style="padding-top:12px;">
            <!-- selected meta tags -->
            <div id="matchChips" class="toolbar" style="justify-content:center; margin:6px auto 8px; max-width:560px;"></div>
          </div>
          <div class="sticky" style="flex-direction:column; gap:6px; align-items:center;">
            <div class="progress-row" style="width:90%; max-width:520px;">
              <div class="muted" style="font-size:14px;">Searching...</div>
              <div class="muted" style="font-size:14px;" id="matchPctLabel">0%</div>
            </div>
            <div class="progress"><div class="progress-fill" id="matchFill"></div></div>
            <div class="subtle" style="margin-top:2px;">Almost there!</div>
          </div>
        </section>
        <!-- Match (Step 5) Duplicate -->
        <section id="screen-match-2" class="screen" aria-labelledby="match-title-2">
          <div class="welcome-top" style="min-height:50vh; padding-bottom:8px; display:flex; flex-direction:column; align-items:center; justify-content:center;">
            <img id="matchSearchIcon2" src="./assets/search-icon.svg" alt="Search" style="display:block; margin:12px auto 16px; width:83px; height:83px;" />
            <header id="match-title-2" class="center" style="font-size:24px; line-height:1.25; padding-top:0; padding-bottom:2px; margin:0;">Finding your perfect Plan!</header>
            <p class="muted center" style="margin:4px 20px 8px; line-height:1.4; font-size:14px;">We're matching the best internet plans to your address and preferences.</p>
            <div class="progress-row" style="width:90%;">
              <div class="progress" aria-label="Matching progress"><div id="matchFill2" class="progress-fill"></div></div>
              <span id="matchPctLabel2" class="muted" style="min-width:36px; text-align:right;">0%</span>
            </div>
            <div id="matchChips2" class="toolbar" style="justify-content:center; gap:8px; flex-wrap:wrap; margin:0 20px;"></div>
          </div>
        </section>
        <!-- Entry -->
        <section id="screen-entry" class="screen" aria-labelledby="entry-title">
          <header id="entry-title">Welcome</header>
          <div class="content">
            <p class="muted">See only plans available at your address ‚Äî compare & activate in minutes.</p>
            <div class="stack" role="group" aria-label="Entry options">
            <button class="cta-secondary" onclick="goto('screen-address')">New customer</button>
              <button class="cta-secondary">Returning customer</button>
              <button class="cta-secondary">Port my number</button>
              <button class="cta-secondary">Explore as guest</button>
            </div>
            <h3>Location & Address</h3>
            <p class="muted">We use your address to show eligible plans. You can edit anytime.</p>
            <div class="stack">
              <button class="cta-secondary" onclick="permissionLocation()">Allow location</button>
              <button class="cta-secondary" onclick="goto('screen-address')">Enter address</button>
            </div>
          </div>
          <div class="sticky">
            <button class="cta" style="flex:1" onclick="goto('screen-address')">Continue</button>
          </div>
        </section>

        <!-- Address -->
        <section id="screen-address" class="screen" aria-labelledby="address-title">
          <div class="address-top">
            <div class="dots" aria-hidden="true"><span class="dot"></span><span class="dot active"></span><span class="dot"></span><span class="dot"></span></div>
            <div class="hero-address" aria-hidden="true" style="width:104px; height:104px; border-radius:52px; box-shadow:0px 0px 0px rgba(64,16,117,.35); margin:50px auto 8px; display:flex; align-items:center; justify-content:center;">
              <img id="addressIcon" src="./assets/address-icon.svg" alt="Address verification icon" style="width:104px; height:104px; border-radius:52px; margin-top:160px; margin-bottom:80px; "  />
            </div>
            <h1 id="address-title" class="display-h1" style="font-size:30px; font-weight:600; line-height:1.25; margin:0; padding-bottom:2px; margin-top:100px; margin-bottom:30px; color:#401075;">Let's check<br/>what's available for you!</h1>
            <p class="subhead" style="margin:4px 20px 24px; line-height:1.4; font-size:18px; margin-bottom:30px;">A fast location check to confirm coverage strength and plan eligibility</p>
          </div>
          <div class="content" style="padding-top:0;">
            <div>
              <label class="section-title" for="door" style="display:block; margin-top:8px;">Postal Code / Address<span class="req" aria-hidden="true">*</span></label>
              <input id="door" type="text" required aria-required="true" placeholder="Enter postal code / address" oninput="onAddressInputChange()" onkeydown="onEnterVerify(event)" style="width:100%; margin-left:auto; margin-right:auto; margin-top:10px;" />
              <div style="margin-top:10px;">
                <button id="useLocationBtn" class="cta-secondary" style="width:100%;" onclick="useCurrentAddress()">Auto-detect location</button>
              </div>
              <div class="center muted" style="margin-top:15px; margin-bottom:20px; font-size:12px;">
                We only use location to show eligible plans
              </div>
              <!-- Inline feasibility check (restored) -->
              <div id="addrFilledDivider" class="divider hidden" style="margin-top:0; margin-bottom:12px;"></div>
              <div id="addrCheckArea" class="hidden" style="margin:6px 0 12px;">
                <div class="progress" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-label="Checking for availability">
                  <div id="addrProgressFill" class="progress-fill" style="width:0%; background:#401075;"></div>
                </div>
                <div id="addrProgressText" class="subtle center" style="margin-top:6px;">Checking for availability‚Ä¶ <span id="addrCountdown">1</span>s</div>
                <div id="addrSuccess" class="badge success hidden" role="status" aria-live="polite" style="margin-top:8px; width:92%; text-align:center;">
                  Great news! Service is available at your address.
                </div>
              </div>
            </div>
          </div>
          <div class="sticky" style="flex-direction:column; gap:8px; align-items:stretch;">
            <button id="showPlansBtn" class="cta cta-lg btn-disabled" style="flex:0 0 auto" onclick="processEligibility()">Show available plans</button>
            <div class="center">
              <button class="cta-secondary" style="width:100%;" onclick="goto('screen-welcome')">Back</button>
            </div>
          </div>
        </section>

        <!-- Processing -->
        <section id="screen-processing" class="screen" aria-live="polite" aria-label="Processing">
          <div class="address-top">
            <div class="dots" aria-hidden="true"><span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot active"></span></div>
            <!-- processing hero image on gradient background -->
            <div style="margin:28px auto 12px; width:70%; max-width:520px; aspect-ratio:1 / 1; border-radius:14px; overflow:hidden; box-shadow:none; background:none;">
              <img id="processingHero" alt="Feasibility illustration" style="display:block; width:100%; height:100%; object-fit:cover; background:none;"/>
              <svg id="processingFallback" class="hidden" viewBox="0 0 640 360" role="img" aria-label="Network feasibility illustration" style="width:100%; height:100%; background:none;">
                <defs>
                  <linearGradient id="pbg" x1="0" x2="0" y1="0" y2="1">
                    <stop offset="0" stop-color="#e9f2ff"/>
                    <stop offset="1" stop-color="#cfe0ff"/>
                  </linearGradient>
                </defs>
                <rect x="0" y="0" width="640" height="360" rx="24" fill="url(#pbg)"/>
                <g transform="translate(0,-10)" stroke="#10305a" stroke-width="6" stroke-linecap="round" stroke-linejoin="round" fill="none">
                  <path d="M280 300h80"/>
                  <path d="M300 300l-40-190h120l-40 190"/>
                  <path d="M260 210h160"/>
                  <path d="M260 250h160"/>
                  <rect x="306" y="70" width="28" height="44" fill="#2b7fff" stroke="#2b7fff"/>
                </g>
                <g fill="none" stroke="#2b7fff" stroke-width="10" stroke-linecap="round">
                  <path d="M320 30c40 0 72 32 72 72"/>
                  <path d="M248 102c0-58 46-104 104-104"/>
                </g>
                <g fill="#2b7fff" stroke="#10305a" stroke-width="6">
                  <circle cx="92" cy="86" r="28"/>
                  <circle cx="548" cy="102" r="28"/>
                  <rect x="80" y="238" width="110" height="70" rx="12" ry="12"/>
                  <rect x="450" y="246" width="110" height="62" rx="12" ry="12"/>
                </g>
              </svg>
            </div>
            <h1 class="display-h1" style="font-size:24px; font-weight:600; line-height:1.25; margin:0; padding-bottom:2px;">Checking Feasibility<br/>&amp; Promotions!</h1>
            <p class="subhead" style="margin:4px 20px 8px; line-height:1.4; font-size:14px;">We'll run a quick, precise check on your address to verify coverage at your building, credit, and location‚Äëtied promos.</p>
          </div>
          <div class="content center" style="padding-top:0; display:flex; flex-direction:column; align-items:center; justify-content:flex-start; gap:8px; background:#ffffff; margin-left:-20px; margin-right:-20px; padding-bottom:12px; padding-top:12px;">
            <div class="ring" id="ring" aria-hidden="true"><span id="ringLabel" class="ring-label">0%</span></div>
            <div class="muted" id="etaText" style="margin-top:0; color:#000;">Estimated time: <span id="etaSeconds">3</span>s</div>
            <!-- ETA default changed below by script as well -->
            <p class="subtle" style="margin-top:0;">If delayed: We'll show cached offers or verify by phone</p>
            <div id="resultBadge" class="badge hidden" role="status" aria-live="polite"></div>
            <div id="failureCard" class="card hidden" style="margin-top:4px; text-align:left;">
              <label style="display:block; font-size:13px;"><input type="checkbox" id="notifyMe2" /> Notify me when available</label>
              <label style="display:block; font-size:13px;"><input type="checkbox" id="checkAnother2" onchange="goto('screen-address')" /> Check a different address</label>
            </div>
          </div>
          <div class="sticky" style="flex-direction:column; gap:8px; align-items:stretch;">
            <button id="procShowPlansBtn" class="cta cta-lg btn-disabled" style="flex:0 0 auto" onclick="goto('screen-personalize')">Show available plans</button>
            <div class="center">
              <button class="cta-secondary" style="width:100%;" onclick="goto('screen-address')">Back</button>
            </div>
          </div>
        </section>

        <!-- Results Minimal -->
        <section id="screen-results-min" class="screen" aria-labelledby="results-min-title">
          <header id="results-min-title">Available plans at your address</header>
          <div class="content">
            <div>
              <span class="chip">Location verified</span>
              <span class="chip">Residential ‚Äî FTTH</span>
              <span class="chip">Best for streaming</span>
              <span class="chip">‚Çπ1200‚Äì1500</span>
            </div>
            <article class="card" role="article" aria-labelledby="planA">
              <div class="plan" id="planA">Provider A ¬∑ Stream Plus 200</div>
              <div class="price">‚Çπ1299 <span class="muted" style="color:#9aa0a6;">/month</span></div>
              <div class="feat">200 Mbps ‚Ä¢ Unlimited ‚Ä¢ Router ‚Ä¢ ETA: 1‚Äì2 days</div>
              <div class="stack" style="margin-top:8px;">
                <span class="elig">‚úÖ Available</span>
                <button class="cta" onclick="goto('screen-activate')">Activate now</button>
              </div>
            </article>
            <article class="card" role="article" aria-labelledby="planB">
              <div class="plan" id="planB">Provider B ¬∑ Family 100</div>
              <div class="price">‚Çπ1099 <span class="muted">/month</span></div>
              <div class="feat">100 Mbps ‚Ä¢ Unlimited ‚Ä¢ Wi‚ÄëFi 6 ‚Ä¢ ETA: 2‚Äì3 days</div>
              <div class="stack" style="margin-top:8px;">
                <span class="elig">‚ö†Ô∏è Partially available</span>
                <button class="cta-secondary" onclick="openCompare()">Compare Plans</button>
                <span class="link" onclick="goto('screen-plan-detail')">Details</span>
              </div>
            </article>
          </div>
          <div class="sticky">
            <button class="cta" style="flex:1" onclick="goto('screen-results-explore')">Switch to Exploratory</button>
          </div>
        </section>

        <!-- Results Exploratory -->
        <section id="screen-results-explore" class="screen" aria-labelledby="results-explore-title">
          <header id="results-explore-title">Explore & Compare</header>
          <div class="content">
            <div>
              <span class="chip">Location verified</span>
              <span class="chip">Residential ‚Äî FTTH</span>
              <span class="chip">Best for streaming</span>
              <span class="chip">‚Çπ1200‚Äì1500</span>
            </div>
            <article class="card">
              <div class="plan">Provider A ¬∑ Stream Plus 200</div>
              <div class="price">‚Çπ1299 <span class="muted">/month</span></div>
              <div class="feat">200 Mbps ‚Ä¢ Unlimited ‚Ä¢ Router ‚Ä¢ ETA: 1‚Äì2 days</div>
              <div class="muted" style="margin:6px 0;">Why recommended: matches budget; FTTH at your building; high streaming interest ‚Üí CDN pack.</div>
              <div class="stack">
                <span class="elig">‚úÖ Available</span>
                <button class="cta-secondary" onclick="openCompare()">Compare Plans</button>
                <button class="cta" onclick="goto('screen-activate')">Activate</button>
              </div>
            </article>
          </div>
          <div class="sticky">
            <button class="cta-secondary" style="flex:1" onclick="goto('screen-results-min')">Minimal</button>
            <button class="cta-secondary" style="flex:1">Bundles</button>
            <button class="cta-secondary" style="flex:1">Show ineligible</button>
          </div>
        </section>

        <!-- Plan Detail Modal -->
        <section id="screen-plan-detail" class="screen" aria-label="Plan details">
          <header>Plan details</header>
          <div class="content">
            <p class="muted">Provider A ¬∑ Stream Plus 200</p>
            <p class="muted">Full T&Cs ‚Ä¢ Installation window by ZIP ‚Ä¢ Activation steps ‚Ä¢ Docs required ‚Ä¢ Cancellation ‚Ä¢ Early termination fees</p>
          </div>
          <div class="sticky">
            <button class="cta-secondary" style="flex:1" onclick="historyBack()">Back</button>
            <button class="cta" style="flex:1" onclick="goto('screen-activate')">Activate this plan</button>
          </div>
        </section>

        <!-- Activate -->
        <section id="screen-activate" class="screen" aria-labelledby="activate-title">
          <header id="activate-title">Activate now</header>
          <div class="content">
            <label class="subtle" for="name">Name</label>
            <input id="name" type="text" placeholder="Full name" />
            <label class="subtle" for="idup">ID upload (optional)</label>
            <input id="idup" type="text" placeholder="Upload link (mock)" />
            <label class="subtle" for="pay">Payment method</label>
            <select id="pay"><option>Card</option><option>UPI</option><option>Net Banking</option></select>
            <div class="row">
              <div>
                <label class="subtle" for="date">Date</label>
                <input id="date" type="date" />
              </div>
              <div>
                <label class="subtle" for="time">Time</label>
                <input id="time" type="time" />
              </div>
            </div>
            <p class="chip" aria-live="polite">Eligibility checks passed ¬∑ credit approved</p>
          </div>
          <div class="sticky">
            <button class="cta" style="flex:1" onclick="goto('screen-confirm')">Confirm & Pay</button>
          </div>
        </section>

        <!-- Book Installation -->
        <section id="screen-book" class="screen">
          <header>Book installation</header>
          <div class="content">
            <label class="subtle" for="date2">Date</label>
            <input id="date2" type="date" />
            <label class="subtle" for="slot">Time slot</label>
            <select id="slot"><option>9‚Äì11 AM</option><option>12‚Äì2 PM</option><option>3‚Äì5 PM</option></select>
            <label class="subtle" for="tech">Technician availability</label>
            <select id="tech"><option>Available</option><option>Waitlist</option></select>
          </div>
          <div class="sticky">
            <button class="cta" style="flex:1" onclick="goto('screen-confirm')">Confirm booking</button>
          </div>
        </section>

        <!-- Chat -->
        <section id="screen-chat" class="screen">
          <header>Chat for help</header>
          <div class="content">
            <p class="muted">Context: Stream Plus 200 ¬∑ Address verified ¬∑ ETA 1‚Äì2d</p>
            <div class="card">You: Do you have a contract-free option?</div>
            <div class="card" style="background:var(--success-bg); border-color:var(--success-line)">Agent: Yes ‚Äî Family 100 is contract-free. Add to compare?</div>
          </div>
          <div class="sticky">
            <input type="text" placeholder="Type a message‚Ä¶" aria-label="Message" />
          </div>
        </section>

        <!-- Confirm & Feedback -->
        <section id="screen-confirm" class="screen">
          <header>You're all set!</header>
          <div class="content">
            <p class="muted">Order #AB12345 ‚Ä¢ Activation by Dec 02 ‚Ä¢ Stream Plus 200</p>
            <div class="card">
              <div class="muted">Next steps: technician will contact you. Add to calendar ‚Ä¢ Share details ‚Ä¢ Save to profile.</div>
            </div>
            <div style="margin-top:8px;">
              <div class="muted">How easy was it to find a plan?</div>
              <div class="stars" role="radiogroup" aria-label="Rate experience">
                <span role="radio" aria-checked="true">‚òÖ</span>
                <span role="radio" aria-checked="true">‚òÖ</span>
                <span role="radio" aria-checked="true">‚òÖ</span>
                <span role="radio" aria-checked="true">‚òÖ</span>
                <span role="radio" aria-checked="false">‚òÜ</span>
              </div>
            </div>
            <textarea rows="4" placeholder="What helped / what was confusing? (optional)"></textarea>
          </div>
          <div class="sticky">
            <button class="cta" style="flex:1" onclick="goto('screen-entry')">Submit feedback</button>
          </div>
        </section>

        <!-- Compare Drawer -->
        <div id="overlay" class="overlay hidden" onclick="closeCompare()" aria-hidden="true"></div>
        <aside id="drawer" class="drawer hidden" aria-label="Comparison drawer">
          <div class="row" style="align-items:center; justify-content:center; margin-bottom:6px;">
            <div class="plan" style="text-align:center;">Compare Plans</div>
          </div>
          <!-- Comparison table -->
          <div class="card" style="padding:0;">
            <div class="cmp-scroll">
              <div>
                <div class="cmp-row cmp-head">
                  <div></div>
                  <div class="center" style="font-weight:800;">Fiber Pro Giga Plan</div>
                  <div class="center" style="font-weight:800;">Fiber 500</div>
                  <div class="center" style="font-weight:800;">Fiber 300</div>
                  <div class="center" style="font-weight:800;">Basic 100</div>
                </div>
                <div class="cmp-row">
                  <div class="cmp-feat"><span>Download Speed</span></div>
                  <div class="cmp-val">Up to 1 Gbps</div>
                  <div class="cmp-val">Up to 500 Mbps</div>
                  <div class="cmp-subtle cmp-val">Up to 300 Mbps</div>
                  <div class="cmp-subtle cmp-val">Up to 100 Mbps</div>
                </div>
                <div class="cmp-row">
                  <div class="cmp-feat"><span>Data Allowance</span></div>
                  <div class="cmp-val">Unlimited</div>
                  <div class="cmp-val">Unlimited</div>
                  <div class="cmp-subtle cmp-val">Unlimited</div>
                  <div class="cmp-subtle cmp-val">Unlimited</div>
                </div>
                <div class="cmp-row">
                  <div class="cmp-feat"><span>Connected Devices</span></div>
                  <div class="cmp-subtle cmp-val">15+</div>
                  <div class="cmp-subtle cmp-val">5+</div>
                  <div class="cmp-val">10+</div>
                  <div class="cmp-subtle cmp-val">15+</div>
                </div>
                <div class="cmp-row">
                  <div class="cmp-feat"><span>Streaming Quality</span></div>
                  <div class="cmp-val">4K UHD</div>
                  <div class="cmp-subtle cmp-val">HD</div>
                  <div class="cmp-subtle cmp-val">4K UHD</div>
                  <div class="cmp-subtle cmp-val">4K UHD</div>
                </div>
                <div class="cmp-row">
                  <div class="cmp-feat"><span>Wi‚ÄëFi Router</span></div>
                  <div class="cmp-yes cmp-val">‚úì</div>
                  <div class="cmp-yes cmp-val">‚úì</div>
                  <div class="cmp-yes cmp-val">‚úì</div>
                  <div class="cmp-no cmp-val">‚úó</div>
                </div>
                <div class="cmp-row">
                  <div class="cmp-feat"><span>Free Streaming</span></div>
                  <div class="cmp-yes cmp-val">‚úì</div>
                  <div class="cmp-no cmp-val">‚úó</div>
                  <div class="cmp-no cmp-val">‚úó</div>
                  <div class="cmp-no cmp-val">‚úó</div>
                </div>
              </div>
            </div>
          </div>
          <div class="row" style="margin-top:10px;">
            <button class="cta" style="flex:1" onclick="closeCompare()">Close</button>
          </div>
        </aside>
        <!-- Simple phone home/lock screen -->
        <section id="screen-lock" class="screen" aria-labelledby="lock-title">
          <header id="lock-title" style="display:none;"></header>
          <div class="content" style="padding:0 0 12px; position:relative;">
            <img src="./assets/Lock-screen.svg" alt="Phone home screen" style="width:100%; height:auto; display:block;" />
            <!-- SMS-style pop-up card -->
            <div onclick="goToDashboardWithOffer()" style="position:absolute; left:4%; right:4%; bottom:28px; background:rgba(255,255,255,0.30); border:1px solid rgba(0,0,0,0.08); border-radius:18px; padding:12px; box-shadow:0 14px 40px rgba(0,0,0,.25); display:flex; gap:10px; align-items:flex-start; backdrop-filter: blur(6px); cursor:pointer;">
              <div style="width:36px; height:36px; border-radius:10px; background:#ffffff; display:flex; align-items:center; justify-content:center;">
                <img src="./assets/Welcome-icon.svg" alt="Telco icon" style="width:26px; height:26px; display:block;" />
              </div>
              <div style="flex:1;">
                <div class="plan" style="font-size:14px; margin:0; font-weight:700;">Telco Offer</div>
                <div style="font-size:13px; line-height:1.35; color:#111; margin-top:2px;">
                  Telco Offer! Unlimited 5G+ for $65/mo! Stop running out of data. Get Ultra‚ÄëFast 5G+ &amp; 50GB Hotspot. Exclusive offer expires soon! Tap to upgrade now.
                </div>
              </div>
              <div class="muted" style="font-size:12px; color:#6b7280; white-space:nowrap;">now</div>
            </div>
          </div>
          <!-- Removed Open App button; tap the SMS card to open the offer -->
        </section>
        <!-- AI Assistant scrim overlay (restored) -->
        <div id="aiOverlay" class="overlay hidden" onclick="closeAISheet()" aria-hidden="true"></div>
        <!-- Dashboard Offer overlay and modal -->
        <div id="dashOfferOverlay" class="overlay hidden" onclick="closeDashOffer()" aria-hidden="true"></div>
        <div id="dashOfferModal" class="hidden" role="dialog" aria-label="Offer modal"
             style="position:fixed; left:50%; top:50%; transform:translate(-50%,-50%); width:92%; max-width:340px; background:#ffffff; border:1px solid var(--line); border-radius:14px; padding:14px; box-shadow:0 20px 60px rgba(0,0,0,.25); z-index:1000;">
          <button aria-label="Close offer" onclick="closeDashOffer()"
                  style="position:absolute; top:10px; right:10px; padding:10px 8px; border:none; background:transparent; font-size:20px; line-height:1; cursor:pointer;">√ó</button>
          <div class="row" style="align-items:center; justify-content:flex-start; padding-right:28px;">
            <div class="plan" style="font-size:16px;">Upgrade to Unlimited Data</div>
          </div>
          <div class="row" style="align-items:center; justify-content:space-between; margin-top:6px;">
            <div class="price" style="font-size:28px;">$65<span class="muted">/mo</span></div>
            <span class="pill pill-high">SAVE $10/mo</span>
          </div>
          <div class="muted" style="margin-top:6px;">Get our best plan ever, just for you.</div>
          <ul class="muted" style="margin:6px 0 0 18px; padding:0;">
            <li><strong>Ultra‚ÄëFast 5G+</strong> ‚Äî Unthrottled Speed</li>
            <li><strong>50 GB Hotspot</strong> ‚Äî +20 GB from current</li>
          </ul>
          <div class="row" style="margin-top:10px;">
            <button class="cta" style="flex:1" onclick="closeDashOffer(); goto('screen-offer-special')">Explore this Offer</button>
          </div>
        </div>
        <!-- AI Assistant Bottom Sheet (primary) -->
        <aside id="aiDrawer" class="drawer hidden" role="dialog" aria-label="AI Assistant" style="max-height:95%; overflow:auto;">
          <div style="position:sticky; top:0; background:#fff; text-align:center; margin-top:0; margin-bottom:0; z-index:2; padding-top:5px;">
            <div class="plan" style="font-weight:800; text-align:center; font-size:18px; color:#401075;">AI Assistant</div>
            <span role="button" tabindex="0" onclick="closeAISheet()" style="position:absolute; right:5px; top:5px; cursor:pointer;">‚úï</span>
            <div class="divider"></div>
          </div>
          <article class="card" style="background:transparent; border:0; box-shadow:none; padding:0;">
            <div id="aiChatBody">
              <div class="chat-row">
                <div class="chat-avatar agent"><img src="./assets/AI-Assistant-icon.svg" alt="AI Assistant" style="width:34px; height:34px;" /></div>
                <div class="chat-bubble" style="font-size:14px; line-height:1.4;">
                  <div>üëã <strong>Welcome to Telco!</strong></div>
                  <div style="margin-top:6px;">Before we begin, what would you like help with today?</div>
                  <div id="aiTopics" class="toolbar ai-selectable" style="margin-top:10px;">
                    <span class="chip chip-white" role="button" tabindex="0" onclick="aiToggleChip(this)">Get faster internet</span>
                    <span class="chip chip-white" role="button" tabindex="0" onclick="aiToggleChip(this)">Lower my monthly bill</span>
                    <span class="chip chip-white" role="button" tabindex="0" onclick="aiToggleChip(this)">Switch providers</span>
                    <span class="chip chip-white" role="button" tabindex="0" onclick="aiToggleChip(this)">Build a custom bundle</span>
                    <span class="chip chip-white" role="button" tabindex="0" onclick="aiToggleChip(this)">Not sure yet</span>
                  </div>
                  <button id="aiTopicsBtn" class="cta-secondary ai-action" style="margin-top:8px; display:none; height:30px; width:auto;" onclick="submitAiTopics()">Select</button>
                </div>
              </div>
            </div>
          </article>
          <div class="ai-input" style="display:flex; align-items:center; gap:8px; background:#f6f7fa; border:1px solid var(--line); border-radius:999px; padding:10px 14px;">
            <input id="aiSheetInput" type="text" placeholder="Ask AI anything..." onkeydown="if(event.key==='Enter'){sendAIMessage()}" style="flex:1; border:0; outline:none; background:transparent; font-size:14px;" />
            <span role="button" tabindex="0" aria-label="Send message" onclick="sendAIMessage()" style="font-size:22px; color:#6b7280; cursor:pointer;">‚û§</span>
          </div>
        </aside>
        <!-- AI Assistant Bottom Sheet (Duplicate) -->
        <aside id="aiDrawer2" class="drawer hidden" role="dialog" aria-label="AI Assistant (duplicate)" style="max-height:95%; overflow:auto;">
          <div style="position:sticky; top:0; background:#fff; text-align:center; margin-top:0; margin-bottom:0; z-index:2; padding-top:5px;">
            <div class="plan" style="font-weight:800; text-align:center; font-size:18px; color:#401075;">AI Assistant</div>
            <span role="button" tabindex="0" onclick="closeAISheet()" style="position:absolute; right:5px; top:5px; cursor:pointer;">‚úï</span>
            <div class="divider"></div>
          </div>
          <article class="card" style="background:transparent; border:0; box-shadow:none; padding:0;">
            <div id="aiChatBody2">
              <div class="chat-row">
                <div class="chat-avatar agent"><img src="./assets/AI-Assistant-icon.svg" alt="AI Assistant" style="width:34px; height:34px;" /></div>
                <div class="chat-bubble" style="font-size:14px; line-height:1.4;">
                  <div>üëã <strong>Welcome to Telco!</strong></div>
                  <div style="margin-top:6px;">Before we begin, what would you like help with today?</div>
                  <div id="aiTopics2" class="toolbar ai-selectable" style="margin-top:10px;">
                    <span class="chip chip-white" role="button" tabindex="0" onclick="aiToggleChip(this)">Get faster internet</span>
                    <span class="chip chip-white" role="button" tabindex="0" onclick="aiToggleChip(this)">Lower my monthly bill</span>
                    <span class="chip chip-white" role="button" tabindex="0" onclick="aiToggleChip(this)">Switch providers</span>
                    <span class="chip chip-white" role="button" tabindex="0" onclick="aiToggleChip(this)">Build a custom bundle</span>
                    <span class="chip chip-white" role="button" tabindex="0" onclick="aiToggleChip(this)">Not sure yet</span>
                  </div>
                  <button id="aiTopicsBtn2" class="cta-secondary ai-action" style="margin-top:8px; display:none; height:30px; width:auto;" onclick="submitAiTopics()">Select</button>
                </div>
              </div>
            </div>
          </article>
          <div class="ai-input" style="display:flex; align-items:center; gap:8px; background:#f6f7fa; border:1px solid var(--line); border-radius:999px; padding:10px 14px;">
            <input id="aiSheetInput2" type="text" placeholder="Ask AI anything..." onkeydown="if(event.key==='Enter'){sendAIMessage()}" style="flex:1; border:0; outline:none; background:transparent; font-size:14px;" />
            <span role="button" tabindex="0" aria-label="Send message" onclick="sendAIMessage()" style="font-size:22px; color:#6b7280; cursor:pointer;">‚û§</span>
          </div>
        </aside>
      </div>
    </div>
    <script>
      const screens = Array.from(document.querySelectorAll('.screen'));
      let topPriorityOrder = [];
      let productPreference = null;
      let budgetChoice = null;
      let dataNeedChoice = null;
      // Persona selection (restored)
      let personaChoice = null;
      function selectPersona(cardEl, label) {
        personaChoice = label;
        const cards = Array.from(document.querySelectorAll('#screen-persona .persona-card'));
        cards.forEach(c => c.classList.remove('selected'));
        if (cardEl) cardEl.classList.add('selected');
        const cont = document.getElementById('personaContinueBtn');
        if (cont) cont.classList.remove('btn-disabled');
      }
      function getAddonsForPersona(persona) {
        const generic = ['Parental controls','Hotspot booster'];
        if (!persona) return generic;
        const p = persona.toLowerCase();
        if (p.includes('work & travel')) return ['Roaming pack', 'International minutes', 'Hotspot booster'];
        if (p.includes('family')) return ['Parental controls', 'Extra line discount', 'Hotspot booster'];
        if (p.includes('power') || p.includes('gamer')) return ['Gaming latency booster', 'Hotspot booster'];
        if (p.includes('entertainment')) return ['Streaming bundle', 'Hotspot booster'];
        if (p.includes('budget')) return ['Data saver add‚Äëon', 'Roaming pack'];
        return generic;
      }
      function computePersonaNeeds(persona) {
        const p = (persona || '').toLowerCase();
        if (!p) return ['speed', 'coverage'];
        if (p.includes('work & travel') || p.includes('work') || p.includes('travel')) return ['roaming', 'hotspot'];
        if (p.includes('family')) return ['budget', 'extra lines'];
        if (p.includes('power') || p.includes('gamer')) return ['speed', 'low‚Äëlatency'];
        if (p.includes('entertainment')) return ['streaming', 'bundles'];
        if (p.includes('budget')) return ['budget', 'saver'];
        if (p.includes('everyday')) return ['reliability', 'simplicity'];
        return ['speed', 'coverage'];
      }
      function getFeatureDataForPersona(persona) {
        const p = (persona || '').toLowerCase();
        const base = { speed: '500 Mbps', hotspot: '10 GB', roaming: 'Standard coverage', promo: 'Welcome offer' };
        if (!p) return base;
        if (p.includes('work & travel') || p.includes('work') || p.includes('travel')) {
          return { speed: '5G+ (300‚Äì500 Mbps)', hotspot: '20 GB', roaming: '100+ countries', promo: 'Free international minutes' };
        }
        if (p.includes('power') || p.includes('gamer')) {
          return { speed: 'Up to 1 Gbps', hotspot: '30 GB', roaming: 'Domestic + Intl add-on', promo: 'Low-latency gaming boost' };
        }
        if (p.includes('entertainment')) {
          return { speed: '500‚Äì700 Mbps', hotspot: '15 GB', roaming: 'Domestic focus', promo: 'Streaming bundle discount' };
        }
        if (p.includes('family')) {
          return { speed: '300‚Äì500 Mbps', hotspot: '10 GB shared', roaming: 'Domestic + Family add-ons', promo: 'Family lines discount' };
        }
        if (p.includes('budget')) {
          return { speed: '100‚Äì200 Mbps', hotspot: '5 GB', roaming: 'Domestic', promo: 'Saver plan pricing' };
        }
        if (p.includes('everyday')) {
          return { speed: '200‚Äì300 Mbps', hotspot: '5 GB', roaming: 'Domestic', promo: 'Essential plan' };
        }
        return base;
      }
      function formatPersonaGreeting(label) {
        if (!label) return 'Hello!';
        const appendUser = /user/i.test(label) ? label : (label + ' User');
        return 'Hello!<br/>' + appendUser;
      }
      function populatePersonaWelcome2() {
        const titleEl = document.getElementById('welcome2-title');
        if (titleEl) titleEl.innerHTML = formatPersonaGreeting(personaChoice);
        const container = document.getElementById('addonsContainer2');
        if (container) {
          container.innerHTML = '';
          const addons = getAddonsForPersona(personaChoice);
          addons.forEach(name => {
            const label = document.createElement('label');
            label.style.display = 'flex';
            label.style.alignItems = 'center';
            label.style.gap = '8px';
            label.style.fontSize = '13px';
            const cb = document.createElement('input');
            cb.type = 'checkbox';
            cb.style.width = '18px';
            cb.style.height = '18px';
            cb.addEventListener('change', updateWelcomeCtaEnabled);
            const span = document.createElement('span');
            span.textContent = name;
            span.style.fontSize = '13px';
            label.appendChild(cb);
            label.appendChild(span);
            container.appendChild(label);
          });
          // Pre-check first add-on
          const firstAddon = container.querySelector('input[type="checkbox"]');
          if (firstAddon && !firstAddon.checked) firstAddon.checked = true;
        }
        // Auto-select some chips based on persona
        const selectChip = (toolbar, labels) => {
          if (!toolbar) return;
          labels.forEach(lbl => {
            const chip = Array.from(toolbar.querySelectorAll('.chip-toggle')).find(c => c.textContent.trim().toLowerCase() === lbl.toLowerCase());
            if (chip && !chip.classList.contains('selected')) chip.click();
          });
        };
        const tb1 = document.getElementById('priorityGroup2');
        const tb2 = document.getElementById('preferenceGroup2');
        const p = (personaChoice || '').toLowerCase();
        if (p.includes('everyday')) { selectChip(tb1, ['Speed','Budget']); selectChip(tb2, ['Prepaid']); }
        else if (p.includes('work & travel')) { selectChip(tb1, ['Roaming','Speed']); selectChip(tb2, ['Postpaid']); }
        else if (p.includes('family')) { selectChip(tb1, ['Budget','Flexibility']); selectChip(tb2, ['Postpaid']); }
        else if (p.includes('power') || p.includes('gamer')) { selectChip(tb1, ['Speed','Reliability']); selectChip(tb2, ['Postpaid']); }
        else if (p.includes('entertainment')) { selectChip(tb1, ['Speed','Flexibility']); selectChip(tb2, ['Postpaid']); }
        else if (p.includes('budget')) { selectChip(tb1, ['Budget','Flexibility']); selectChip(tb2, ['Prepaid']); }
        updateWelcomeCtaEnabled();
      }
      function welcomeFindPlansDup() {
        if (!(topPriorityOrder.length && productPreference)) {
          alert('Please select at least one Top Priority and a Product Preference to continue.');
          return;
        }
        const addonsOk = document.querySelectorAll('#addonsContainer2 input[type="checkbox"]:checked').length > 0;
        if (!addonsOk) {
          alert('Please select at least one recommended add‚Äëon to continue.');
          return;
        }
        goto('screen-address-2');
      }
      let streamChoice = null;
      let linesChoice = null;
      let intlChoice = null;
      let lastAddress = { street:'', city:'', state:'', zip:'', country:'' };
      let currentPlan = null; // holds the last selected plan for review
      let modEstCost = 0; // estimated cost impact from Modify flow
      let isUpgradeFlow = false; // track if current flow is an upgrade
      let reviewBackTarget = 'screen-results-reco';
      function goto(id) {
        screens.forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        window.scrollTo(0, 0);
        // Adjust phone scroll: disable on success to avoid vertical scroll
        const phoneEl = document.querySelector('.phone');
        if (phoneEl) {
          phoneEl.style.overflow = (id === 'screen-success') ? 'hidden' : 'auto';
        }
        if (id === 'screen-processing') refreshProcessingHero();
        if (id === 'screen-match' || id === 'screen-match-2') startMatchProgress();
        if (id === 'screen-results-reco' || id === 'screen-results-reco-2') { updatePopularZip(); updateRecoWhySignals(); }
        if (id === 'screen-review') { populateReviewScreen(); }
        if (id === 'screen-review-2') { populateReviewScreen2(); }
        if (id === 'screen-welcome-2') { populatePersonaWelcome2(); }
      }
      function openDashOffer() {
        const o = document.getElementById('dashOfferOverlay');
        const m = document.getElementById('dashOfferModal');
        if (o) o.classList.remove('hidden');
        if (m) m.classList.remove('hidden');
      }
      function closeDashOffer() {
        const o = document.getElementById('dashOfferOverlay');
        const m = document.getElementById('dashOfferModal');
        if (o) o.classList.add('hidden');
        if (m) m.classList.add('hidden');
      }
      function goToDashboardWithOffer() {
        goto('screen-dashboard');
        setTimeout(openDashOffer, 0);
      }
      function selectTopPriority(el, label) {
        // Toggle selection and maintain ordered priorities
        const currentIdx = topPriorityOrder.indexOf(label);
        if (currentIdx === -1) {
          topPriorityOrder.push(label);
          el.classList.add('selected');
        } else {
          topPriorityOrder.splice(currentIdx, 1);
          el.classList.remove('selected');
        }
        // Re-number badges
        const groups = [document.getElementById('priorityGroup1'), document.getElementById('priorityGroup2')];
        groups.forEach(g => {
          if (!g) return;
          Array.from(g.querySelectorAll('.chip-toggle')).forEach(chip => {
            const lbl = chip.textContent.trim();
            const rank = topPriorityOrder.indexOf(lbl);
            if (rank >= 0) chip.setAttribute('data-rank', String(rank + 1));
            else chip.removeAttribute('data-rank');
          });
        });
        tag('top_priority_updated:' + topPriorityOrder.join('|'));
        updateWelcomeCtaEnabled();
      }
      function selectProductPref(el, label) {
        const group = el.closest('.toolbar') || document.getElementById('preferenceGroup');
        if (group) Array.from(group.querySelectorAll('.chip-toggle')).forEach(c => c.classList.remove('selected'));
        el.classList.add('selected');
        productPreference = label;
        tag('product_preference:' + label);
        updateWelcomeCtaEnabled();
      }
      function welcomeFindPlans() {
        const v = (document.getElementById('affinityNotes').value || '').trim();
        if (!(topPriorityOrder.length && productPreference)) {
          alert('Please select at least one Top Priority and a Product Preference to continue.');
          return;
        }
        if (topPriorityOrder.length) tag('top_priorities_final:' + topPriorityOrder.join('|'));
        if (productPreference) tag('product_preference_final:' + productPreference);
        if (v) tag('affinity_notes');
        goto('screen-address');
      }
      function updateWelcomeCtaEnabled() {
        const enable = topPriorityOrder.length && productPreference;
        // If addons are present in welcome-2, require at least one to be selected
        const addonsContainer = document.getElementById('addonsContainer2');
        const addonsValid = addonsContainer
          ? addonsContainer.querySelectorAll('input[type="checkbox"]:checked').length > 0
          : true;
        const btn1 = document.getElementById('welcomeCta');
        const btn2 = document.getElementById('welcomeCta2');
        [btn1, btn2].forEach(btn => {
          if (!btn) return;
          const requireAddons = btn === btn2 && !!addonsContainer;
          const ok = enable && (!requireAddons || addonsValid);
          if (ok) btn.classList.remove('btn-disabled');
          else btn.classList.add('btn-disabled');
        });
      }
      function historyBack() {
        // Simple back to results-min
        goto('screen-results-min');
      }
      function permissionLocation() {
        alert('Location permission mocked. Using coarse location.\nYou can also enter address manually.');
      }
      // Address screen interactivity (supports original and duplicate)
      let addressVerified = null; // true | false | null
      let addrCheckTimer = null;
      function addrEl(id) {
        const isDup = !!document.getElementById('screen-address-2')?.classList.contains('active');
        const preferred = id + (isDup ? '2' : '');
        return document.getElementById(preferred) || document.getElementById(id);
      }
      function resetAddrCheckUI() {
        const div = addrEl('addrFilledDivider');
        const wrap = addrEl('addrCheckArea');
        const fill = addrEl('addrProgressFill');
        const countdown = addrEl('addrCountdown');
        const ok = addrEl('addrSuccess');
        if (div) div.classList.add('hidden');
        if (wrap) wrap.classList.add('hidden');
        if (fill) fill.style.width = '0%';
        if (countdown) countdown.textContent = '1';
        if (ok) ok.classList.add('hidden');
        if (addrCheckTimer) { clearInterval(addrCheckTimer); addrCheckTimer = null; }
      }
      function startAddrCheck() {
        const div = addrEl('addrFilledDivider');
        const wrap = addrEl('addrCheckArea');
        const fill = addrEl('addrProgressFill');
        const countdown = addrEl('addrCountdown');
        const ok = addrEl('addrSuccess');
        const btn = addrEl('showPlansBtn');
        if (btn) btn.classList.add('btn-disabled');
        if (ok) ok.classList.add('hidden');
        if (div) div.classList.remove('hidden');
        if (wrap) wrap.classList.remove('hidden');
        if (fill) fill.style.width = '0%';
        let p = 0;
        const durationMs = 1000, tickMs = 100;
        let remainingMs = durationMs;
        if (countdown) countdown.textContent = String(Math.ceil(remainingMs/1000));
        if (addrCheckTimer) clearInterval(addrCheckTimer);
        addrCheckTimer = setInterval(() => {
          p += 100 * (tickMs / durationMs);
          if (p > 100) p = 100;
          remainingMs = Math.max(0, remainingMs - tickMs);
          if (fill) fill.style.width = p + '%';
          if (countdown) countdown.textContent = String(Math.ceil(remainingMs / 1000));
          if (p >= 100) {
            clearInterval(addrCheckTimer);
            addrCheckTimer = null;
            if (btn) btn.classList.remove('btn-disabled');
            if (ok) ok.classList.remove('hidden');
          }
        }, tickMs);
      }
      function onAddressInputChange() {
        const street = (addrEl('door')?.value || '').trim();
        const showBtn = addrEl('showPlansBtn');
        if (!showBtn) return;
        if (street.length > 0) startAddrCheck();
        else { showBtn.classList.add('btn-disabled'); resetAddrCheckUI(); }
      }
      function useCurrentAddress() {
        const useBtn = addrEl('useLocationBtn');
        const showBusy = (busy, label) => {
          if (!useBtn) return;
          if (busy) {
            useBtn.classList.add('btn-busy-secondary');
            useBtn.textContent = 'Detecting Location...';
          } else {
            useBtn.classList.remove('btn-busy-secondary');
            useBtn.textContent = label || 'Auto-detect location';
          }
        };
        const fillFields = ({ street, zip }) => {
          const input = addrEl('door');
          if (input) input.value = zip || street || 'Current Location (detected)';
          onAddressInputChange();
        };
        if (!navigator.geolocation) {
          permissionLocation();
          fillFields({ street: 'Current Location (mock)' });
          showBusy(false, 'Auto-detect location');
          return;
        }
        showBusy(true);
        navigator.geolocation.getCurrentPosition(async (pos) => {
          try {
            const { latitude, longitude } = pos.coords;
            const url = `https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${latitude}&lon=${longitude}`;
            const resp = await fetch(url, { headers: { 'Accept': 'application/json' } });
            if (!resp.ok) throw new Error('reverse geocode failed');
            const data = await resp.json();
            const a = data.address || {};
            const streetCandidate1 = [a.house_number, a.road].filter(Boolean).join(' ').trim();
            const streetCandidate2 = a.road;
            const streetCandidate3 = a.residential || a.pedestrian || a.path || a.footway || a.neighbourhood || a.suburb;
            const streetCandidate4 = data.name;
            const streetCandidate5 = (data.display_name || '').split(',')[0]?.trim();
            const street = streetCandidate1 || streetCandidate2 || streetCandidate3 || streetCandidate4 || streetCandidate5 || '';
            const zip = a.postcode || '';
            fillFields({ street, zip });
          } catch (e) {
            console.warn('Reverse geocoding failed:', e);
            fillFields({ street: 'Current Location (detected)' });
            showBusy(false, 'Auto-detect location');
            return;
          }
          showBusy(false, 'Auto-detect location');
        }, (err) => {
          console.warn('Geolocation denied/unavailable:', err);
          permissionLocation();
          fillFields({ street: 'Current Location (mock)' });
          showBusy(false, 'Auto-detect location');
        }, { enableHighAccuracy: true, timeout: 8000, maximumAge: 60000 });
      }
      function resetAddressScreen(fromCheckbox) {
        const input = addrEl('door');
        if (input) input.value = '';
        onAddressInputChange();
        if (!fromCheckbox) goto('screen-address');
      }
      function onEnterVerify(e) {
        if (e && e.key === 'Enter') processEligibility();
      }
      function tag(t) {
        console.log('signal:', t);
      }
      function processEligibility() {
        // Determine simple success/failure based on entered address data
        const entered = (addrEl('door')?.value || '').toLowerCase();
        const street = entered;
        const city = '';
        const state = '';
        const zip = entered;
        const country = '';
        const addrStr = entered;
        const failed = addrStr.includes('000') || addrStr.includes('no ');
        lastAddress = { street, city, state, zip, country };

        // Proceed to next step: duplicate address goes to duplicate results, original continues flow
        const isDupActive = !!document.getElementById('screen-address-2')?.classList.contains('active');
        goto(isDupActive ? 'screen-results-reco-2' : 'screen-personalize');
      }
      function openCompare() {
        document.getElementById('overlay').classList.remove('hidden');
        document.getElementById('drawer').classList.remove('hidden');
        // Disable vertical scrolling while compare modal is open
        document.body.style.overflow = 'hidden';
        const phone = document.querySelector('.phone');
        if (phone) phone.style.overflow = 'hidden';
      }
      function closeCompare() {
        document.getElementById('overlay').classList.add('hidden');
        document.getElementById('drawer').classList.add('hidden');
        // Restore scrolling
        document.body.style.overflow = '';
        const phone = document.querySelector('.phone');
        if (phone) phone.style.overflow = 'auto';
      }
      // Bust cache for address icon so latest asset always loads
      (function ensureFreshAddressIcon() {
        const img = document.getElementById('addressIcon');
        if (img) {
          const base = './assets/address-icon.svg';
          img.src = base + '?v=' + Date.now();
        }
      })();
      // Bust cache for personalize icon so latest asset always loads
      (function ensureFreshPersonalizeIcon() {
        const img = document.getElementById('personalizeIcon');
        if (img) {
          const base = './assets/your-icon.svg';
          img.src = base + '?v=' + Date.now();
        }
      })();
      // Bust cache for match search icon
      (function ensureFreshMatchSearchIcon() {
        const img = document.getElementById('matchSearchIcon');
        if (img) {
          const base = './assets/search-icon.svg';
          img.src = base + '?v=' + Date.now();
        }
      })();
      // Bust cache for top pick icon so latest asset always loads
      (function ensureFreshTopPickIcon() {
        const img = document.getElementById('topPickIcon');
        if (img) {
          const base = './assets/Toppick-icon.svg';
          img.src = base + '?v=' + Date.now();
        }
      })();
      /* Inline SVGs used for headers - no cache-bust needed */
      // Step 4 helpers
      function updateBudgetValue() {
        /* no-op; slider removed */
      }
      function updateDataNeedValue() {
        /* no-op; slider removed */
      }
      function selectStream(el, label) {
        const g = document.getElementById('qStreamGroup');
        Array.from(g.querySelectorAll('.chip-toggle')).forEach(c => c.classList.remove('selected'));
        el.classList.add('selected');
        tag('stream_pref:' + label);
        streamChoice = label;
        updatePersonalizeCtaEnabled();
      }
      function updateLinesValue() {
        /* no-op; slider removed */
      }
      function selectBudget(el, label) {
        const g = document.getElementById('qBudgetGroup');
        Array.from(g.querySelectorAll('.chip-toggle')).forEach(c => c.classList.remove('selected'));
        el.classList.add('selected');
        tag('budget:' + label);
        budgetChoice = label;
        updatePersonalizeCtaEnabled();
      }
      function selectDataNeed(el, label) {
        const g = document.getElementById('qDataGroup');
        Array.from(g.querySelectorAll('.chip-toggle')).forEach(c => c.classList.remove('selected'));
        el.classList.add('selected');
        tag('data_need:' + label);
        dataNeedChoice = label;
        updatePersonalizeCtaEnabled();
      }
      function selectLinesChip(el, label) {
        const g = document.getElementById('qLinesGroup');
        Array.from(g.querySelectorAll('.chip-toggle')).forEach(c => c.classList.remove('selected'));
        el.classList.add('selected');
        tag('lines:' + label);
        linesChoice = label;
        updatePersonalizeCtaEnabled();
      }
      function selectIntl(el, yes) {
        const g = document.getElementById('qIntlGroup');
        Array.from(g.querySelectorAll('.chip-toggle')).forEach(c => c.classList.remove('selected'));
        el.classList.add('selected');
        tag('intl_usage:' + (yes ? 'yes' : 'no'));
        intlChoice = yes ? 'International: Yes' : 'International: No';
        updatePersonalizeCtaEnabled();
      }
      function updatePersonalizeCtaEnabled() {
        const btn = document.getElementById('personalizeCta');
        if (!btn) return;
        const anySelected = Boolean(budgetChoice || dataNeedChoice || streamChoice || linesChoice || (typeof intlChoice !== 'undefined' && intlChoice !== null));
        if (anySelected) {
          btn.classList.remove('btn-disabled');
        } else {
          btn.classList.add('btn-disabled');
        }
      }
      function updateRangeFill(el){
        if (!el) return;
        const min = Number(el.min || 0), max = Number(el.max || 100), val = Number(el.value || 0);
        const pct = ((val - min) * 100) / (max - min);
        el.style.setProperty('--val', pct + '%');
      }
      // Initialize range backgrounds on load
      document.addEventListener('DOMContentLoaded', () => { refreshProcessingHero(); });
      // Bust cache and set up fallback for processing hero
      function refreshProcessingHero() {
        const img = document.getElementById('processingHero');
        const fb = document.getElementById('processingFallback');
        if (!img) return;
        img.onerror = () => { img.style.display = 'none'; if (fb) fb.classList.remove('hidden'); };
        img.onload = () => { img.style.display = 'block'; if (fb) fb.classList.add('hidden'); };
        const base = './assets/processing-hero.svg';
        img.src = base + '?v=' + Date.now();
      }
      // Step 5 progress
      function matchEl(idBase) {
        const use2 = document.getElementById('screen-match-2')?.classList.contains('active');
        return document.getElementById(idBase + (use2 ? '2' : '')) || document.getElementById(idBase);
      }
      function startMatchProgress() {
        const fill = matchEl('matchFill');
        const label = matchEl('matchPctLabel');
        const chips = matchEl('matchChips');
        if (!fill || !label) return;
        fill.style.width = '0%';
        label.textContent = '0%';
        // build meta chips
        if (chips) {
          const items = [];
          if (topPriorityOrder.length) items.push(...topPriorityOrder.slice(0,4));
          if (productPreference) items.push(productPreference);
          const aff = (document.getElementById('affinityNotes')?.value || '').trim();
          if (aff) items.push('Affinity: ' + (aff.length > 28 ? aff.slice(0,28) + '‚Ä¶' : aff));
          const zipOnly = (lastAddress.zip || '').toUpperCase();
          if (zipOnly) items.push('ZIP: ' + zipOnly);
          if (budgetChoice) items.push('Budget: ' + budgetChoice);
          if (dataNeedChoice) items.push(dataNeedChoice);
          if (streamChoice) items.push(streamChoice);
          if (linesChoice) items.push(linesChoice);
          if (intlChoice) items.push(intlChoice);
          chips.innerHTML = items.map(t => '<span class="chip">' + t.replace(/</g,'&lt;') + '</span>').join('');
        }
        let p = 0;
        const t = setInterval(() => {
          p += 3;
          if (p > 100) p = 100;
          fill.style.width = p + '%';
          label.textContent = p + '%';
          if (p >= 100) {
            clearInterval(t);
            const isDupMatch = !!document.getElementById('screen-match-2')?.classList.contains('active');
            setTimeout(() => goto(isDupMatch ? 'screen-results-reco-2' : 'screen-results-reco'), 400);
          }
        }, 80);
      }
      function updatePopularZip() {
        const zip = (lastAddress.zip || '').toUpperCase();
        ['popularZip', 'popularZip2'].forEach(id => {
          const el = document.getElementById(id);
          if (el) el.textContent = zip || 'YOUR ZIP';
        });
      }
      function updateRecoWhySignals() {
        const zip = (lastAddress.zip || '').toUpperCase();
        const top = (topPriorityOrder && topPriorityOrder.length > 0) ? topPriorityOrder[0] : 'your top priority';
        const pref = productPreference || 'your product preferences';
        ['whyZip','whyZip2'].forEach(id => { const el = document.getElementById(id); if (el) el.textContent = zip || 'YOUR ZIP'; });
        ['whyTop','whyTop2'].forEach(id => { const el = document.getElementById(id); if (el) el.textContent = top; });
        ['whyPref','whyPref2'].forEach(id => { const el = document.getElementById(id); if (el) el.textContent = pref; });
        // Update duplicate results screen title and bullets based on persona
        const reco2 = document.getElementById('reco-title-2');
        if (reco2) {
          if (personaChoice && personaChoice.trim()) {
            const cleaned = personaChoice.replace(/\s+user$/i, '').trim();
            const safe = cleaned.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
            reco2.innerHTML = 'Top pick for<br/>' + safe + ' User!';
          } else {
            reco2.textContent = 'Our top pick for you!';
          }
        }
        const help = document.getElementById('reco2Help');
        if (help) {
          const needs = computePersonaNeeds(personaChoice);
          help.textContent = 'Matched to your ' + needs[0] + ' and ' + needs[1] + ' needs';
        }
        const featList = document.getElementById('reco2Features');
        const promo = document.getElementById('reco2Promo');
        if (featList || promo) {
          const f = getFeatureDataForPersona(personaChoice);
          if (featList) {
            featList.innerHTML = [
              '<li>Roaming allowance: ' + f.roaming + '</li>',
              '<li>Hotspot: ' + f.hotspot + '</li>',
              '<li>Speed: ' + f.speed + '</li>'
            ].join('');
          }
          if (promo) promo.textContent = 'Promo: ' + f.promo;
        }
        const whyList2 = document.getElementById('recoWhyList2');
        if (whyList2) {
          const needs = computePersonaNeeds(personaChoice);
          const bullets = [
            'Optimized for ' + (needs[0] || 'your needs') + ' in your area (<span id="whyZip2">YOUR ZIP</span>)',
            'Suited for ' + (needs[1] || 'usage') + ' with plan features and add‚Äëons that match your usage'
          ];
          whyList2.innerHTML = bullets.map(t => '<li>' + t + '</li>').join('');
          const zipEl = document.getElementById('whyZip2');
          if (zipEl) { zipEl.textContent = (lastAddress.zip || 'YOUR ZIP').toUpperCase(); }
        }
      }
      function viewPlan(name, down, up, price, allowance, equipment, why1, why1sub, why2, why2sub) {
        const setText = (id, val, isHTML=false) => {
          const el = document.getElementById(id);
          if (!el) return;
          if (isHTML) el.innerHTML = val;
          else el.textContent = val;
        };
        // Helper to populate either normal or offer IDs if they exist
        const fillFor = (prefix) => {
          setText(prefix + 'Name', name || 'Plan');
          setText(prefix + 'Price', (price || '$0.00') + '<span class="muted">/mo</span>', true);
        };
        fillFor('pd');
        fillFor('pdO');
        // Pricing breakdown calculations
        const base = parseFloat(String(price || '').replace(/[^0-9.]/g, '')) || 0;
        const fmt = (n) => '$' + n.toFixed(2);
        const reg = 5.99;
        const taxApprox = base * 0.06;
        const totalEst = base + reg + taxApprox;
        const fillBreakdown = (prefix) => {
          setText(prefix + 'PriceRate', fmt(base) + ' per line', true);
          setText(prefix + 'RegFee', fmt(reg) + ' per line');
          setText(prefix + 'Tax', '~ 6% of base rate');
          setText(prefix + 'Total', fmt(totalEst));
          setText(prefix + 'ActFee', '$35.00 per line');
          setText(prefix + 'Install', 'Setup is free');
          setText(prefix + 'IncDown', (down ? down + ' Mbps' : ''));
          setText(prefix + 'IncUp', (up ? up + ' Mbps' : ''));
          setText(prefix + 'Allowance', allowance || 'Unlimited');
          setText(prefix + 'Equipment', equipment || 'Wi‚ÄëFi Router');
          setText(prefix + 'Why1Title', why1 || 'Why point 1');
          setText(prefix + 'Why1Desc', why1sub || '');
          setText(prefix + 'Why2Title', why2 || 'Why point 2');
          setText(prefix + 'Why2Desc', why2sub || '');
        };
        fillBreakdown('pd');
        fillBreakdown('pdO');
        // Optional default for third why card
        setText('pdWhy3Title', 'Best Speed in Your Area');
        setText('pdWhy3Desc', 'Based on feasibility check');
        setText('pdOWhy3Title', 'Best Speed in Your Area');
        setText('pdOWhy3Desc', 'Based on feasibility check');
        // Set recommended pill based on selected product
        const pill = document.getElementById('pdRecoPill');
        if (pill) {
          const n = String(name || '').toLowerCase();
          let cls = 'pill pill-high';
          let label = 'Highly Recommended';
          if (n.includes('fiber 500') || n.includes('fiber 300')) {
            cls = 'pill pill-med';
            label = 'Medium Recommended';
          } else if (n.includes('basic 100') || n.includes('basic')) {
            cls = 'pill pill-low';
            label = 'Low Recommended';
          } else if (n.includes('giga')) {
            cls = 'pill pill-high';
            label = 'Highly Recommended';
          }
          pill.className = cls;
          pill.textContent = label;
        }
        const pillO = document.getElementById('pdORecoPill');
        if (pillO) {
          pillO.className = document.getElementById('pdRecoPill')?.className || pillO.className;
          pillO.textContent = document.getElementById('pdRecoPill')?.textContent || pillO.textContent;
        }
        // Optional args: description (10) and ETA days (11)
        const desc = arguments[10];
        const etaDays = arguments[11];
        // Optional args: reco pill label (12) and class (13)
        const recoLabel = arguments[12];
        const recoClass = arguments[13];
        // Optional: target screen id (14)
        const targetScreen = arguments[14];
        const descEl = document.getElementById('pdDesc');
        if (descEl) {
          if (typeof desc !== 'undefined') {
            descEl.textContent = desc;
          } else {
            descEl.textContent = (down && up) ? (down + ' Mbps download ‚Ä¢ ' + up + ' Mbps upload') : '';
          }
        }
        const descElO = document.getElementById('pdODesc');
        if (descElO) {
          if (typeof desc !== 'undefined') {
            descElO.textContent = desc;
          } else {
            descElO.textContent = (down && up) ? (down + ' Mbps download ‚Ä¢ ' + up + ' Mbps upload') : '';
          }
        }
        const etaEl = document.getElementById('pdEta');
        if (etaEl) {
          if (typeof etaDays !== 'undefined') {
            etaEl.textContent = 'Activation ETA: ' + etaDays + ' days';
          }
        }
        const etaElO = document.getElementById('pdOEta');
        if (etaElO) {
          if (typeof etaDays !== 'undefined') {
            etaElO.textContent = 'Activation ETA: ' + etaDays + ' days';
          }
        }
        // cache selected plan for review screen (include reco pill meta if provided)
        currentPlan = { name, down, up, price, allowance, equipment, why1, why1sub, why2, why2sub, desc, etaDays, recoLabel, recoClass };
        // Ensure "Why this product for you?" is open by default
        const whyBody = document.getElementById('accWhyBody');
        const whyArrow = document.getElementById('accWhyArrow');
        if (whyBody && whyArrow) {
          whyBody.classList.remove('hidden');
          whyArrow.textContent = '‚ñæ';
        }
        const whyBodyO = document.getElementById('accWhyBodyO');
        const whyArrowO = document.getElementById('accWhyArrowO');
        if (whyBodyO && whyArrowO) {
          whyBodyO.classList.remove('hidden');
          whyArrowO.textContent = '‚ñæ';
        }
        // If navigating to offer details, derive "Why this product" points from the offer's rationale bullets
        if ((targetScreen || '') === 'screen-plan-offer') {
          const whyLis = Array.from(document.querySelectorAll('#offerWhyBody li')).map(li => (li.textContent || '').trim());
          const w1 = whyLis[0] || 'The system detected an increase in your data needs.';
          const w2 = whyLis[1] || 'This upgrade directly addresses your needs with Unlimited 5G+ and extra hotspot data.';
          const w3 = [whyLis[2], whyLis[3]].filter(Boolean).join(' ') || 'Timing is ideal with a limited‚Äëtime retention incentive.';
          // Titles summarizing each rationale
          setText('pdOWhy1Title', 'Rising Data Consumption');
          setText('pdOWhy1Desc', w1);
          setText('pdOWhy2Title', 'Offer Solves Your Need');
          setText('pdOWhy2Desc', w2);
          setText('pdOWhy3Title', 'Right Time to Upgrade');
          setText('pdOWhy3Desc', w3);
        }
        goto(targetScreen || 'screen-plan-full');
      }
      function openReview(sourceId) {
        reviewBackTarget = sourceId || reviewBackTarget;
        const hdr = document.getElementById('reviewTitleText');
        if (hdr) hdr.textContent = 'Review Your Plan';
        const btn = document.getElementById('reviewConfirmBtn');
        if (btn) btn.textContent = 'Confirm & Proceed to Payment';
        isUpgradeFlow = false;
        goto('screen-review');
      }
      function openReviewUpgrade() {
        reviewBackTarget = 'screen-offer-special';
        const hdr = document.getElementById('reviewTitleText');
        if (hdr) hdr.textContent = 'Review your Upgrade';
        const btn = document.getElementById('reviewConfirmBtn');
        if (btn) btn.textContent = 'Confirm Upgrade & Proceed to Payment';
        isUpgradeFlow = true;
        goto('screen-review');
      }
      function historyBackReview() {
        goto(reviewBackTarget || 'screen-results-reco');
      }
      function populateReviewScreen() {
        if (!currentPlan) return;
        const setText = (id, val, isHTML=false) => {
          const el = document.getElementById(id);
          if (!el) return;
          if (isHTML) el.innerHTML = val;
          else el.textContent = val;
        };
        const { name, down, up, price, allowance, equipment, why1, why1sub, why2, why2sub, desc, etaDays, recoLabel, recoClass } = currentPlan;
        setText('rvName', name || 'Plan');
        setText('rvPrice', (price || '$0.00') + '<span class="muted">/mo</span>', true);
        setText('rvDesc', (typeof desc !== 'undefined' ? desc : ((down && up) ? (down + ' Mbps download ‚Ä¢ ' + up + ' Mbps upload') : '')));
        const eta = document.getElementById('rvEta');
        if (eta) eta.textContent = (typeof etaDays !== 'undefined' ? ('Activation ETA: ' + etaDays + ' days') : '');
        const downUp = document.getElementById('rvIncDownUp');
        if (downUp) downUp.textContent = (down && up) ? (down + ' / ' + up + ' Mbps') : '';
        const allow = document.getElementById('rvAllowance');
        if (allow) allow.textContent = allowance || 'Unlimited';
        const equip = document.getElementById('rvEquipment');
        if (equip) equip.textContent = equipment || 'Wi‚ÄëFi 6 Router';
        const pill = document.getElementById('rvRecoPill');
        if (pill) {
          if (recoLabel || recoClass) {
            if (recoClass) pill.className = recoClass;
            if (recoLabel) pill.textContent = recoLabel;
          } else {
            const n = String(name || '').toLowerCase();
            let cls = 'pill pill-high';
            let label = 'Highly Recommended';
            if (n.includes('fiber 500') || n.includes('fiber 300')) {
              cls = 'pill pill-med'; label = 'Medium Recommended';
            } else if (n.includes('basic 100') || n.includes('basic')) {
              cls = 'pill pill-low'; label = 'Low Recommended';
            }
            pill.className = cls;
            pill.textContent = label;
          }
        }
        computeReviewTotals();
      }
      function computeReviewTotals() {
        if (!currentPlan) return;
        const base = parseFloat(String(currentPlan.price || '').replace(/[^0-9.]/g, '')) || 0;
        const fmt = (n) => '$' + n.toFixed(2);
        const addSec = !!document.getElementById('rvAddSec')?.checked;
        const addIp = !!document.getElementById('rvAddIp')?.checked;
        const sec = addSec ? 5.00 : 0;
        const ip = addIp ? 10.00 : 0;
        const inst = 50.00;
        const monthly = base + sec + ip;
        const dueToday = inst;
        const set = (id, val) => { const el = document.getElementById(id); if (el) el.textContent = val; };
        set('rvBase', fmt(base));
        set('rvSec', fmt(sec + ip)); // combined add-ons shown under Enhanced Security line
        set('rvInst', fmt(inst));
        set('rvMonthly', fmt(monthly));
        set('rvDueToday', fmt(dueToday));
      }
      function populateReviewScreen2() {
        if (!currentPlan) return;
        computeReviewTotals2();
      }
      function computeReviewTotals2() {
        // Derive base from selected plan if available, otherwise fallback to visible price on the screen
        let base = 0;
        if (currentPlan && currentPlan.price) {
          base = parseFloat(String(currentPlan.price).replace(/[^0-9.]/g, '')) || 0;
        } else {
          const priceEl = document.querySelector('#screen-review-2 .address-top .price');
          if (priceEl) {
            base = parseFloat((priceEl.textContent || '').replace(/[^0-9.]/g, '')) || 0;
          }
        }
        const fmt = (n) => '$' + n.toFixed(2);
        const addSec = !!document.getElementById('rv2AddSec')?.checked;
        const addIp = !!document.getElementById('rv2AddIp')?.checked;
        const sec = addSec ? 5.00 : 0;
        const ip = addIp ? 10.00 : 0;
        const inst = 50.00;
        const monthly = base + sec + ip;
        const dueToday = inst;
        const set = (id, val) => { const el = document.getElementById(id); if (el) el.textContent = val; };
        set('rv2Base', fmt(base));
        set('rv2Sec', fmt(sec + ip));
        set('rv2Inst', fmt(inst));
        set('rv2Monthly', fmt(monthly));
        set('rv2DueToday', fmt(dueToday));
      }
      function openCheckout() {
        if (!currentPlan) return;
        // compute totals using same logic + simple tax estimate
        const base = parseFloat(String(currentPlan.price || '').replace(/[^0-9.]/g, '')) || 0;
        const addSec = !!(document.getElementById('rvAddSec')?.checked || document.getElementById('rv2AddSec')?.checked);
        const addIp = !!(document.getElementById('rvAddIp')?.checked || document.getElementById('rv2AddIp')?.checked);
        const sec = addSec ? 5.00 : 0;
        const ip = addIp ? 10.00 : 0;
        const inst = 50.00;
        const monthly = base + sec + ip;
        const taxes = +(base * 0.06).toFixed(2);
        const dueToday = +(monthly + inst + taxes).toFixed(2);
        const fmt = (n) => '$' + n.toFixed(2);
        const setHTML = (id, html) => { const el = document.getElementById(id); if (el) el.innerHTML = html; };
        const setText = (id, txt) => { const el = document.getElementById(id); if (el) el.textContent = txt; };
        if (isUpgradeFlow) {
          setText('coPlanNameUp', (currentPlan?.name || 'Selected Plan'));
          setHTML('coPlanPriceUp', fmt(base) + '<span class="muted">/mo</span>');
          setText('coInstallUp', fmt(inst));
          setText('coTaxesUp', fmt(taxes));
          setText('coDueTodayUp', fmt(dueToday));
          goto('screen-checkout-upgrade');
        } else {
          setText('coPlanName', (currentPlan?.name || 'Selected Plan'));
          setHTML('coPlanPrice', fmt(base) + '<span class="muted">/mo</span>');
          setText('coInstall', fmt(inst));
          setText('coTaxes', fmt(taxes));
          setText('coDueToday', fmt(dueToday));
          const payBtn = document.getElementById('coPayBtn');
          if (payBtn) payBtn.textContent = 'Pay & Activate Plan';
          goto('screen-checkout');
        }
      }
      function openSuccess() {
        // Populate success details from the selected plan
        const setText = (id, val) => { const el = document.getElementById(id); if (el) el.textContent = val; };
        const name = currentPlan?.name || 'Selected Plan';
        const speed = (currentPlan?.down ? 'Up to ' + currentPlan.down + ' Mbps' : '‚Äî');
        const today = new Date();
        const fmtDate = (d) => d.toLocaleDateString(undefined, { month:'short', day:'2-digit', year:'numeric' });
        const first = new Date(today.getFullYear(), today.getMonth() + 1, today.getDate());
        if (isUpgradeFlow) {
          // Fill upgrade success
          setText('suUpPrev', 'Basic Plan');
          setText('suUpNew', name);
          setText('suUpEffective', fmtDate(first));
          goto('screen-success-upgrade');
        } else {
          setText('suPlan', name);
          setText('suSpeed', speed);
          setText('suActivation', fmtDate(today));
          setText('suFirstBill', fmtDate(first));
          const sub = document.getElementById('success-sub');
          if (sub) sub.textContent = 'Your ' + name + ' is Active! Welcome aboard';
          // Reset and render rating stars
          suRating = 0;
          renderSuStars();
          goto('screen-success');
        }
      }
      function toggleUpFeedbackChip(el) {
        el.classList.toggle('selected');
      }
      function toggleAccordion(section) {
        const map = {
          why: { body: 'accWhyBody', arrow: 'accWhyArrow' },
          inc: { body: 'accIncBody', arrow: 'accIncArrow' },
          price: { body: 'accPriceBody', arrow: 'accPriceArrow' }
        };
        const cfg = map[section];
        if (!cfg) return;
        const body = document.getElementById(cfg.body);
        const arrow = document.getElementById(cfg.arrow);
        if (!body || !arrow) return;
        const isHidden = body.classList.contains('hidden');
        if (isHidden) {
          body.classList.remove('hidden');
          arrow.textContent = '‚ñæ';
        } else {
          body.classList.add('hidden');
          arrow.textContent = '‚ñ∏';
        }
      }
      function toggleWhyReco() {
        const body = document.getElementById('recoWhyBody');
        const arrow = document.getElementById('recoWhyArrow');
        if (!body || !arrow) return;
        const isHidden = body.classList.contains('hidden');
        if (isHidden) {
          body.classList.remove('hidden');
          arrow.textContent = '‚ñæ';
        } else {
          body.classList.add('hidden');
          arrow.textContent = '‚ñ∏';
        }
      }
      function toggleOfferWhy() {
        const body = document.getElementById('offerWhyBody');
        const arrow = document.getElementById('offerWhyArrow');
        if (!body || !arrow) return;
        const isHidden = body.classList.contains('hidden');
        if (isHidden) {
          body.classList.remove('hidden');
          arrow.textContent = '‚ñæ';
        } else {
          body.classList.add('hidden');
          arrow.textContent = '‚ñ∏';
        }
      }
      // Success screen: star rating
      let suRating = 0;
      function renderSuStars() {
        const stars = document.querySelectorAll('#suStars .star');
        if (!stars.length) return;
        stars.forEach((el, idx) => {
          el.textContent = (idx < suRating) ? '‚òÖ' : '‚òÜ';
        });
      }
      function setStarRating(n) {
        suRating = n;
        renderSuStars();
      }
      // Upgrade feedback stars
      let suUpRating = 0;
      function renderSuStarsUp() {
        const stars = document.querySelectorAll('#suUpStars .star');
        if (!stars.length) return;
        stars.forEach((el, idx) => {
          el.textContent = (idx < suUpRating) ? '‚òÖ' : '‚òÜ';
        });
      }
      function setStarRatingUp(n) {
        suUpRating = n;
        renderSuStarsUp();
      }
      // Helpers for dashboard accordions
      function setAccordionOpen(bodyId, arrowId, headerSel, open) {
        const body = document.getElementById(bodyId);
        const arrow = document.getElementById(arrowId);
        const header = headerSel ? document.querySelector(headerSel) : null;
        if (!body || !arrow) return;
        if (open) {
          body.classList.remove('hidden');
          arrow.textContent = '‚ñæ';
          if (header) header.setAttribute('aria-expanded', 'true');
        } else {
          body.classList.add('hidden');
          arrow.textContent = '‚ñ∏';
          if (header) header.setAttribute('aria-expanded', 'false');
        }
      }
      function closeAllDashExcept(exceptKey) {
        const items = [
          { key: 'mybill', body: 'myBillBody', arrow: 'myBillArrow', headerSel: '#myBillCard [role="button"]' },
          { key: 'acc', body: 'accBody', arrow: 'accArrow', headerSel: '#accHealthCard [role="button"]' },
          { key: 'issues', body: 'issuesBody', arrow: 'issuesArrow', headerSel: '#openIssuesCard [role="button"]' },
          { key: 'offers', body: 'offersBody', arrow: 'offersArrow', headerSel: '#offersCard [role="button"]' },
        ];
        items.forEach(i => {
          if (i.key === 'offers') {
            // Always keep red-dot (offers) open
            setAccordionOpen(i.body, i.arrow, i.headerSel, true);
          } else if (i.key !== exceptKey) {
            setAccordionOpen(i.body, i.arrow, i.headerSel, false);
          }
        });
      }
      function toggleDash(section) {
        const map = {
          acc: { body: 'accBody', arrow: 'accArrow', headerSel: '#accHealthCard [role="button"]' },
          issues: { body: 'issuesBody', arrow: 'issuesArrow', headerSel: '#openIssuesCard [role="button"]' },
          offers: { body: 'offersBody', arrow: 'offersArrow', headerSel: '#offersCard [role="button"]' },
        };
        const cfg = map[section];
        if (!cfg) return;
        const body = document.getElementById(cfg.body);
        const arrow = document.getElementById(cfg.arrow);
        const header = document.querySelector(cfg.headerSel);
        if (!body || !arrow) return;
        const isHidden = body.classList.contains('hidden');
        if (section === 'offers') {
          // Keep offers permanently open
          setAccordionOpen(cfg.body, cfg.arrow, cfg.headerSel, true);
          return;
        }
        if (isHidden) {
          closeAllDashExcept(section);
          setAccordionOpen(cfg.body, cfg.arrow, cfg.headerSel, true);
        } else {
          setAccordionOpen(cfg.body, cfg.arrow, cfg.headerSel, false);
        }
      }
      function toggleMyBill() {
        const body = document.getElementById('myBillBody');
        const arrow = document.getElementById('myBillArrow');
        if (!body || !arrow) return;
        const isHidden = body.classList.contains('hidden');
        const header = document.querySelector('#myBillCard [role=\"button\"]');
        if (isHidden) {
          closeAllDashExcept('mybill');
          setAccordionOpen('myBillBody', 'myBillArrow', '#myBillCard [role=\"button\"]', true);
        } else {
          setAccordionOpen('myBillBody', 'myBillArrow', '#myBillCard [role=\"button\"]', false);
        }
      }
      // ---------- Modify Plan (Offer flow) ----------
      let modBoosterData = false;
      let modBoosterIntl = false;
      function openModifyPlan() {
        modBoosterData = false;
        modBoosterIntl = false;
        const slider = document.getElementById('modGbSlider');
        if (slider) slider.value = 20;
        const gb = document.getElementById('modGbVal');
        if (gb) gb.innerHTML = '20 <span class="muted" style="font-size:14px;">GB</span>';
        const b1 = document.getElementById('btnBoostData');
        const b2 = document.getElementById('btnBoostIntl');
        if (b1) { b1.textContent = 'Add +$10'; b1.style.background=''; b1.style.color=''; }
        if (b2) { b2.textContent = 'Add +$05'; b2.style.background=''; b2.style.color=''; }
        updateModifyEstimate();
        goto('screen-modify');
      }
      function onModifySlider(val) {
        const gb = document.getElementById('modGbVal');
        if (gb) gb.innerHTML = String(parseInt(val, 10)) + ' <span class="muted" style="font-size:14px;">GB</span>';
        updateModifyEstimate();
      }
      function toggleBooster(type) {
        if (type === 'data') modBoosterData = !modBoosterData;
        if (type === 'intl') modBoosterIntl = !modBoosterIntl;
        const b1 = document.getElementById('btnBoostData');
        const b2 = document.getElementById('btnBoostIntl');
        if (b1) {
          if (modBoosterData) { b1.textContent = 'Added +$10'; b1.style.background = '#401075'; b1.style.color = '#fff'; }
          else { b1.textContent = 'Add +$10'; b1.style.background = ''; b1.style.color=''; }
        }
        if (b2) {
          if (modBoosterIntl) { b2.textContent = 'Added +$05'; b2.style.background = '#401075'; b2.style.color = '#fff'; }
          else { b2.textContent = 'Add +$05'; b2.style.background = ''; b2.style.color=''; }
        }
        updateModifyEstimate();
      }
      function updateModifyEstimate() {
        // Base cost from slider: 10GB => $0, every +10GB adds $5.00
        const slider = document.getElementById('modGbSlider');
        const gbVal = slider ? parseInt(slider.value, 10) : 0;
        const baseCost = Math.max(0, ((gbVal - 10) / 10) * 5);
        const boosters = (modBoosterData ? 10 : 0) + (modBoosterIntl ? 5 : 0);
        const cost = baseCost + boosters;
        modEstCost = cost;
        const el = document.getElementById('modEst');
        if (el) el.innerHTML = '+$' + cost.toFixed(2) + '<span class=\"muted\">/mo</span>';
      }
      function confirmModify() {
        // Route to Review your Upgrade screen
        // Set review card price to reflect estimated cost impact
        currentPlan = {
          name: 'Plan Name',
          price: '$' + (modEstCost || 0).toFixed(2),
          allowance: 'Unlimited',
          equipment: 'Free Wi‚ÄëFi 6 Router',
          desc: ''
        };
        openReviewUpgrade();
        // Set the back target to return to Modify screen
        reviewBackTarget = 'screen-modify';
      }
      // ---------- AI Assistant (restored) ----------
      function aiActiveSuffix() {
        const d2 = document.getElementById('aiDrawer2');
        if (d2 && !d2.classList.contains('hidden')) return '2';
        const d1 = document.getElementById('aiDrawer');
        if (d1 && !d1.classList.contains('hidden')) return '';
        return '';
      }
      function aiById(base) {
        const suf = aiActiveSuffix();
        return document.getElementById(base + suf);
      }
      function openAISheet() {
        const scrim = document.getElementById('aiOverlay');
        if (scrim) scrim.classList.remove('hidden');
        const sheet1 = document.getElementById('aiDrawer');
        const sheet2 = document.getElementById('aiDrawer2');
        if (sheet2) sheet2.classList.add('hidden');
        if (sheet1) sheet1.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
        const phone = document.querySelector('.phone');
        if (phone) phone.style.overflow = 'hidden';
      }
      function openAISheet2() {
        const scrim = document.getElementById('aiOverlay');
        if (scrim) scrim.classList.remove('hidden');
        const sheet1 = document.getElementById('aiDrawer');
        const sheet2 = document.getElementById('aiDrawer2');
        if (sheet1) sheet1.classList.add('hidden');
        if (sheet2) sheet2.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
        const phone = document.querySelector('.phone');
        if (phone) phone.style.overflow = 'hidden';
        // Exploration scenario for duplicate sheet
        aiInitExploreFlow();
      }
      function closeAISheet() {
        const scrim = document.getElementById('aiOverlay');
        if (scrim) scrim.classList.add('hidden');
        const sheet1 = document.getElementById('aiDrawer');
        const sheet2 = document.getElementById('aiDrawer2');
        if (sheet1) sheet1.classList.add('hidden');
        if (sheet2) sheet2.classList.add('hidden');
        document.body.style.overflow = '';
        const phone = document.querySelector('.phone');
        if (phone) phone.style.overflow = 'auto';
      }
      function sendAIMessage() {
        const input = aiById('aiSheetInput');
        const body = aiById('aiChatBody');
        if (!input || !body) return;
        const msg = (input.value || '').trim();
        if (!msg) return;
        const sheet = aiById('aiDrawer');
        if (sheet) sheet.style.maxHeight = '95%';
        disableAllPreviousAiActions();
        const uRow = document.createElement('div');
        uRow.className = 'chat-row';
        uRow.innerHTML = '<div class="chat-avatar user"><img src="./assets/user-icon.svg" alt="You" style="width:34px; height:34px;" /></div><div class="chat-bubble"></div>';
        uRow.querySelector('.chat-bubble').textContent = msg;
        body.appendChild(uRow);
        let resp = 'Got it! I\'ll tailor recommendations for you.';
        const m = msg.toLowerCase();
        if (m.includes('faster') || m.includes('speed')) resp = 'To get faster internet, I recommend upgrading to a fiber plan available in your area.';
        else if (m.includes('bill') || m.includes('lower') || m.includes('reduce')) resp = 'We can lower your monthly bill by switching to a saver plan or removing unused add‚Äëons.';
        else if (m.includes('switch')) resp = 'Switching providers is easy ‚Äî I can compare offers and handle the transfer.';
        else if (m.includes('bundle')) resp = 'Custom bundles can save up to 20%. Let‚Äôs mix Internet + Mobile to maximize savings.';
        const aRow = document.createElement('div');
        aRow.className = 'chat-row';
        aRow.innerHTML = '<div class="chat-avatar agent"><img src="./assets/AI-Assistant-icon.svg" alt="AI Assistant" style="width:34px; height:34px;" /></div><div class="chat-bubble"></div>';
        aRow.querySelector('.chat-bubble').textContent = resp;
        body.appendChild(aRow);
        input.value = '';
        if (sheet) sheet.scrollTop = sheet.scrollHeight;
      }
      function aiToggleChip(el) {
        el.classList.toggle('selected');
        updateAiSubmitVisibility();
        if (el.classList.contains('selected')) {
          setTimeout(submitAiTopics, 150);
        }
      }
      function updateAiSubmitVisibility() {
        const cont = aiById('aiTopics');
        const btn = aiById('aiTopicsBtn');
        if (!cont || !btn) return;
        if (cont.classList.contains('ai-disabled')) { btn.style.display = 'none'; return; }
        const any = cont.querySelectorAll('.chip.selected').length > 0 ||
                    aiById('aiChatBody').querySelectorAll('input[type="checkbox"]:checked').length > 0;
        btn.style.display = any ? 'block' : 'none';
      }
      function disableAiActions(container) {
        if (!container) return;
        container.classList.add('ai-disabled');
        container.querySelectorAll('.chip').forEach(c => {
          c.classList.add('disabled');
          c.removeAttribute('onclick');
          c.removeAttribute('tabindex');
        });
        container.querySelectorAll('button, input, select, textarea').forEach(ctrl => {
          ctrl.disabled = true;
        });
      }
      function disableAllPreviousAiActions() {
        const body = aiById('aiChatBody');
        if (!body) return;
        body.querySelectorAll('.ai-selectable:not(.ai-disabled)').forEach(disableAiActions);
      }
      function submitAiTopics() {
        const cont = aiById('aiTopics');
        if (!cont) return;
        const selected = Array.from(cont.querySelectorAll('.chip.selected')).map(c => c.textContent.trim());
        if (!selected.length) return;
        const body = aiById('aiChatBody');
        const uRow = document.createElement('div');
        uRow.className = 'chat-row';
        uRow.innerHTML = '<div class="chat-avatar user"><img src="./assets/user-icon.svg" alt="You" style="width:34px; height:34px;" /></div><div class="chat-bubble"></div>';
        uRow.querySelector('.chat-bubble').textContent = 'I\'d like help with: ' + selected.join(', ');
        body.appendChild(uRow);
        const aRow = document.createElement('div');
        aRow.className = 'chat-row';
        aRow.innerHTML = '<div class="chat-avatar agent"><img src="./assets/AI-Assistant-icon.svg" alt="AI Assistant" style="width:34px; height:34px;" /></div><div class="chat-bubble"></div>';
        aRow.querySelector('.chat-bubble').textContent = 'Great! I\'ll use these topics to personalize suggestions. You can also type details below.';
        body.appendChild(aRow);
        disableAiActions(cont);
        updateAiSubmitVisibility();
        const sheet = aiById('aiDrawer');
        if (sheet) sheet.scrollTop = sheet.scrollHeight;
        setTimeout(aiStartGuidedFlow, 300);
      }
      const aiState = {
        persona: null,
        service: null,
        dataUse: null,
        priorities: [],
        planChoice: null,
        loweredSpeed: false,
        addedRouter: false,
        pinCode: null,
      };
      function aiAppendAgent(html, selectable=false) {
        const body = aiById('aiChatBody');
        const row = document.createElement('div');
        row.className = 'chat-row';
        row.innerHTML = '<div class="chat-avatar agent"><img src="./assets/AI-Assistant-icon.svg" alt="AI Assistant" style="width:34px; height:34px;" /></div><div class="chat-bubble"></div>';
        const bubble = row.querySelector('.chat-bubble');
        bubble.innerHTML = html;
        if (selectable) bubble.classList.add('ai-selectable');
        body.appendChild(row);
        const sheet = aiById('aiDrawer');
        if (sheet) sheet.scrollTop = sheet.scrollHeight;
        return bubble;
      }
      function aiAppendUser(text) {
        const body = aiById('aiChatBody');
        const row = document.createElement('div');
        row.className = 'chat-row';
        row.innerHTML = '<div class="chat-avatar user"><img src="./assets/user-icon.svg" alt="You" style="width:34px; height:34px;" /></div><div class="chat-bubble"></div>';
        // Support multi-line user messages by converting newlines to <br/>
        row.querySelector('.chat-bubble').innerHTML = String(text || '').replace(/\n/g, '<br/>');
        body.appendChild(row);
        const sheet = aiById('aiDrawer');
        if (sheet) sheet.scrollTop = sheet.scrollHeight;
      }
      function aiRenderChips(container, labels, handlerName, multi=false, max=2) {
        const chipWrap = document.createElement('div');
        chipWrap.className = 'toolbar ai-selectable';
        let btnRow, btn;
        function ensureBtn() {
          if (!btnRow) {
            btnRow = document.createElement('div');
            btnRow.style.flexBasis = '100%';
            btnRow.style.display = 'block';
            chipWrap.appendChild(btnRow);
          }
          if (!btn) {
            btn = document.createElement('button');
            btn.className = 'cta-secondary';
            btn.style.marginTop = '6px';
            btn.style.height = '30px';
            btn.style.width = 'auto';
            btnRow.appendChild(btn);
          }
          btn.textContent = multi ? 'Submit' : 'Select';
        }
        labels.forEach(label => {
          const span = document.createElement('span');
          span.className = 'chip chip-white';
          span.setAttribute('role', 'button');
          span.setAttribute('tabindex', '0');
          span.textContent = label;
          span.onclick = function() {
            if (!multi) {
              Array.from(chipWrap.querySelectorAll('.chip')).forEach(c => c.classList.remove('selected'));
              span.classList.add('selected');
              ensureBtn();
              btn.onclick = function() {
                const chosen = chipWrap.querySelector('.chip.selected');
                if (!chosen) return;
                disableAiActions(chipWrap);
                window[handlerName] && window[handlerName](chosen.textContent.trim());
              };
            } else {
              span.classList.toggle('selected');
              const chosen = Array.from(chipWrap.querySelectorAll('.chip.selected')).map(c => c.textContent.trim());
              ensureBtn();
              btn.textContent = 'Submit';
              btn.onclick = function() {
                if (!chosen.length) return;
                disableAiActions(chipWrap);
                window[handlerName] && window[handlerName](chosen.slice(0, max));
              };
              if (chosen.length > max) {
                span.classList.remove('selected');
              }
            }
          };
          chipWrap.appendChild(span);
        });
        container.appendChild(chipWrap);
      }
      function aiStartGuidedFlow() {
        const bubble = aiAppendAgent('<div><strong>Got it!</strong> To personalize your plan, which one sounds most like you?</div>', true);
        aiRenderChips(bubble, [
          'Everyday Essentials','Work & Travel','Family Saver','Gamer & Streamer','Budget Maximizer','I‚Äôm not sure / create my own'
        ], 'aiChoosePersona', false);
      }
      // Exploration scenario for AI Assistant (Duplicate)
      function aiInitExploreFlow() {
        const body = aiById('aiChatBody');
        if (!body) return;
        body.innerHTML = '';
        aiState.exploreUsage = null;
        aiState.exploreFeels = [];
        aiState.exploreDaily = [];
        aiState.exploreMost = [];
        aiExploreIntro();
      }
      function aiExploreIntro() {
        const html = [
          '<div><strong>Hi! üëã</strong></div>',
          '<div style="margin-top:6px;">You‚Äôre not limited to a fixed persona ‚Äî let‚Äôs discover the one that fits you best.</div>',
          '<div style="margin-top:6px;">I‚Äôll ask a few quick questions. Ready?</div>'
        ].join('');
        const b = aiAppendAgent(html, true);
        aiRenderChips(b, ['Yes','Let‚Äôs do it','Sure'], 'aiExploreQ1', false);
      }
      function aiExploreQ1(label) {
        aiAppendUser(label + '.');
        const b = aiAppendAgent('Great! First one ‚Äî<br/>How do you mostly use your mobile data?', true);
        aiRenderChips(b, [
          'Social media & messaging',
          'OTT / Streaming (Netflix, YouTube, etc.)',
          'Work + hotspot',
          'Gaming',
          'Travel & roaming',
          'A little bit of everything'
        ], 'aiExploreQ2', false);
      }
      function aiExploreQ2(label) {
        aiState.exploreUsage = label;
        aiAppendUser(label + '.');
        const b = aiAppendAgent('Got it! üëç<br/>Next ‚Äî Which of these feels most like you? <em>Pick one or two.</em>', true);
        aiRenderChips(b, [
          'I like simple, no-hassle plans',
          'I want the fastest internet possible',
          'I want the best value for money',
          'I need long validity',
          'I travel and use roaming often',
          'I want OTT apps included',
          'I work from anywhere and need reliable hotspot'
        ], 'aiExploreQ3', true, 2);
      }
      function aiExploreQ3(labels) {
        aiState.exploreFeels = labels;
        aiAppendUser(labels.join(' + ') + '.');
        const b = aiAppendAgent('Nice ‚Äî that helps me understand your style.<br/>Here‚Äôs another one: What‚Äôs most important in your day‚Äëto‚Äëday usage?', true);
        aiRenderChips(b, [
          'Avoiding slow speeds during peak hours',
          'Saving money every month',
          'Staying connected while traveling',
          'Streaming HD content smoothly',
          'Working without interruptions',
          'Unlimited social + OTT',
          'Having flexibility to switch things up'
        ], 'aiExploreQ4', true, 2);
      }
      function aiExploreQ4(labels) {
        aiState.exploreDaily = labels;
        aiAppendUser(labels.join(' + ') + '.');
        const b = aiAppendAgent('Great choices! Now‚Ä¶ Which of these matter the most to you? <em>Pick up to 3.</em>', true);
        aiRenderChips(b, [
          'Speed','Coverage','Roaming','Budget','OTT Apps','Flexibility','Long validity','Hotspot reliability'
        ], 'aiExploreReveal', true, 3);
      }
      function aiExploreReveal(labels) {
        aiState.exploreMost = labels;
        aiAppendUser(labels.join(' + ') + '.');
        aiAppendAgent('Awesome ‚Äî I‚Äôve got everything I need. <br/>Let me analyse your answers‚Ä¶ üîç‚ö°');
        setTimeout(() => {
          const personaTitle = 'The Smart Explorer';
          const whyPrior = (aiState.exploreMost && aiState.exploreMost[0]) || 'a balance of speed and value';
          const whyCare = (aiState.exploreDaily && aiState.exploreDaily[0]) || 'reliability';
          const whyUsage = aiState.exploreUsage || 'a little bit of everything';
          const html = [
            '<div><strong>Here‚Äôs what I found!</strong></div>',
            '<div style="margin-top:6px;"><strong>You‚Äôre closest to:</strong> ' + personaTitle + '</div>',
            '<div class="muted" style="margin-top:4px;">‚ÄúYou balance value, reliability, and flexibility ‚Äî you don‚Äôt fit in a box, and that‚Äôs great!‚Äù</div>',
            '<div style="margin-top:8px;"><strong>Why I matched you:</strong>',
            '<ul style="margin:6px 0 0 18px;">',
            '<li>You prioritise ' + whyPrior + '</li>',
            '<li>You care about ' + whyCare + '</li>',
            '<li>Your usage leans toward ' + whyUsage + '</li>',
            '</ul></div>'
          ].join('');
          const b = aiAppendAgent(html, true);
          aiRenderChips(b, ['Show My Best Matches','Compare Personas','Restart Questions'], 'aiExploreNext', false);
        }, 1000);
      }
      function aiExploreNext(label) {
        if (label === 'Show My Best Matches') {
          aiExploreShowMatches();
        } else if (label === 'Compare Personas') {
          aiAppendUser('Compare Personas.');
          aiAppendAgent('Here‚Äôs a quick comparison you might find helpful:<br/><br/><strong>Smart Explorer</strong>: Balanced value + reliability + flexibility.<br/><strong>Speed Seeker</strong>: Peak speeds and low latency.<br/><strong>Saver</strong>: Lowest monthly cost with essential benefits.');
        } else {
          aiAppendUser('Restart Questions.');
          aiInitExploreFlow();
        }
      }
      function aiExploreShowMatches() {
        aiAppendUser('Show My Best Matches.');
        const html = [
          '<div class="card" style="margin-top:8px;">',
          '<div><strong>Your Persona is ‚Äî Smart Explorer</strong></div>',
          '<div class="muted">Highlights</div>',
          '<ul style="margin:6px 0 0 18px;"><li>Fast 5G / Fiber speeds</li><li>Reliable hotspot for work</li><li>Flexible add‚Äëons (OTT / roaming)</li></ul>',
          '<div style="margin-top:6px;" class="muted">Benefits</div>',
          '<ul style="margin:6px 0 0 18px;"><li>Balanced value and reliability</li><li>Easy to customize later</li></ul>',
          '<div style="margin-top:6px;" class="muted">Why it fits your persona</div>',
          '<div>Balanced speed, reliability and flexibility that match your choices.</div>',
          '</div>'
        ].join('');
        const b = aiAppendAgent(html, true);
        aiRenderChips(b, ['Consider this Persona','Restart Questions'], 'aiExploreConfirmChoice', false);
      }
      function aiExploreConfirmChoice(label) {
        if (label === 'Restart Questions') {
          aiAppendUser('Restart Questions.');
          aiInitExploreFlow();
          return;
        }
        aiAppendUser('Consider this Persona.');
        personaChoice = 'Smart Explorer';
        closeAISheet();
        goto('screen-address');
      }
      function aiChoosePersona(label) {
        aiState.persona = label;
        aiAppendUser(label + '.');
        aiAppendAgent('Nice ‚Äî I‚Äôll prioritize ' + (label.includes('Gamer') ? 'speed, low latency, and unlimited data' : 'your top needs') + ' for you.');
        const b = aiAppendAgent('What‚Äôs most important to you? <em>(Choose up to 2)</em>', true);
        aiRenderChips(b, ['Speed','Coverage','Budget','Flexibility','Device Benefits','Reliability'], 'aiChoosePriorities', true, 2);
      }
      function aiChoosePriorities(labels) {
        aiState.priorities = labels;
        aiAppendUser(labels.join(' + ') + '.');
        const b = aiAppendAgent('Great! I can show plans available at your address. Can I check coverage for your location?', true);
        const wrap = document.createElement('div');
        wrap.className = 'toolbar ai-selectable';
        const allow = document.createElement('span');
        allow.className = 'chip chip-white';
        allow.textContent = 'Allow location';
        allow.onclick = function() {
          disableAiActions(wrap);
          aiAppendUser('Allow location.');
          setTimeout(() => {
            aiAppendAgent('Perfect ‚Äî fiber up to 1 Gbps is available in your area. Let me build your first options.');
            setTimeout(aiShowFirstPlans, 200);
          }, 400);
        };
        const manual = document.createElement('span');
        manual.className = 'chip chip-white';
        manual.textContent = 'Enter PIN code manually';
        manual.onclick = function() {
          const inputRow = document.createElement('div');
          inputRow.style.marginTop = '8px';
          inputRow.innerHTML = '<div class="input-with-icon"><span class="icon-left">üìç</span><input type="text" id="aiPinInput" placeholder="Enter PIN (e.g., 560038)" style="width:100%;"/></div><button class="cta-secondary" style="margin-top:8px; height:30px; width:auto;">Submit</button>';
          wrap.appendChild(inputRow);
          const btn = inputRow.querySelector('button');
          btn.onclick = function() {
            const v = (inputRow.querySelector('input').value || '').trim();
            if (!v) return;
            aiState.pinCode = v;
            disableAiActions(wrap);
            aiAppendUser('PIN: ' + v);
            setTimeout(() => {
              aiAppendAgent('Perfect ‚Äî fiber up to 1 Gbps is available in your area. Let me build your first options.');
              setTimeout(aiShowFirstPlans, 200);
            }, 400);
          };
        };
        wrap.appendChild(allow);
        wrap.appendChild(manual);
        b.appendChild(wrap);
      }
      function aiShowFirstPlans() {
        const html = [
          '<div><strong>Here are your top 3 recommended plansüëá</strong><br/><span class="muted">(You can edit anything later.)</span></div>',
          '<div class="card" style="margin-top:8px;"><strong>Option A ‚Äî Performance</strong><br/>1 Gbps Fiber | Ultra-low latency | Unlimited Data<br/><strong>‚Çπ1999/month</strong></div>',
          '<div class="card"><strong>Option B ‚Äî Balanced</strong><br/>500 Mbps Fiber | Unlimited Data<br/><strong>‚Çπ1499/month</strong></div>',
          '<div class="card"><strong>Option C ‚Äî Value</strong><br/>300 Mbps Fiber | Unlimited Data<br/><strong>‚Çπ1199/month</strong></div>',
          '<div style="margin-top:6px;">Which Product you want to select</div>'
        ].join('');
        const b = aiAppendAgent(html, true);
        aiRenderChips(b, ['Option A ‚Äî Performance','Option B ‚Äî Balanced','Option C ‚Äî Value'], 'aiPickPlan', false);
      }
      function aiPickPlan(label) {
        aiState.planChoice = label;
        aiAppendUser(label + '.');
        let summary = '';
        if (label.includes('Performance')) summary = '<strong>1 Gbps Fiber ‚Äî Ultra‚Äëlow latency</strong><br/>Unlimited data ‚Ä¢ Wi‚ÄëFi router included<br/><strong>‚Çπ1999/month</strong>';
        else if (label.includes('Balanced')) summary = '<strong>500 Mbps Fiber ‚Äî Balanced</strong><br/>Unlimited data ‚Ä¢ Great price/performance<br/><strong>‚Çπ1499/month</strong>';
        else summary = '<strong>300 Mbps Fiber ‚Äî Value</strong><br/>Unlimited data ‚Ä¢ Best monthly savings<br/><strong>‚Çπ1199/month</strong>';
        aiAppendAgent('<div><strong>Quick summary</strong></div><div class="card" style="margin-top:6px;">' + summary + '</div>');
        const html = [
          '<div><strong>All good! ‚úîÔ∏è</strong></div>',
          '<div>‚Ä¢ Router in stock<br/>‚Ä¢ Install available tomorrow<br/>‚Ä¢ Price locked for 15 minutes</div>',
          '<div style="margin-top:6px;">Ready to confirm?</div>'
        ].join('');
        const b = aiAppendAgent(html, true);
        aiRenderChips(b, ['Activate Now','Save for Later','Compare Plans'], 'aiConfirm', false);
      }
      function aiConfirm(label) {
        aiAppendUser(label + '.');
        if (label === 'Activate Now') {
          const id = 'HX' + Math.random().toString(36).slice(2,6).toUpperCase();
          aiAppendAgent('üéâ Your order is confirmed!<br/><strong>Order ID: ' + id + '</strong><br/>Installation tomorrow.');
          const b = aiAppendAgent('How helpful was this experience?', true);
          aiRenderChips(b, ['üëç','üëé'], 'aiFeedback', false);
        } else if (label === 'Save for Later') {
          aiAppendAgent('Saved! You can return here anytime to continue.');
        } else {
          aiAppendAgent('I\'ll open a comparison with similar plans next.');
        }
      }
      function aiFeedback(label) {
        aiAppendUser(label);
        aiAppendAgent('Thanks! I‚Äôm here if you need anything else.');
      }
    </script>
  </body>
  </html>









